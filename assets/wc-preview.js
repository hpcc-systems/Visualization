var F=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var h=(n,r,e,t)=>{for(var s=t>1?void 0:t?N(r,e):r,i=n.length-1,o;i>=0;i--)(o=n[i])&&(s=(t?o(r,e,s):o(s))||s);return t&&s&&F(r,e,s),s};function y(n,...r){let e=n[0];for(let t=0;t<r.length;++t)e+=String(r[t]),e+=n[t+1];return e}function S(n){return`:host([hidden]) {
    display: none
}

:host {
    display: ${n}
}`}var ge=Array.isArray;var P=typeof globalThis!="undefined"?globalThis:window;var j=typeof process!="undefined"&&process.versions!=null&&process.versions.node!=null,me=j&&process.env!=null&&(process.env.TRAVIS!=null||process.env.GITHUB_ACTIONS!=null);var _=class{constructor(){this.stack=[]}push(r){return this.stack.push(r),r}pop(){return this.stack.pop()}top(){return this.stack.length?this.stack[this.stack.length-1]:void 0}depth(){return this.stack.length}};var V=(a=>(a[a.debug=0]="debug",a[a.info=1]="info",a[a.notice=2]="notice",a[a.warning=3]="warning",a[a.error=4]="error",a[a.critical=5]="critical",a[a.alert=6]="alert",a[a.emergency=7]="emergency",a))(V||{}),z={debug:"cyan",info:"green",notice:"grey",warning:"blue",error:"red",critical:"magenta",alert:"magenta",emergency:"magenta"},O=class{write(r,e,t,s){j?console.log(`[${r}] ${V[e].toUpperCase()} ${t}:  ${s}`):console.log(`[${r}] %c${V[e].toUpperCase()}%c ${t}:  ${s}`,`color:${z[V[e]]}`,"")}},D=class{constructor(){this._levelStack=new _;this._level=1;this._filter="";this._writer=new O}static Instance(){return this._instance||(this._instance=new this)}stringify(r){let e=[];return JSON.stringify(r,function(t,s){if(typeof s=="object"&&s!==null){if(e.indexOf(s)!==-1)return;e.push(s)}return s},2)}writer(r){return r===void 0?this._writer:(this._writer=r,this)}log(r,e,t){if(r<this._level||this._filter&&this._filter!==e)return;let s=new Date().toISOString();this._writer.rawWrite?this._writer.rawWrite(s,r,e,t):(typeof t!="string"&&(t=this.stringify(t)),this._writer.write&&this._writer.write(s,r,e,t))}debug(r,e){this.log(0,r,e)}info(r,e){this.log(1,r,e)}notice(r,e){this.log(2,r,e)}warning(r,e){this.log(3,r,e)}error(r,e){this.log(4,r,e)}critical(r,e){this.log(5,r,e)}alert(r,e){this.log(6,r,e)}emergency(r,e){this.log(7,r,e)}level(r){return r===void 0?this._level:(this._level=r,this)}pushLevel(r){return this._levelStack.push(this._level),this._level=r,this}popLevel(){return this._level=this._levelStack.pop(),this}filter(r){return r===void 0?this._filter:(this._filter=r,this)}},Ee=D.Instance();var $;(function(){if(P.requestAnimationFrame)$=P.requestAnimationFrame;else{let n=0;$=function(r){let e=new Date().getTime(),t=Math.max(0,16-(e-n)),s=setTimeout(()=>r(e+t),t);return n=e+t,s}}})();var x=class{get canConflate(){return!1}conflate(r){return!1}void(){return!1}};var v=class{constructor(){this._observerID=0;this._observers=[];this._messageBuffer=[]}observers(){return this._observers}messages(){let r=[];return this._messageBuffer.forEach(e=>{r.some(t=>t.canConflate&&t.conflate(e))||r.push(e)}),r}dispatchAll(){this.dispatch(this.messages()),this.flush()}dispatch(r){r.length!==0&&this.observers().forEach(e=>{let t=r.filter(s=>!s.void()&&(e.type===void 0||s instanceof e.type));t.length&&e.callback(t)})}hasObserver(){return this._observers.length>0}flush(){this._messageBuffer=[]}send(r){this.dispatch([r])}post(r){this._messageBuffer.push(r),$(()=>this.dispatchAll())}attach(r,e){let t=this,s=++this._observerID;return this._observers.push({id:s,type:e,callback:r}),{release(){t._observers=t._observers.filter(i=>i.id!==s)},unwatch(){this.release()}}}};var w=class{},f=class extends w{constructor(e){super();this.propertyName=e}};function T(n,...r){let e=n[0],t=[];for(let s=0;s<r.length;++s){let i=r[s];if(i instanceof w)t.push(i),i instanceof f?e+=`id="${i.propertyName}"`:e+=String(r[s]);else throw new Error("Invalid Directive");e+=n[s+1]}return{html:e,directives:t}}function l(n){return new f(n)}var M=class extends x{constructor(e,t,s){super();this.changes={};this.changes[e]={oldValue:t,newValue:s}}get canConflate(){return!0}conflate(e){for(let t in e.changes){let s=this.changes[t],i=e.changes[t];s?this.changes[t].newValue=i==null?void 0:i.newValue:this.changes[t]=i}return!0}};var U={bubbles:!0,composed:!0,cancelable:!0},m=class extends HTMLElement{constructor(){var e,t;super();this.$meta=H(this);this.$dispatch=new v;this._fire=(e,t=!1,s=!0)=>{this.$dispatch.post(new M(e,t,s))};this.$_initialized=!1;this.$upgradeProperties(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=((e=this.$meta.template)==null?void 0:e.html.trim())||"";for(let s of((t=this.$meta.template)==null?void 0:t.directives)||[])if(s instanceof f){let i=this.shadowRoot.getElementById(String(s.propertyName));this[s.propertyName]=i,i==null||i.removeAttribute("id")}this.$styles=document.createElement("style"),this.$styles.innerHTML=this.$meta.styles.trim(),this.shadowRoot.insertBefore(this.$styles,this.shadowRoot.firstChild)}static register(){}static get observedAttributes(){return A(this).observedAttributes}set styles(e){this.$styles.innerHTML=e}get styles(){return this.$styles.innerHTML}$upgradeProperties(){Object.keys(this.$meta.observed).forEach(e=>{let t=`__${e}`;this.hasOwnProperty(e)&&(this[t]=this[e],delete this[e])})}coercedValue(e,t){switch(this.$meta.observed[e].type){case"boolean":return!!t;case"number":let s=Number(t);return isNaN(s)?null:s;case"string":default:return t}}attr(e,t){if(t===void 0)switch(this.$meta.observed[e].type){case"boolean":return this.coercedValue(e,this.hasAttribute(e)?"true":"");case"number":case"string":default:return this.coercedValue(e,this.getAttribute(e))}else switch(this.$meta.observed[e].type){case"boolean":t?this.setAttribute(e,"true"):this.removeAttribute(e);break;case"number":this.setAttribute(e,t.toString());break;case"string":default:this.setAttribute(e,t)}return this}initalizeAttributes(){if(this.$_initialized)return{};this.$_initialized=!0;let e={};return this.$meta.observedAttributes.forEach(t=>{let s=`__${t}`,i=`_${t}`;this[s]!==void 0&&(this[i]=this[s],delete this[s]),this.attr(t,this[i]),e[t]={oldValue:void 0,newValue:this[i]}}),this.$meta.observedProperties.forEach(t=>{let s=`__${t}`,i=`_${t}`;this[s]!==void 0&&(this[i]=this[s],delete this[s]),e[t]={oldValue:void 0,newValue:this[i]}}),e}connectedCallback(){let e=this.initalizeAttributes();this.enter(),this.update(e),this.$dispatch.flush(),this.$dispatchHandle=this.$dispatch.attach(t=>{if(this.isConnected){let s={};if(t.length>1)throw new Error("Conflation issue.");for(let i in t[0].changes){let o=t[0].changes[i];(o==null?void 0:o.oldValue)!==(o==null?void 0:o.newValue)&&(s[i]=o)}Object.keys(s).length&&this.update(s)}})}disconnectedCallback(){this.$dispatchHandle.release(),this.exit()}adoptedCallback(){}attributeChangedCallback(e,t,s){let i=`_${e}`,o=this.coercedValue(e,s);if(this[i]!==o){let c=this[i];this[i]=o,this._fire(e,c,o)}}enter(){if(window.__hpcc_debug)for(let e of this.$meta.observedAttributes)this[e]!==this.attr(e)&&console.error("enter sync error",e,this[e],this.attr(e))}update(e){if(window.__hpcc_debug)for(let t of this.$meta.observedAttributes)this[t]!==this.attr(t)&&console.error("update sync error",t,this[t],this.attr(t))}exit(){}$emit(e,t,s){let i={detail:t,...U,...s};if(this.isConnected){let o=new CustomEvent(e,i);return o.simulated=!0,this.dispatchEvent(o)}return!!i.cancelable}};globalThis["@hpcc-js/core/meta"]=globalThis["@hpcc-js/core/meta"]||new WeakMap;globalThis["@hpcc-js/core/metaByName"]=globalThis["@hpcc-js/core/metaByName"]||{};var C=globalThis["@hpcc-js/core/meta"],L=globalThis["@hpcc-js/core/metaByName"];function k(n){let r;return C.has(n)?r=C.get(n):(r={tag:"",template:{html:"",directives:[]},styles:"",properties:[],observedAttributes:[],observedProperties:[],observed:{},events:[]},C.set(n,r),L[n.name]=r),r}function A(n){return typeof n=="string"?L[n]:C.get(n)}function H(n){return k(Object.getPrototypeOf(n).constructor)}function I(n,r){let{template:e={html:"",directives:[]},styles:t="",events:s=[]}=r||{};function i(o){let c=k(o),a=[],E=o;for(;a=a.concat(k(E).properties),E!==m;)E=Object.getPrototypeOf(E);c.tag=n,c.template=e,c.styles=t,c.observedAttributes=a.filter(p=>p.isAttribute).map(p=>p.name),c.observedProperties=a.filter(p=>!p.isAttribute).map(p=>p.name),c.observed={},c.events=s,a.forEach(p=>c.observed[p.name]=p),customElements==null||customElements.define(n,o)}return i}function B(n,r){if(r.name!==r.name.toLowerCase())throw new Error(`Attributes must be lowercase: ${n.constructor.name}.${r.name}`);k(n.constructor).properties.push(r);let t=`_${r.name}`;Object.defineProperty(n,r.name,{set:function(s){let i=this[t];this[t]=s,this._fire(r.name,i,s),r.isAttribute&&this.isConnected&&this.attr(r.name,s)},get:function(){return this[t]}})}function q(n,r,e){let t={name:e!=null?e:"",type:"string",isAttribute:n,...e===void 0?r:{}};function s(i,o){B(i,{...t,name:o})}if(e===void 0)return s;s(r,e)}function u(n,r){return q(!0,n,r)}var b=class extends m{constructor(){super(...arguments);this._prevSize={width:0,height:0};this.observer=new ResizeObserver(()=>{let e={width:this.clientWidth,height:this.clientHeight};this._fire("resize",this._prevSize,e),this._prevSize=e})}connectedCallback(){super.connectedCallback(),this.observer.observe(this)}disconnectedCallback(){this.observer.unobserve(this),super.disconnectedCallback()}};var W=T`\
<hpcc-splitpanel orientation="vertical" ${l("_splitter")} style="width:100%">
    <div ${l("_iframeDiv")} data-border_width=0 data-padding=0 style="width:100%;height:100%;padding:0px"></div>
    <hpcc-codemirror ${l("_cm")} data-border_width=0 data-padding=0></hpcc-codemirror>
</hpcc-splitpanel>
<slot ${l("_slot")}></slot>
`,K=y`
${S("inline-block")} 

:host > slot {
    display: none;
}
`,g=class extends b{constructor(){super();this.preview_border="1px solid #ccc";this.content="";this.content_selector="";this._vitepress=!1;this._head="";this._scripts=[]}slotChanged(){let e=this.content_selector?this.querySelectorAll(`${this.content_selector}`):this._slot.assignedElements(),t="";for(let s=0;s<e.length;++s){let i=e[s];t+=this.content_selector?i.innerText:i.outerHTML}this.content=t}enter(){super.enter(),this.slotChanged(),this._slot.addEventListener("slotchange",()=>this.slotChanged()),this._cm.text=this.content}update(e){var t,s,i;super.update(e),e.content&&(this._iframeDiv.innerHTML="",this._iframe=document.createElement("iframe"),this._iframe.style.border=this.preview_border,this._iframe.style.display="inline-block",this._iframe.width="100%",this._iframe.height="100%",this._iframeDiv.append(this._iframe),(t=this._iframe.contentWindow)==null||t.document.open(),(s=this._iframe.contentWindow)==null||s.document.write(this.content),(i=this._iframe.contentWindow)==null||i.document.close(),this._iframe.addEventListener("load",o=>{let c=document.createElement("style");c.textContent="body { margin: 0px }",o.target.contentDocument.head.appendChild(c)})),this._splitter.style.width="100%",this._splitter.style.height=`${this.clientHeight}px`,this._cm.style.width="100%",this._cm.style.height="100%"}exit(){this._slot.removeEventListener("slotchange",()=>this.slotChanged()),super.exit()}};h([u],g.prototype,"preview_border",2),h([u],g.prototype,"content",2),h([u],g.prototype,"content_selector",2),g=h([I("hpcc-preview",{template:W,styles:K})],g);var X={"@hpcc-js/wc-core":"/components/core/src/index.ts","@hpcc-js/wc-editor":"/components/editor/src/index.ts","@hpcc-js/wc-gauge":"/components/gauge/src/index.ts","@hpcc-js/wc-layout":"/components/layout/src/index.ts","@hpcc-js/wc-legacy":"/components/legacy/src/index.ts","@hpcc-js/wc-observable":"/components/observable/src/index.ts","@hpcc-js/wc-pie":"/components/pie/src/index.ts","@hpcc-js/wc-preview":"/components/preview/src/index.ts","@hpcc-js/wc-sankey":"/components/sankey/src/index.ts","@hpcc-js/wc-treemap":"/components/treemap/src/index.ts","@hpcc-js/util":"/packages/util/src/index.ts","@hpcc-js/common":"/packages/common/src/index.ts","@hpcc-js/api":"/packages/api/src/index.ts","@hpcc-js/chart":"/packages/chart/src/index.ts","@hpcc-js/codemirror":"/packages/codemirror/src/index.ts","@hpcc-js/dgrid":"/packages/dgrid/src/index.ts","@hpcc-js/dgrid2":"/packages/dgrid2/src/index.ts","@hpcc-js/graph":"/packages/graph/src/index.ts","@hpcc-js/layout":"/packages/layout/src/index.ts","@hpcc-js/map":"/packages/map/src/index.ts","@hpcc-js/map-deck":"/packages/map-deck/src/index.ts","@hpcc-js/observablehq-compiler":"/packages/observablehq-compiler/src/index.ts","@hpcc-js/observable-md":"/packages/observable-md/src/index.ts","@hpcc-js/react":"/packages/react/src/index.ts","@hpcc-js/timeline":"/packages/timeline/src/index.ts","@hpcc-js/tree":"/packages/tree/src/index.ts"},G={"@hpcc-js/wc-core":"/Visualization/assets/wc-core.js","@hpcc-js/wc-editor":"/Visualization/assets/wc-editor.js","@hpcc-js/wc-gauge":"/Visualization/assets/wc-gauge.js","@hpcc-js/wc-layout":"/Visualization/assets/wc-layout.js","@hpcc-js/wc-legacy":"/Visualization/assets/wc-legacy.js","@hpcc-js/wc-observable":"/Visualization/assets/wc-observable.js","@hpcc-js/wc-pie":"/Visualization/assets/wc-pie.js","@hpcc-js/wc-preview":"/Visualization/assets/wc-preview.js","@hpcc-js/wc-sankey":"/Visualization/assets/wc-sankey.js","@hpcc-js/wc-treemap":"/Visualization/assets/wc-treemap.js","@hpcc-js/util":"/Visualization/assets/util.js","@hpcc-js/common":"/Visualization/assets/common.js","@hpcc-js/api":"/packages/assets/api.js","@hpcc-js/chart":"/Visualization/assets/chart.js","@hpcc-js/codemirror":"/Visualization/assets/codemirror.js","@hpcc-js/dgrid":"/Visualization/assets/dgrid.js","@hpcc-js/dgrid2":"/Visualization/assets/dgrid2.js","@hpcc-js/graph":"/Visualization/assets/graph.js","@hpcc-js/layout":"/Visualization/assets/layout.js","@hpcc-js/map":"/Visualization/assets/map.js","@hpcc-js/map-deck":"/Visualization/assets/map-deck.js","@hpcc-js/observablehq-compiler":"/Visualization/assets/observablehq-compiler.js","@hpcc-js/observable-md":"/Visualization/assets/observable-md.js","@hpcc-js/react":"/Visualization/assets/react.js","@hpcc-js/timeline":"/Visualization/assets/timeline.js","@hpcc-js/tree":"/Visualization/assets/tree.js"};function J(n,r){let e=n?X:G,t={script:r,css:""};for(let s in e)if(e.hasOwnProperty(s)){let i=t.script.split(`"${s}"`);t.script=i.join(`"${e[s]}"`),!n&&i.length>1&&(t.css+=`<link rel="stylesheet" href="${e[s].split(".js").join(".css")}">
`)}return t}var Q=T`\
<div ${l("_iframeDiv")}>
</div>
<hpcc-codemirror ${l("_cm")}></hpcc-codemirror>`,Y=y`
${S("inline-block")} 

:host > div {
    flex-direction: column;
}

:host > div > div {
    padding-bottom: 4px;
}

:host > div > hpcc-codemirror {
    padding-top: 4px;
}
`,d=class extends b{constructor(){super(...arguments);this.preview_border="1px solid #ccc";this.head_ext="";this.content="";this.preview_height_ratio=2/3;this._vitepress=!1;this._head="";this._scripts=[]}gatherScripts(e,t){Array.prototype.slice.call(e.children,0).filter(s=>s!==this).filter(s=>s.tagName!=="hpcc-preview".toUpperCase()).forEach(s=>{s.tagName==="SCRIPT"&&(s.src.indexOf("/@fs/")>=0&&(this._vitepress=!0),t.push(s.outerHTML.toString()))})}enter(){var t;super.enter(),this._head=document.head.innerHTML.toString();let e=this.getElementsByTagName("code")[0];this._cm.text=(t=e==null?void 0:e.innerText)!=null?t:""+this.innerHTML,this.gatherScripts(document.body,this._scripts),this._cm.addEventListener("change",()=>{this.content=this._cm.text.trim()})}update(e){var t,s,i;if(super.update(e),e.content){let o=J(this._vitepress,this._cm.text);this._iframeDiv.innerHTML="",this._iframe=document.createElement("iframe"),this._iframe.style.border=this.preview_border,this._iframe.width="100%",this._iframe.height=`${this.clientHeight*this.preview_height_ratio}`,this._iframeDiv.append(this._iframe),(t=this._iframe.contentWindow)==null||t.document.open(),(s=this._iframe.contentWindow)==null||s.document.write(`<head>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@hpcc-js/common@2.65.0/font-awesome/css/font-awesome.min.css">
    ${o.css}
    <style>
        body {
            margin: 0;
        }
    </style>
</head>

<body style="overflow:hidden">

<div id="preview">
${o.script}
</div>

<script type="module">
    customElements.whenDefined("hpcc-preview").then(() => {
        document.getElementById("preview").style.visibility = "visible";
    });  
<\/script>

</body>`),(i=this._iframe.contentWindow)==null||i.document.close()}this._cm.style.width="100%",this._cm.style.height=`${this.clientHeight*(1-this.preview_height_ratio)}px`}};h([u],d.prototype,"preview_border",2),h([u],d.prototype,"head_ext",2),h([u],d.prototype,"content",2),h([u],d.prototype,"preview_height_ratio",2),d=h([I("hpcc-vitepress",{template:Q,styles:Y})],d);export{g as HPCCPreviewElement,d as HPCCVitepressElement};
//# sourceMappingURL=wc-preview.js.map
