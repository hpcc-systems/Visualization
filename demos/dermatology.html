<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>HPCC Systems - Dermatology Test</title>
    <link rel="stylesheet" href="test.css" />
    <script src="https://google-code-prettify.googlecode.com/svn/loader/prettify.js"></script>
    <script src="../widgets/lib/requirejs/require.js"></script>
    <script src="../widgets/config.js"></script>
    <script>
        requirejs.config({
            baseUrl: "../widgets"
        });
    </script>
</head>
<body>
    <p>
        <prompt>Widget To Test:</prompt>
        <select id="widgetSelect" onchange="testWidget(this.value);">
            <option value="src/common/Shape">Shape</option>
            <option value="src/common/Text">Text</option>
            <option value="src/common/TextBox">TextBox</option>
            <option value="src/common/FAChar">FAChar</option>
            <option value="src/common/Icon">Icon</option>
            <option value="src/common/List">List</option>
            <option value="src/common/Menu">Menu</option>
            <option value="src/common/Surface">Surface</option>
            <option value="src/c3/Bar">C3 Bar</option>
            <option value="src/c3/Column">C3 Column</option>
            <option value="src/c3/Line">C3 Line</option>
            <option value="src/c3/Pie">C3 Pie</option>
            <option value="src/c3/Donut">C3 Donut</option>
            <option value="src/c3/Gauge">C3 Gauge</option>
            <option value="src/map/ChoroplethStates">US States</option>
            <option value="src/map/ChoroplethCounties">US Counties</option>
            <option value="src/google/Pie">Google Pie</option>
            <option value="src/google/Bar">Google Bar</option>
            <option value="src/map/ChoroplethStates">Choropleth States</option>
            <option value="src/map/ChoroplethCounties">Choropleth Counties</option>
            <option value="src/map/ChoroplethCountries">Choropleth Countries</option>
            <option value="src/other/Legend">Legend</option>
        </select>
    </p>
    <table style="width:auto">
        <thead>
            <tr>
                <th>Serialize/Deserialize</th>
                <th>Properties</th>
                <th>Source Code</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td align="center" valign="top">
                    <table border="0">
                        <tbody>
                            <tr>
                                <td style="text-align:center;border-bottom:none">
                                    <div id="source" class="large wide thumb"></div>
                                    <br />
                                    <b>Original</b>
                                </td>
                            </tr>
                            <tr>
                                <td style="text-align:center;border-bottom:none">
                                    <div id="target" class="large wide thumb"></div>
                                    <br />
                                    <b>Clone</b>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </td>
                <td align="center" valign="top">
                    <table>
                        <thead align="left">
                            <tr>
                                <th>Key</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody id="props"></tbody>
                    </table>
                </td>
                <td valign="top">
                    <pre id="github" class="prettyprint"></pre>
                </td>
            </tr>
        </tbody>
    </table>
    <script>
        var testWidget = null;
        var cloneWidget = null;
        require(["src/other/Persist"], function (Persist) {

            function serializeTest(source, target) {
                document.getElementById("target").innerHTML = "";
                Persist.clone(source, function (widget) {
                    cloneWidget = widget
                        .target("target")
                        //.testData()
                        .render()
                    ;
                });
            }
            function displayProperties(sourceWidget) {
                var props = Persist.discover(sourceWidget);
                var propsTable = props.map(function (row) {
                    var tr = document.getElementById("props").appendChild(document.createElement('tr'));
                    var td = tr.appendChild(document.createElement('td'));
                    td.appendChild(document.createTextNode(row.id));
                    td = tr.appendChild(document.createElement('td'));
                    switch (row.type) {
                        case "boolean":
                            var checkbox = document.createElement('input');
                            checkbox.type = "checkbox";
                            var input = td.appendChild(checkbox);
                            input.checked = sourceWidget[row.id]();
                            input.onchange = function () {
                                sourceWidget[row.id](input.checked).render();
                                serializeTest(sourceWidget)
                            }
                            break;
                        case "number":
                            var input = td.appendChild(document.createElement("input"));
                            input.value = sourceWidget[row.id]();
                            input.onchange = function () {
                                sourceWidget[row.id](input.value).render();
                                serializeTest(sourceWidget)
                            }
                            break;
                        case "string":
                            var input = td.appendChild(document.createElement("input"));
                            input.value = sourceWidget[row.id]();
                            input.onchange = function () {
                                sourceWidget[row.id](input.value).render();
                                serializeTest(sourceWidget)
                            }
                            break;
                        case "html-color":
                            var input = td.appendChild(document.createElement("input"));
                            input.type = 'color';
                            input.value = sourceWidget[row.id]();
                            input.onchange = function () {
                                sourceWidget[row.id](input.value).render();
                                serializeTest(sourceWidget)
                            }
                            break;
                        case "set":
                            var select = td.appendChild(document.createElement('select'));
                            row.options.forEach(function (item) {
                                var option = select.appendChild(document.createElement("option"));
                                option.value = item;
                                option.text = item;
                            });
                            select.value = sourceWidget[row.id]();
                            select.onchange = function () {
                                sourceWidget[row.id](select.value).render();
                                serializeTest(sourceWidget)
                            }
                            break;
                        default:
                            break;
                    }
                });
                var tr = document.getElementById("props").appendChild(document.createElement('tr'));
                var td = tr.appendChild(document.createElement('td'));
                td.appendChild(document.createTextNode("data_columns"));
                td = tr.appendChild(document.createElement('td'));
                var input = td.appendChild(document.createElement("textarea"));
                input.setAttribute("rows", "4");
                input.setAttribute("cols", "25");
                input.value = JSON.stringify(sourceWidget._columns);
                input.onchange = function () {
                    sourceWidget
                        .columns(JSON.parse(input.value))
                        .render()
                    ;
                    cloneWidget
                        .columns(sourceWidget.columns())
                        .render()
                    ;
                }
                var tr = document.getElementById("props").appendChild(document.createElement('tr'));
                var td = tr.appendChild(document.createElement('td'));
                td.appendChild(document.createTextNode("data_data"));
                td = tr.appendChild(document.createElement('td'));
                var input2 = td.appendChild(document.createElement("textarea"));
                input2.setAttribute("rows", "4");
                input2.setAttribute("cols", "25");
                input2.value = JSON.stringify(sourceWidget._data);
                input2.onchange = function () {
                    sourceWidget
                        .data(JSON.parse(input2.value))
                        .render()
                    ;
                    cloneWidget
                        .data(sourceWidget.data())
                        .render()
                    ;
                }
            }
            testWidget = function (widgetPath) {
                require([widgetPath], function (Widget) {
                    try {
                        require(["text!" + widgetPath + ".js"], function (src) {
                            document.getElementById("github").setAttribute("class", "prettyprint");
                            document.getElementById("github").innerText = src;
                            prettyPrint();
                        });
                    } catch (e) {
                    }
                    document.getElementById("source").innerHTML = "";
                    var sourceWidget = new Widget()
                        .target("source")
                        .testData()
                        .render()
                    ;
                    /*
                    var targetWidget = new Widget()
                        .target("target")
                        .testData()
                    ;
                    */
                    serializeTest(sourceWidget);
                    document.getElementById("props").innerHTML = "";
                    displayProperties(sourceWidget);
                    prettyPrint();
                });
            }
            testWidget(document.getElementById("widgetSelect").value);
        });
    </script>
</body>
</html>
