!function(t,e){"function"==typeof define&&define.amd?define(["d3","../common/SVGWidget","../common/Utility","css!./Axis"],e):t.chart_Axis=e(t.d3,t.common_SVGWidget,t.common_Utility)}(this,function(t,e,i){function s(){e.call(this),this._drawStartPos="origin",this.d3Axis=t.svg.axis(),this.d3Guides=t.svg.axis(),this.type("linear").timePattern(this.timePattern())}s.prototype=Object.create(e.prototype),s.prototype.constructor=s,s.prototype._class+=" chart_Axis",s.prototype.publish("title","","string","Title"),s.prototype.publish("orientation","bottom","set","Orientation",["left","top","right","bottom"]),s.prototype.publish("type","ordinal","set","Type",["none","ordinal","linear","pow","log","time"]),s.prototype.publish("timePattern","%Y-%m-%d","string","Time Series Pattern",null,{disable:function(t){return"time"!==t.type()}}),s.prototype.publish("powExponent",2,"number","Exponent for Pow on Value Axis",null,{disable:function(t){return"pow"!==t.type()}}),s.prototype.publish("logBase",10,"number","Base for log on Value Axis",null,{disable:function(t){return"log"!==t.type()}}),s.prototype.publish("ordinals",[],"array","Ordinal Values",null,{disable:function(t){return"ordinal"!==t.type()}}),s.prototype.publish("tickCount",null,"number","Tick Count",null,{optional:!0,disable:function(t){return"ordinal"===t.type()}}),s.prototype.publish("tickFormat",null,"string","Tick Format",null,{optional:!0,disable:function(t){return"ordinal"===t.type()}}),s.prototype.publish("tickLength",null,"number","Tick Length",{optional:!0}),s.prototype.publish("low",null,"any","Low",null,{optional:!0,disable:function(t){return"ordinal"===t.type()}}),s.prototype.publish("high",null,"any","High",null,{optional:!0,disable:function(t){return"ordinal"===t.type()}}),s.prototype.publish("overlapMode","none","set","Label Overlap Mode",["none","stagger","hide","rotate"]),s.prototype.publish("labelRotation",33,"number","Label Rotation",null,{optional:!0,disable:function(t){return"rotate"!==t.overlapMode()}}),s.prototype.publish("shrinkToFit","both","set","Size to fit",["none","low","high","both"]),s.prototype.publish("extend",5,"number","Extend axis %",{optional:!0,disable:function(t){return"ordinal"===t.type()}});var r=s.prototype.type;s.prototype.type=function(t){var e=r.apply(this,arguments);return arguments.length&&this.updateScale(),e};var a=s.prototype.timePattern;return s.prototype.timePattern=function(t){var e=a.apply(this,arguments);return arguments.length&&this.updateScale(),e},s.prototype.lowValue=function(){return this.parse(this.low())},s.prototype.highValue=function(){return this.parse(this.high())},s.prototype.parse=function(t,e){if(t instanceof Array)return t.map(function(t){return this.parse(t)},this);if(void 0!==t&&null!==t){if(this.parser)return this.parser.parse("number"==typeof t?t.toString():t);if(e&&"string"==typeof t)return+t}return t},s.prototype.parseInvert=function(t){return t instanceof Array?t.map(function(t){return this.parseInvert(t)},this):this.parser?this.parser(t):t},s.prototype.format=function(t){return t instanceof Array?t.map(function(t){return this.format(t)},this):void 0!==t&&null!==t&&this.formatter?this.formatter(t):t},s.prototype.scalePos=function(t){var e=this.d3Scale(this.parse(t));return"ordinal"===this.type()&&(e+=this.d3Scale.rangeBand()/2),e},s.prototype.isHorizontal=function(){switch(this.orientation()){case"left":case"right":return!1}return!0},s.prototype.domain=function(t){return arguments.length?(this.d3Scale.domain(t),this):this.d3Scale.domain()},s.prototype.range=function(t){if(!arguments.length){if(this.d3Scale.rangeRoundBands)return this.d3Scale.rangeExtent();if(this.d3Scale.rangeRound)return this.d3Scale.range()}return this.d3Scale.rangeRoundBands?this.d3Scale.rangeRoundBands(t,.1):this.d3Scale.rangeRound&&this.d3Scale.range(t),this},s.prototype.invert=function(t){return this.d3Scale.invert(t)},s.prototype.guideTarget=function(e){this._guideElement=t.select(e).attr("class",this._class)},s.prototype.enter=function(t,i){e.prototype.enter.apply(this,arguments),this.svg=i.append("g"),this.svgAxis=this.svg.append("g").attr("class","axis"),this.svgText=this.svgAxis.append("text"),this.svg2=(this._guideElement||i).append("g"),this.svgGuides=this.svg2.attr("class","guide")},s.prototype.updateScale=function(){switch(this.type()){case"ordinal":this.d3Scale=t.scale.ordinal(),this.ordinals_exists()&&this.d3Scale.domain(this.ordinals()),this.parser=null,this.formatter=null;break;case"linear":this.d3Scale=t.scale.linear(),this.low_exists()&&this.high_exists()&&this.d3Scale.domain([this.lowValue(),this.highValue()]),this.parser=null,this.formatter=this.tickFormat_exists()?t.format(this.tickFormat()):null;break;case"pow":this.d3Scale=t.scale.pow().exponent(this.powExponent()),this.low_exists()&&this.high_exists()&&this.d3Scale.domain([this.lowValue(),this.highValue()]),this.parser=null,this.formatter=this.tickFormat_exists()?t.format(this.tickFormat()):null;break;case"log":this.d3Scale=t.scale.log().base(this.logBase()),this.low_exists()&&this.high_exists()&&this.d3Scale.domain([this.lowValue(),this.highValue()]),this.parser=null,this.formatter=this.tickFormat_exists()?t.format(this.tickFormat()):null;break;case"time":this.d3Scale=t.time.scale(),this.low_exists()&&this.high_exists()&&this.d3Scale.domain([this.lowValue(),this.highValue()]),this.parser=this.timePattern_exists()?t.time.format(this.timePattern()):null,this.formatter=this.tickFormat_exists()?t.time.format(this.tickFormat()):null}if(this.extend())switch(this.type()){case"ordinal":break;default:var e,i,s,r;this.isHorizontal()?(e=this.width(),this.d3Scale.range([0,e]),i=e*this.extend()/100,s=this.d3Scale.invert(-i),r=this.d3Scale.invert(e+i)):(e=this.height(),this.d3Scale.range([e,0]),i=e*this.extend()/100,s=this.d3Scale.invert(e+i),r=this.d3Scale.invert(-i)),this.d3Scale.domain([s,r])}this.d3Axis.orient(this.orientation()).scale(this.d3Scale).tickFormat(this.formatter).ticks(this.tickCount()),this.d3Guides.orient(this.orientation()).scale(this.d3Scale).tickSize(-this.tickLength()).tickFormat("").ticks(this.tickCount())},s.prototype.adjustText=function(e,i){var s=this.isHorizontal(),r="left"===this.orientation(),a="bottom"===this.orientation();switch(s?this.overlapMode():"none"){case"stagger":e.selectAll(".tick > text").style("text-anchor","middle").attr("dy",function(t,e){return(a?1:-1)*((a?.71:0)+e%i)+"em"}).attr("dx",0).attr("visibility",null).attr("transform","rotate(0)");break;case"hide":e.selectAll(".tick > text").style("text-anchor","middle").attr("dy",(a?.71:0)+"em").attr("dx",0).attr("visibility",function(t,e){return e%i?"hidden":null}).attr("transform","rotate(0)");break;case"rotate":var n=-this.labelRotation()||0;if(0!==n&&i>1){e.selectAll(".tick > text").each(function(){var e=t.select(this),i=e.node().getBBox(),s=(a?1:-1)*Math.sin(Math.PI*(-Math.abs(n)/180));e.style("text-anchor",n>0?a?"start":"end":a?"end":"start").attr("dy",i.height/2*s+"px").attr("dx",n>0?a?"0.71em":"-0.71em":a?"-0.71em":"0.71em").attr("transform","rotate("+n+")").attr("visibility",null)});break}default:e.selectAll(".tick > text").style("text-anchor",s?"middle":r?"end":"start").attr("dy",s?(a?.71:0)+"em":"0.32em").attr("dx",0).attr("visibility",null).attr("transform","rotate(0)")}},s.prototype.calcTickOverlapModulus=function(t){var e=1;switch(this.overlapMode()){case"rotate":case"stagger":case"hide":var i=[];t.selectAll(".tick > text").each(function(t){for(var s=this.getBoundingClientRect(),r=i.length-1;r>=0&&!(i[r].right<s.left);--r)i.length+1-r>e&&(e=i.length+1-r);i.push(s)})}return e},s.prototype.calcOverflow=function(t,e){this.updateScale();var i=this.isHorizontal();this.range(i?[0,this.width()]:[this.height(),0]);var s=t.append("g").attr("class",this.classID()).append("g");s.attr("class",i?"x":"y").call(this.d3Axis),e&&t.selectAll(".tick > text").remove();var r={left:0,top:0,right:0,bottom:0,tickOverlapModulus:this.calcTickOverlapModulus(s)};this.adjustText(s,r.tickOverlapModulus);var a=s.node().getBBox();switch(r.depth=i?a.height:a.width,this.shrinkToFit()){case"low":case"both":r.left=i?-a.x:0,r.bottom=i?0:-(this.height()-(a.height+a.y))}switch(this.shrinkToFit()){case"high":case"both":r.top=i?0:-a.y,r.right=i?-(this.width()-a.x-a.width):0}return s.remove(),r},s.prototype.update=function(t,i){function s(t){t.attr("transform",function(t){switch(a.orientation()){case"left":return"translate("+r.depth+", "+r.top+")";case"top":return"translate(0,"+r.depth+")";case"right":return"translate("+(a.width()-r.depth)+", "+r.top+")";case"bottom":return"translate(0,"+(a.height()-r.depth)+")"}return"translate(0,0)"})}e.prototype.update.apply(this,arguments);var r=this.calcOverflow(i);this.range(this.isHorizontal()?[r.left,this.width()-r.right]:[this.height()-r.top-r.bottom,0]);var a=this;this.svg.style("visibility","none"===this.type()?"hidden":null).transition().call(s),this._guideElement&&this.svg2.transition().call(s),this.svgAxis.call(this.d3Axis),this.adjustText(this.svgAxis,r.tickOverlapModulus);var n=this.svgAxis.select("path.domain"),o=n.node().getBBox();switch(this.orientation()){case"left":this.svgText.transition().attr("transform","rotate(-90)").attr("x",-2).attr("y",2).attr("dx",null).attr("dy",".71em").style("text-anchor","end").text(this.title());break;case"right":this.svgText.transition().attr("transform","rotate(-90)").attr("x",-2).attr("y",4).attr("dx",null).attr("dy","-.71em").style("text-anchor","end").text(this.title());break;case"top":this.svgText.transition().attr("transform","rotate(0)").attr("x",o.x+o.width-2).attr("y",2).attr("dx",null).attr("dy",".71em").style("text-anchor","end").text(this.title());break;case"bottom":this.svgText.transition().attr("transform","rotate(0)").attr("x",o.x+o.width-2).attr("y",-2).attr("dx",null).attr("dy",null).style("text-anchor","end").text(this.title())}this.svgGuides.call(this.d3Guides)},s.prototype.postUpdate=function(t,i){e.prototype.postUpdate.apply(this,arguments),this._guideElement&&this._guideElement.attr("transform",this._element.attr("transform"))},s});