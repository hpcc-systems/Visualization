!function(t,e){"function"==typeof define&&define.amd?define(["d3","./Widget","./Transition"],e):t.common_HTMLWidget=e(t.d3,t.common_Widget,t.common_Transition)}(this,function(t,e,i){function o(){e.call(this),this._drawStartPos="origin",this._boundingBox=null}return o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.prototype._class+=" common_HTMLWidget",o.prototype.calcFrameWidth=function(t){var e=parseFloat(t.style("padding-left"))+parseFloat(t.style("padding-right"))+parseFloat(t.style("margin-left"))+parseFloat(t.style("margin-right"))+parseFloat(t.style("border-left-width"))+parseFloat(t.style("border-right-width"));return e},o.prototype.calcWidth=function(t){return parseFloat(t.style("width"))-this.calcFrameWidth(t)},o.prototype.calcFrameHeight=function(t){var e=parseFloat(t.style("padding-top"))+parseFloat(t.style("padding-bottom"))+parseFloat(t.style("margin-top"))+parseFloat(t.style("margin-bottom"))+parseFloat(t.style("border-top-width"))+parseFloat(t.style("border-bottom-width"));return e},o.prototype.calcHeight=function(t){return parseFloat(t.style("height"))+this.calcFrameHeight(t)},o.prototype.hasHScroll=function(t){return t=t||this._element,t.property("scrollWidth")>t.property("clientWidth")},o.prototype.hasVScroll=function(t){return t=t||this._element,t.property("scrollHeight")>t.property("clientHeight")},o.prototype.clientWidth=function(){return this._size.width-this.calcFrameWidth(this._element)},o.prototype.clientHeight=function(){return this._size.height-this.calcFrameHeight(this._element)},o.prototype.getBBox=function(t,e){if(t||null===this._boundingBox){var i=this._element.node()?this._element.node().firstElementChild:null;if(i instanceof Element){var o=i.getBoundingClientRect();this._boundingBox={x:o.left,y:o.top,width:o.width,height:o.height}}}return null===this._boundingBox?{x:0,y:0,width:0,height:0}:{x:(e?Math.round(this._boundingBox.x):this._boundingBox.x)*this._scale,y:(e?Math.round(this._boundingBox.y):this._boundingBox.y)*this._scale,width:(e?Math.round(this._boundingBox.width):this._boundingBox.width)*this._scale,height:(e?Math.round(this._boundingBox.height):this._boundingBox.height)*this._scale}},o.prototype.resize=function(t){var i=e.prototype.resize.apply(this,arguments);return this._parentElement.style("width",this._size.width+"px").style("height",this._size.height+"px"),i},o.prototype.target=function(e){if(!arguments.length)return this._target;if(this._target&&e)throw"Target can only be assigned once.";if(this._target=e,("string"==typeof this._target||this._target instanceof String)&&(this._target=document.getElementById(this._target)),this._target instanceof SVGElement){var i=this.locateOverlayNode();this._parentElement=i.append("div").style({position:"absolute",top:0,left:0,overflow:"hidden"}),this._overlayElement=t.select(this._target);var o=this;this.oldPos=null,this.observer=new this.MutationObserver(function(t){o.syncOverlay()});for(var s=this._overlayElement.node();s;)this.observer.observe(s,{attributes:!0}),s=s.parentNode}else if(this._target){if(this._parentElement=t.select(this._target),!this._size.width&&!this._size.height){var n=parseFloat(this._parentElement.style("width")),r=parseFloat(this._parentElement.style("height"));this.size({width:n,height:r})}this._parentElement=t.select(this._target).append("div")}else this.exit();return this},o.prototype.postUpdate=function(t,i){if(e.prototype.postUpdate.apply(this,arguments),"origin"===this._drawStartPos)this._element.style({position:"relative",left:this._pos.x+"px",top:this._pos.y+"px"});else{var o=this.getBBox(!0);this._element.style({position:"relative","float":"left",left:this._pos.x+(this._size.width-o.width)/2+"px",top:this._pos.y+(this._size.height-o.height)/2+"px"})}},o.prototype.exit=function(t,i){this.observer&&this.observer.disconnect(),this.oldPos=null,this._parentElement&&this._parentElement.remove(),e.prototype.exit.apply(this,arguments)},o});