!function(t,e){"function"==typeof define&&define.amd?define(["d3","./SVGWidget","./Icon","./Shape","./Text","./FAChar","./Menu","css!./Surface"],e):t.common_Surface=e(t.d3,t.common_SVGWidget,t.common_Icon,t.common_Shape,t.common_Text,t.common_FAChar,t.common_Menu)}(this,function(t,e,n,i,o,s,h){function a(){e.call(this),this._icon=(new n).faChar("ï»").paddingPercent(50),this._container=(new i)["class"]("container").shape("rect"),this._titleRect=(new i)["class"]("title").shape("rect"),this._text=(new o)["class"]("title"),this._menu=(new h).paddingPercent(0);var t=this;this._menu.preShowMenu=function(){t.content()&&t.content().hasOverlay()&&t.content().visible(!1)},this._menu.postHideMenu=function(){t.content()&&t.content().hasOverlay()&&t.content().visible(!0)},this._surfaceButtons=[]}return a.prototype=Object.create(e.prototype),a.prototype.constructor=a,a.prototype._class+=" common_Surface",a.prototype.publish("showTitle",!0,"boolean","Show Title",null,{tags:["Basic"]}),a.prototype.publish("title","","string","Title",null,{tags:["Basic"]}),a.prototype.publishProxy("titleFontSize","_text","fontSize"),a.prototype.publish("showIcon",!0,"boolean","Show Title",null,{tags:["Advanced"]}),a.prototype.publishProxy("icon_faChar","_icon","faChar"),a.prototype.publishProxy("icon_shape","_icon","shape"),a.prototype.publish("content",null,"widget","Content",null,{tags:["Private"]}),a.prototype.publish("buttonAnnotations",[],"array","Button Array",null,{tags:["Intermediate"]}),a.prototype.publish("buttonGutter",25,"number","Space Between Menu and Buttons",null,{tags:["Intermediate"]}),a.prototype.publish("showContent",!0,"boolean","Show Content",null,{tags:["Intermediate"]}),a.prototype.publish("menu",[],"array","Menu List Data",null,{tags:["Intermediate"]}),a.prototype.publish("menuPadding",2,"number","Menu Padding",null,{tags:["Advanced"]}),a.prototype._origMenuParam=a.prototype.menu,a.prototype.menu=function(t){return a.prototype._origMenuParam.apply(this,arguments),arguments.length?(this._menu.data(t),this):this._menu.data()},a.prototype._origShowContent=a.prototype.showContent,a.prototype.showContent=function(t){var e=a.prototype._origShowContent.apply(this,arguments);return arguments.length&&this.content()&&this.content().visible(this.showContent()),e},a.prototype.enter=function(n,i){e.prototype.enter.apply(this,arguments);var o=i.append("g").attr("class","frame"),s=o.node();this._clipRect=o.append("defs").append("clipPath").attr("id",this.id()+"_clip").append("rect").attr("x",0).attr("y",0).attr("width",this._size.width).attr("height",this._size.height),this._titleRect.target(s).render().display(this.showTitle()&&this.showIcon()),this._icon.target(s).render(),this._menu.target(n),this._text.target(s),this._container.target(s),this.buttonContainer=t.select(this._target).append("div").attr("class","svg-button-container")},a.prototype.update=function(n,i){e.prototype.update.apply(this,arguments);var o=this,s=this.width()-1,h=this.height()-1;this._icon.display(this.showTitle()&&this.showIcon()).shape(this.icon_shape()).render(),this._menu.render(),this._text.text(this.title()).display(this.showTitle()).render();var a=this.buttonContainer.selectAll(".surface-button").data(this.buttonAnnotations());a.enter().append("button").attr("class","surface-button").each(function(e,n){var i=o._surfaceButtons[n]=t.select(this).attr("class","surface-button "+(e["class"]?e["class"]:"")).attr("id",e.id).style("padding",e.padding).style("width",e.width).style("height",e.height).style("cursor","pointer").on("click",function(t){o.click(t)});"FontAwesome"===e.font?i.append("i").attr("class","fa").text(function(t){return e.label}):i.text(function(t){return e.label})}),a.exit().each(function(e,n){var i=t.select(this);delete o._surfaceButtons[n],i.remove()});var r=this.showTitle()?Math.max.apply(null,this._surfaceButtons.map(function(t){return t.node().offsetHeight})):0,l=this.showTitle()&&this.showIcon()?this._icon.getBBox(!0):{width:0,height:0},c=this._text.getBBox(!0),p=this._menu.getBBox(!0),u=Math.max(l.height,c.height,p.height,r),d=this.showTitle()?u:0,g=(-h+u)/2,_=this.showTitle()?Math.max(c.height,p.height,r):0,m=_>=d?0:(d-_)/2,y=m;this._titleRect.pos({x:y,y:g}).width(s-2*y).height(_).display(this.showTitle()).render(),this._icon.move({x:-s/2+l.width/2,y:g}),this._menu.move({x:s/2-p.width/2-this.menuPadding(),y:g}),this._text.move({x:(l.width/2-p.width/2)/2,y:g});var f=o._titleRect.node().getBoundingClientRect().left+(o._size.width-2*y)-o.buttonGutter()-this.buttonContainer.node().offsetWidth,w=o._titleRect.node().getBoundingClientRect().top+(_-this.buttonContainer.node().offsetHeight)/2;if(isNaN(f)||this.buttonContainer.style("left",f+"px"),isNaN(w)||this.buttonContainer.style("top",w+"px"),this.showTitle()?this._container.pos({x:y/2,y:d/2-m/2}).width(s-y).height(h-d+m).render():this._container.pos({x:0,y:0}).width(s).height(h).render(),this.showContent()){var b=y,x=d-m,v=i.selectAll(".content").data(this.content()?[this.content()]:[],function(t){return t._id});v.enter().append("g").attr("class","content").attr("clip-path","url(#"+this.id()+"_clip)").each(function(t){t.target(this)}),v.attr("transform","translate("+y/2+", "+(d/2-m/2)+")").each(function(t){var e={left:0,top:0,right:1,bottom:1};t.resize({width:s-b-(e.left+e.right),height:h-x-(e.top+e.bottom)})}),this.content()&&this._clipRect.attr("x",-(s-b)/2).attr("y",-(h-x)/2).attr("width",s-b).attr("height",h-x),v.exit().transition().each(function(t){t.target(null)}).remove()}this._menu.element()&&this._menu.element().node()&&this._menu.element().node().parentNode&&this._menu.element().node().parentNode.appendChild(this._menu.element().node())},a.prototype.exit=function(t,n){this._titleRect.target(null),this._icon.target(null),this._menu.target(null),this._text.target(null),this._container.target(null),this.content()&&this.content().target(null),e.prototype.exit.apply(this,arguments)},a.prototype.intersection=function(t,e){var n=[],i=this._icon.intersection(t,e,this._pos);i&&n.push({i:i,d:this.distance(i,e)});var o=this._titleRect.intersection(t,e);o&&n.push({i:o,d:this.distance(o,e)});var s=this._container.intersection(t,e);s&&n.push({i:s,d:this.distance(s,e)});var h=null;return n.forEach(function(t){(null===h||h.d>t.d)&&(h=t)}),h&&h.i?h.i:null},a.prototype.click=function(t,e){console.log("Clicked: "+t.id)},a});