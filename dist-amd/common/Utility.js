!function(e,t){"function"==typeof define&&define.amd?define(["d3","require","es6-promise"],t):e.common_Utility=t(e.d3,e.require)}(this,function(e,t){function n(e,t,n,i,r){var o,s,c=/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,a=/(^[ ]*|[ ]*$)/g,l=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,u=/^0x[0-9a-f]+$/i,d=/^0/,p=function(e){return!r&&(""+e).toLowerCase()||""+e},f=p(i?e[i]:e).replace(a,"")||"",h=p(i?t[i]:t).replace(a,"")||"",m=f.replace(c,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),g=h.replace(c,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),v=parseInt(f.match(u),16)||1!==m.length&&f.match(l)&&Date.parse(f),w=parseInt(h.match(u),16)||v&&h.match(l)&&Date.parse(h)||null;if(w){if(w>v)return"ascending"===n?-1:1;if(v>w)return"ascending"===n?1:-1}for(var y=0,_=Math.max(m.length,g.length);_>y;y++){if(o=!(m[y]||"").match(d)&&parseFloat(m[y])||m[y]||0,s=!(g[y]||"").match(d)&&parseFloat(g[y])||g[y]||0,isNaN(o)!==isNaN(s))return isNaN(o)?1:-1;if(typeof o!=typeof s&&(o+="",s+=""),s>o)return"ascending"===n?-1:1;if(o>s)return"ascending"===n?1:-1}return 0}function i(){this.items={}}function r(e,t){this.widgetElement(e),this.skipBringToTop(t)}function o(e){this._selection=new r(null,e)}function s(e){return"[object Array]"===Object.prototype.toString.call(e)}function c(e){var t;if(2===arguments.length&&"object"==typeof arguments[1])t=arguments[1];else{t=new Array(arguments.length-1);for(var n=1;n<arguments.length;++n)t[n-1]=arguments[n]}t&&t.hasOwnProperty||(t={});for(var i in t)s(t[i])&&t[i].forEach(function(e,n){t[i+"["+n+"]"]=e});return e.replace(u,function(n,i,r){var o;return"{"===e[r-1]&&"}"===e[r+n.length]?i:(o=t.hasOwnProperty(i)?t[i]:null,null===o||void 0===o?"":o)})}i.prototype.clear=function(){for(var e in this.items)this.items[e].element().classed("selected",!1);this.items={}},i.prototype.isEmpty=function(){for(var e in this.items)return!1;return!0},i.prototype.append=function(e){this.items[e._id]=e,e.element().classed("selected",!0)},i.prototype.remove=function(e){this.items[e._id].element().classed("selected",!1),delete this.items[e._id]},i.prototype.isSelected=function(e){return void 0!==this.items[e._id]},i.prototype.get=function(){var e=[];for(var t in this.items)e.push(this.items[t]);return e},i.prototype.set=function(e){this.clear(),e.forEach(function(e,t){this.append(e)},this)},i.prototype.click=function(e,t){t.ctrlKey?this.items[e._id]?this.remove(e):this.append(e):(this.clear(),this.append(e))},r.prototype.widgetElement=function(e){return arguments.length?(this._widgetElement=e,this):this._widgetElement},r.prototype.skipBringToTop=function(e){return arguments.length?(this._skipBringToTop=e,this):this._skipBringToTop},r.prototype.enter=function(t){var n=this;t.each(function(t){var i=n._initialSelection?n._initialSelection.indexOf(JSON.stringify(t))>=0:!1;e.select(this).classed("selected",i).classed("deselected",!i)}).on("click.SimpleSelection",function(t,i){n._skipBringToTop||this.parentNode.appendChild(this);var r=e.select(this),o=r.classed("selected");n._widgetElement.selectAll(".selected").classed("selected",!1).classed("deselected",!0),o||r.classed("selected",!0).classed("deselected",!1)}).on("mouseover.SimpleSelection",function(t,n){e.select(this).classed("over",!0)}).on("mouseout.SimpleSelection",function(t,n){e.select(this).classed("over",null)})},r.prototype.selected=function(t){return e.select(t).classed("selected")},r.prototype.selection=function(t){if(!arguments.length){var n=[];return this._widgetElement&&this._widgetElement.selectAll(".selected").each(function(e){n.push(JSON.stringify(e))}),n}return this._widgetElement?this._widgetElement.selectAll(".selected,.deselected").each(function(n){var i=t.indexOf(JSON.stringify(n))>=0;e.select(this).classed("selected",i).classed("deselected",!i)}):this._initialSelection=t,this},o.prototype.serializeState=function(){return{selection:this._selection.selection(),data:this.data()}},o.prototype.deserializeState=function(e){return e&&(this._selection.selection(e.selection),e.data&&this.data(e.data)),this};var a=window.performance,l=a&&(a.now||a.mozNow||a.msNow||a.oNow||a.webkitNow),u=/\{([0-9a-zA-Z_\[\]]+)\}/g;return{naturalSort:function(e,t,i,r){return e.slice(0).sort(function(e,o){return n(e,o,t,i,r)})},multiSort:function(t,n){return n&&n.length&&t.sort(function(t,i){for(var r=0;r<n.length;++r){var o=t[n[r].idx],s=i[n[r].idx];if(o!==s)return n[r].reverse?e.descending(o,s):e.ascending(o,s)}return 0}),t},Selection:i,SimpleSelection:r,SimpleSelectionMixin:o,urlParams:function(){var e=window.location.search.split("?")[1],t={};return e&&e.split("&").forEach(function(e,n){var i=e.split("=");switch(i.length){case 1:t[decodeURIComponent(i[0])]=void 0;break;case 2:t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]);break;default:throw"Invalid URL Param:  "+e}}),t},endsWith:function(e,t,n){var i=e.toString();("number"!=typeof n||!isFinite(n)||Math.floor(n)!==n||n>i.length)&&(n=i.length),n-=t.length;var r=i.indexOf(t,n);return-1!==r&&r===n},d3ArrayAdapter:function(e){return{ownerDocument:{createElement:function(t){return{get __data__(){return this.row},set __data__(t){this.row=e[this.index]=t}}},createElementNS:function(e,t){return this.createElement(t)}},querySelectorAll:function(t){if(t)throw"unsupported";var n=this;return e.map(function(t,i){return{ownerDocument:n.ownerDocument,parentNode:n,get __data__(){return t},set __data__(t){e[i]=t}}})},appendChild:function(t){return t.parentNode=this,t.index=e.length,e.push(null),t},insertBefore:function(t,n){var i=e.indexOf(t.__data__),r=e.indexOf(n.__data__);return i>r?e.splice(r,0,e.splice(i,1)[0]):r-1>i&&e.splice(r-1,0,e.splice(i,1)[0]),t},removeChild:function(t){return e.splice(e.indexOf(t.__data__),1),t}}},downloadBlob:function(t,n,i,r){var o=new Date,s=e.time.format("%Y-%m-%dT%H_%M_%S"),c=s(o);i=i||"data_"+c+"."+t.toLowerCase();var a=i+(r?"."+r:""),l="";switch(t){case"TSV":l="text/tab-seperated-values";break;case"JSON":l="application/json";break;default:l="text/csv"}var u=document.createElement("a");if(navigator.msSaveBlob)return u=null,navigator.msSaveBlob(new Blob([n],{type:l}),a);if("download"in u)return u.href="data:"+l+","+encodeURIComponent(n),u.setAttribute("download",a),document.body.appendChild(u),setTimeout(function(){u.click(),document.body.removeChild(u)},10),!0;u=null;var d=document.createElement("iframe");return document.body.appendChild(d),d.src="data:"+l+","+encodeURIComponent(n),setTimeout(function(){document.body.removeChild(d)},100),!0},widgetPath:function(e){return"../"+e.split("_").join("/")},parseClassID:function(e,t){t=t||"..";var n=e.split(".");return{path:t+"/"+n[0].split("_").join("/"),memberWidgetID:n.length>1?n[1]:null}},requireWidget:function(e){var n=this;return new Promise(function(i,r){var o=n.parseClassID(e);t([o.path],function(e){i(o.memberWidgetID?e.prototype?e.prototype[o.memberWidgetID]:e[o.memberWidgetID]:e)})})},checksum:function(e){switch(e instanceof Array&&(e=e.join("")+e.length),typeof e){case"string":break;default:e=""+e}for(var t=305419896,n=0,i=e.length;i>n;++n)t+=e.charCodeAt(n)*(n+1);return(4294967295&t).toString(16)},getTime:function(){return l&&l.call(a)||(new Date).getTime()},mixin:function(e,t){function n(e,t){var n,i={};for(var r in t)n=t[r],r in e&&(e[r]===n||r in i&&i[r]===n)||(e[r]=n);return e}e=e||{};for(var i=1,r=arguments.length;r>i;i++)n(e,arguments[i]);return e},exists:function(e,t){if(!e||!t)return!1;for(var n=e.split("."),i=t,r=0;r<n.length;++r){var o=n[r];if(void 0===i[o])return!1;i=i[o]}return!0},logStringify:function(e){var t=[];return JSON.stringify(e,function(e,n){if("object"==typeof n&&null!==n){if(-1!==t.indexOf(n))return;t.push(n)}return n})},isArray:s,template:c}});