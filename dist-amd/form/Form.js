!function(t,e){"function"==typeof define&&define.amd?define(["d3","../common/HTMLWidget","../common/SVGWidget","../common/WidgetArray","./Input","./Button","./Slider","css!./Form"],e):t.form_Form=e(t.d3,t.common_HTMLWidget,t.common_SVGWidget,t.common_WidgetArray,t.form_Input,t.form_Button,t.form_Slider)}(this,function(t,e,n,o,i,a,r){function s(){e.call(this),this._tag="form"}return s.prototype=Object.create(e.prototype),s.prototype.constructor=s,s.prototype._class+=" form_Form",s.prototype.publish("validate",!0,"boolean","Enable/Disable input validation"),s.prototype.publish("inputs",[],"widgetArray","Array of input widgets"),s.prototype.publish("showSubmit",!0,"boolean","Show Submit/Cancel Controls"),s.prototype.publish("omitBlank",!1,"boolean","Drop Blank Fields From Submit"),s.prototype.publish("allowEmptyRequest",!1,"boolean","Allow Blank Form to be Submitted"),s.prototype.data=function(t){if(!arguments.length){var e=[];return this.inputsForEach(function(t){e.push(t.value())}),e}return this.inputsForEach(function(e,n){t.length>n&&e.value(t[n]).render()}),this},s.prototype.inputsForEach=function(t,e){var n=0;this.inputs().forEach(function(i){var a=i instanceof o?i.content():[i];a.forEach(function(o){e?t.call(e,o,n++):t(o,n++)})})},s.prototype.calcMaxColumns=function(){var t=0;return this.inputs().forEach(function(e){var n=e instanceof o?e.content():[e];n.length>t&&(t=n.length)}),t},s.prototype.values=function(t){if(!arguments.length){var e={};return this.inputsForEach(function(t){var n=t.value();(n||!this.omitBlank())&&(e[t.name()]=t.value())},this),e}return this.inputsForEach(function(e){t[e.name()]?e.value(t[e.name()]):this.omitBlank()&&e.value("")},this),this},s.prototype.submit=function(){var t=!0;this.validate()&&(t=this.checkValidation()),(this.allowEmptyRequest()||this.inputs().some(function(t){return-1!==t._class.indexOf("WidgetArray")?t.content().some(function(t){return t.hasValue()}):t.hasValue()}))&&this.click(t?this.values():null)},s.prototype.clear=function(){this.inputsForEach(function(t){switch(t.classID()){case"form_Slider":t.allowRange()?t.value([t.low(),t.low()]).render():t.value(t.low()).render();break;case"form_CheckBox":t.value(!1).render();break;case"form_Button":break;default:t.value("").render()}})},s.prototype.checkValidation=function(){var t=!0,e=[];return this.inputsForEach(function(t){t.isValid()||e.push("'"+t.label()+"' value is invalid.")}),e.length>0&&(alert(e.join("\n")),t=!1),t},s.prototype.enter=function(n,o){e.prototype.enter.apply(this,arguments),o.on("submit",function(){t.event.preventDefault()}),this._parentElement.style("overflow","auto");var i=o.append("table");this.tbody=i.append("tbody"),this.tfoot=i.append("tfoot"),this.btntd=this.tfoot.append("tr").append("td").attr("colspan",2);var r=this;this._controls=[(new a).value("Submit").on("click",function(){r.submit(r.values())},!0),(new a).value("Clear").on("click",function(){r.clear({})},!0)];var s=r.btntd.append("div").style("float","right");this._controls.forEach(function(t){var e=s.append("span").style("float","left");t.target(e.node()).render()})},s.prototype.update=function(i,a){e.prototype.update.apply(this,arguments),this._maxCols=this.calcMaxColumns();var r=this,s=this.tbody.selectAll("tr").data(this.inputs());s.enter().append("tr").each(function(e,i){var a=t.select(this),s=e instanceof o?e.content():[e];s.forEach(function(t,e){a.append("td").attr("class","prompt").text(t.label()+":");var o=a.append("td").attr("class","input");if(e===s.length-1&&s.length<r._maxCols&&o.attr("colspan",2*(r._maxCols-s.length+1)),t.target(o.node()).render(),t instanceof n){var i=t.element().node().getBBox();o.style("height",i.height+"px"),t.resize().render()}t._inputElement instanceof Array&&t._inputElement.forEach(function(t){t.on("change.form",function(t){setTimeout(function(){r._controls[0].disable(!r.allowEmptyRequest()&&!r.inputs().some(function(t){return-1!==t._class.indexOf("WidgetArray")?t.content().some(function(t){return t.hasValue()}):t.hasValue()}))},100)})})})}),s.exit().remove(),this.tfoot.style("display",this.showSubmit()?"table-footer-group":"none"),this.btntd.attr("colspan",2*this._maxCols),this.allowEmptyRequest()||setTimeout(function(){r._controls[0].disable(!r.allowEmptyRequest()&&!r.inputs().some(function(t){return-1!==t._class.indexOf("WidgetArray")?t.content().some(function(t){return t.hasValue()}):t.hasValue()}))},100)},s.prototype.exit=function(t,n){this.inputs_reset(),this._controls.forEach(function(t){t.target(null)}),e.prototype.exit.apply(this,arguments)},s.prototype.click=function(t){console.log("Clicked Submit: "+JSON.stringify(t))},s});