(function(e,t){typeof define=="function"&&define.amd?define(["d3","../common/SVGWidget","../common/Palette","../api/IGraph","./Vertex","./Edge","./GraphData","./GraphLayouts","../other/Bag","css!./Graph"],t):e.graph_Graph=t(e.d3,e.common_SVGWidget,e.common_Palette,e.api_IGraph,e.graph_Vertex,e.graph_Edge,e.graph_GraphData,e.graph_GraphLayouts,e.other_Bag)})(this,function(e,t,n,r,i,s,o,u,a){function f(){t.call(this),r.call(this),this.graphData=new o,this.highlight={zoom:1.1,opacity:.33,edge:"1.25px"},this._selection=new a.Selection}return f.prototype=Object.create(t.prototype),f.prototype._class+=" graph_Graph",f.prototype.implements(r.prototype),f.prototype.publish("allowDragging",!0,"boolean","Allow Dragging of Vertices",null,{tags:["Advanced"]}),f.prototype.publish("layout","Circle","set","Default Layout",["Circle","ForceDirected","ForceDirected2","Hierarchy"],{tags:["Basic"]}),f.prototype.publish("scale","100%","set","Zoom Level",["all","width","selection","100%","90%","75%","50%","25%","10%"],{tags:["Basic"]}),f.prototype.publish("applyScaleOnLayout",!1,"boolean","Shrink to fit on Layout",null,{tags:["Basic"]}),f.prototype.publish("highlightOnMouseOverVertex",!1,"boolean","Highlight Vertex on Mouse Over",null,{tags:["Basic"]}),f.prototype.publish("highlightOnMouseOverEdge",!1,"boolean","Highlight Edge on Mouse Over",null,{tags:["Basic"]}),f.prototype.publish("transitionDuration",250,"number","Transition Duration",null,{tags:["Intermediate"]}),f.prototype.publish("showEdges",!0,"boolean","Show Edges",null,{tags:["Intermediate"]}),f.prototype.publish("snapToGrid",0,"number","Snap to Grid",null,{tags:["Private"]}),f.prototype.publish("hierarchyRankDirection","TB","set","Direction for Rank Nodes",["TB","BT","LR","RL"],{tags:["Advanced"]}),f.prototype.publish("hierarchyNodeSeparation",50,"number","Number of pixels that separate nodes horizontally in the layout",null,{tags:["Advanced"]}),f.prototype.publish("hierarchyEdgeSeparation",10,"number","Number of pixels that separate edges horizontally in the layout",null,{tags:["Advanced"]}),f.prototype.publish("hierarchyRankSeparation",50,"number","Number of pixels between each rank in the layout",null,{tags:["Advanced"]}),f.prototype.getOffsetPos=function(){return{x:0,y:0}},f.prototype.size=function(e){var n=t.prototype.size.apply(this,arguments);return arguments.length&&this._svgZoom&&this._svgZoom.attr("x",-this._size.width/2).attr("y",-this._size.height/2).attr("width",this._size.width).attr("height",this._size.height),n},f.prototype.clear=function(){this.data({vertices:[],edges:[],hierarchy:[],merge:!1})},f.prototype.testData=function(){function u(e,t,n){return(new s).sourceVertex(e).targetVertex(t).sourceMarker("circleFoot").targetMarker("arrowHead").text(n||"")}var e={nodes:[{name:"Myriel",group:1},{name:"Napoleon",group:1},{name:"Mlle.Baptistine",group:1},{name:"Mme.Magloire",group:1},{name:"CountessdeLo",group:1},{name:"Geborand",group:1},{name:"Champtercier",group:1},{name:"Cravatte",group:1},{name:"Count",group:1},{name:"OldMan",group:1},{name:"Labarre",group:2},{name:"Valjean",group:2},{name:"Marguerite",group:3},{name:"Mme.deR",group:2},{name:"Isabeau",group:2},{name:"Gervais",group:2},{name:"Tholomyes",group:3},{name:"Listolier",group:3},{name:"Fameuil",group:3},{name:"Blacheville",group:3},{name:"Favourite",group:3},{name:"Dahlia",group:3},{name:"Zephine",group:3},{name:"Fantine",group:3},{name:"Mme.Thenardier",group:4},{name:"Thenardier",group:4},{name:"Cosette",group:5},{name:"Javert",group:4},{name:"Fauchelevent",group:0},{name:"Bamatabois",group:2},{name:"Perpetue",group:3},{name:"Simplice",group:2},{name:"Scaufflaire",group:2},{name:"Woman1",group:2},{name:"Judge",group:2},{name:"Champmathieu",group:2},{name:"Brevet",group:2},{name:"Chenildieu",group:2},{name:"Cochepaille",group:2},{name:"Pontmercy",group:4},{name:"Boulatruelle",group:6},{name:"Eponine",group:4},{name:"Anzelma",group:4},{name:"Woman2",group:5},{name:"MotherInnocent",group:0},{name:"Gribier",group:0},{name:"Jondrette",group:7},{name:"Mme.Burgon",group:7},{name:"Gavroche",group:8},{name:"Gillenormand",group:5},{name:"Magnon",group:5},{name:"Mlle.Gillenormand",group:5},{name:"Mme.Pontmercy",group:5},{name:"Mlle.Vaubois",group:5},{name:"Lt.Gillenormand",group:5},{name:"Marius",group:8},{name:"BaronessT",group:5},{name:"Mabeuf",group:8},{name:"Enjolras",group:8},{name:"Combeferre",group:8},{name:"Prouvaire",group:8},{name:"Feuilly",group:8},{name:"Courfeyrac",group:8},{name:"Bahorel",group:8},{name:"Bossuet",group:8},{name:"Joly",group:8},{name:"Grantaire",group:8},{name:"MotherPlutarch",group:9},{name:"Gueulemer",group:4},{name:"Babet",group:4},{name:"Claquesous",group:4},{name:"Montparnasse",group:4},{name:"Toussaint",group:5},{name:"Child1",group:10},{name:"Child2",group:10},{name:"Brujon",group:4},{name:"Mme.Hucheloup",group:8}],links:[{source:1,target:0,value:1},{source:2,target:0,value:8},{source:2,target:0,value:8},{source:3,target:0,value:10},{source:3,target:2,value:6},{source:4,target:0,value:1},{source:5,target:0,value:1},{source:6,target:0,value:1},{source:7,target:0,value:1},{source:8,target:0,value:2},{source:9,target:0,value:1},{source:11,target:10,value:1},{source:11,target:3,value:3},{source:11,target:2,value:3},{source:11,target:0,value:5},{source:12,target:11,value:1},{source:13,target:11,value:1},{source:14,target:11,value:1},{source:15,target:11,value:1},{source:17,target:16,value:4},{source:18,target:16,value:4},{source:18,target:17,value:4},{source:19,target:16,value:4},{source:19,target:17,value:4},{source:19,target:18,value:4},{source:20,target:16,value:3},{source:20,target:17,value:3},{source:20,target:18,value:3},{source:20,target:19,value:4},{source:21,target:16,value:3},{source:21,target:17,value:3},{source:21,target:18,value:3},{source:21,target:19,value:3},{source:21,target:20,value:5},{source:22,target:16,value:3},{source:22,target:17,value:3},{source:22,target:18,value:3},{source:22,target:19,value:3},{source:22,target:20,value:4},{source:22,target:21,value:4},{source:23,target:16,value:3},{source:23,target:17,value:3},{source:23,target:18,value:3},{source:23,target:19,value:3},{source:23,target:20,value:4},{source:23,target:21,value:4},{source:23,target:22,value:4},{source:23,target:12,value:2},{source:23,target:11,value:9},{source:24,target:23,value:2},{source:24,target:11,value:7},{source:25,target:24,value:13},{source:25,target:23,value:1},{source:25,target:11,value:12},{source:26,target:24,value:4},{source:26,target:11,value:31},{source:26,target:16,value:1},{source:26,target:25,value:1},{source:27,target:11,value:17},{source:27,target:23,value:5},{source:27,target:25,value:5},{source:27,target:24,value:1},{source:27,target:26,value:1},{source:28,target:11,value:8},{source:28,target:27,value:1},{source:29,target:23,value:1},{source:29,target:27,value:1},{source:29,target:11,value:2},{source:30,target:23,value:1},{source:31,target:30,value:2},{source:31,target:11,value:3},{source:31,target:23,value:2},{source:31,target:27,value:1},{source:32,target:11,value:1},{source:33,target:11,value:2},{source:33,target:27,value:1},{source:34,target:11,value:3},{source:34,target:29,value:2},{source:35,target:11,value:3},{source:35,target:34,value:3},{source:35,target:29,value:2},{source:36,target:34,value:2},{source:36,target:35,value:2},{source:36,target:11,value:2},{source:36,target:29,value:1},{source:37,target:34,value:2},{source:37,target:35,value:2},{source:37,target:36,value:2},{source:37,target:11,value:2},{source:37,target:29,value:1},{source:38,target:34,value:2},{source:38,target:35,value:2},{source:38,target:36,value:2},{source:38,target:37,value:2},{source:38,target:11,value:2},{source:38,target:29,value:1},{source:39,target:25,value:1},{source:40,target:25,value:1},{source:41,target:24,value:2},{source:41,target:25,value:3},{source:42,target:41,value:2},{source:42,target:25,value:2},{source:42,target:24,value:1},{source:43,target:11,value:3},{source:43,target:26,value:1},{source:43,target:27,value:1},{source:44,target:28,value:3},{source:44,target:11,value:1},{source:45,target:28,value:2},{source:47,target:46,value:1},{source:48,target:47,value:2},{source:48,target:25,value:1},{source:48,target:27,value:1},{source:48,target:11,value:1},{source:49,target:26,value:3},{source:49,target:11,value:2},{source:50,target:49,value:1},{source:50,target:24,value:1},{source:51,target:49,value:9},{source:51,target:26,value:2},{source:51,target:11,value:2},{source:52,target:51,value:1},{source:52,target:39,value:1},{source:53,target:51,value:1},{source:54,target:51,value:2},{source:54,target:49,value:1},{source:54,target:26,value:1},{source:55,target:51,value:6},{source:55,target:49,value:12},{source:55,target:39,value:1},{source:55,target:54,value:1},{source:55,target:26,value:21},{source:55,target:11,value:19},{source:55,target:16,value:1},{source:55,target:25,value:2},{source:55,target:41,value:5},{source:55,target:48,value:4},{source:56,target:49,value:1},{source:56,target:55,value:1},{source:57,target:55,value:1},{source:57,target:41,value:1},{source:57,target:48,value:1},{source:58,target:55,value:7},{source:58,target:48,value:7},{source:58,target:27,value:6},{source:58,target:57,value:1},{source:58,target:11,value:4},{source:59,target:58,value:15},{source:59,target:55,value:5},{source:59,target:48,value:6},{source:59,target:57,value:2},{source:60,target:48,value:1},{source:60,target:58,value:4},{source:60,target:59,value:2},{source:61,target:48,value:2},{source:61,target:58,value:6},{source:61,target:60,value:2},{source:61,target:59,value:5},{source:61,target:57,value:1},{source:61,target:55,value:1},{source:62,target:55,value:9},{source:62,target:58,value:17},{source:62,target:59,value:13},{source:62,target:48,value:7},{source:62,target:57,value:2},{source:62,target:41,value:1},{source:62,target:61,value:6},{source:62,target:60,value:3},{source:63,target:59,value:5},{source:63,target:48,value:5},{source:63,target:62,value:6},{source:63,target:57,value:2},{source:63,target:58,value:4},{source:63,target:61,value:3},{source:63,target:60,value:2},{source:63,target:55,value:1},{source:64,target:55,value:5},{source:64,target:62,value:12},{source:64,target:48,value:5},{source:64,target:63,value:4},{source:64,target:58,value:10},{source:64,target:61,value:6},{source:64,target:60,value:2},{source:64,target:59,value:9},{source:64,target:57,value:1},{source:64,target:11,value:1},{source:65,target:63,value:5},{source:65,target:64,value:7},{source:65,target:48,value:3},{source:65,target:62,value:5},{source:65,target:58,value:5},{source:65,target:61,value:5},{source:65,target:60,value:2},{source:65,target:59,value:5},{source:65,target:57,value:1},{source:65,target:55,value:2},{source:66,target:64,value:3},{source:66,target:58,value:3},{source:66,target:59,value:1},{source:66,target:62,value:2},{source:66,target:65,value:2},{source:66,target:48,value:1},{source:66,target:63,value:1},{source:66,target:61,value:1},{source:66,target:60,value:1},{source:67,target:57,value:3},{source:68,target:25,value:5},{source:68,target:11,value:1},{source:68,target:24,value:1},{source:68,target:27,value:1},{source:68,target:48,value:1},{source:68,target:41,value:1},{source:69,target:25,value:6},{source:69,target:68,value:6},{source:69,target:11,value:1},{source:69,target:24,value:1},{source:69,target:27,value:2},{source:69,target:48,value:1},{source:69,target:41,value:1},{source:70,target:25,value:4},{source:70,target:69,value:4},{source:70,target:68,value:4},{source:70,target:11,value:1},{source:70,target:24,value:1},{source:70,target:27,value:1},{source:70,target:41,value:1},{source:70,target:58,value:1},{source:71,target:27,value:1},{source:71,target:69,value:2},{source:71,target:68,value:2},{source:71,target:70,value:2},{source:71,target:11,value:1},{source:71,target:48,value:1},{source:71,target:41,value:1},{source:71,target:25,value:1},{source:72,target:26,value:2},{source:72,target:27,value:1},{source:72,target:11,value:1},{source:73,target:48,value:2},{source:74,target:48,value:2},{source:74,target:73,value:3},{source:75,target:69,value:3},{source:75,target:68,value:3},{source:75,target:25,value:3},{source:75,target:48,value:1},{source:75,target:41,value:1},{source:75,target:70,value:1},{source:75,target:71,value:1},{source:76,target:64,value:1},{source:76,target:65,value:1},{source:76,target:66,value:1},{source:76,target:63,value:1},{source:76,target:62,value:1},{source:76,target:48,value:1},{source:76,target:58,value:1}]},t=[],r=[],o=n.ordinal("dark2");return e.nodes.forEach(function(e){var n=[];Math.random()<.1&&n.push({faChar:"A",tooltip:"Test A",shape_colorFill:"white",image_colorFill:"red"}),Math.random()<.1&&n.push({faChar:"B",tooltip:"Test B",shape_colorFill:"green",shape_colorStroke:"green",image_colorFill:"white"}),Math.random()<.1&&n.push({faChar:"C",tooltip:"Test C",shape_colorFill:"navy",shape_colorStroke:"navy",image_colorFill:"white"}),t.push((new i).text(e.name).textbox_shape_colorStroke(o(e.group)).textbox_shape_colorFill("whitesmoke").icon_shape_colorStroke(o(e.group)).icon_shape_colorFill(o(e.group)).annotationIcons(n).faChar(e.name[0]))},this),e.links.forEach(function(e,n){r.push(u(t[e.source],t[e.target]).weight(e.value))},this),this.data({vertices:t,edges:r}),this},f.prototype.data=function(e){var n=t.prototype.data.apply(this,arguments);if(arguments.length){this._data.merge||(this.graphData=new o,this._renderCount=0);var r=this.graphData.setData(this._data.vertices,this._data.edges,this._data.hierarchy,this._data.merge),i=this;r.addedVertices.forEach(function(e){e.pos({x:+Math.random()*10/2-5,y:+Math.random()*10/2-5})}),r.addedEdges.forEach(function(e){e._sourceMarker&&(e._sourceMarker=i._id+"_"+e._sourceMarker),e._targetMarker&&(e._targetMarker=i._id+"_"+e._targetMarker)});var s={};this.graphData.edgeValues().forEach(function(e){s[e._sourceVertex._id]||(s[e._sourceVertex._id]={}),s[e._sourceVertex._id][e._targetVertex._id]||(s[e._sourceVertex._id][e._targetVertex._id]=0);var t=++s[e._sourceVertex._id][e._targetVertex._id];e.arcDepth(16*t)})}return n},f.prototype.selection=function(e){return arguments.length?(this._selection.set(e),this):this._selection.get()},f.prototype.setZoom=function(e,t,n){this.zoom&&(this.zoom.translate(e),this.zoom.scale(t),this.applyZoom(n))},f.prototype.applyZoom=function(t){e.event&&e.event.sourceEvent&&!e.event.sourceEvent.ctrlKey&&(e.event.sourceEvent.type==="wheel"||e.event.sourceEvent.type==="mousewheel"||e.event.sourceEvent.type==="DOMMouseScroll")&&e.event.sourceEvent.wheelDelta&&(this.zoom.translate([this.prevTranslate[0],this.prevTranslate[1]+e.event.sourceEvent.wheelDelta]),this.zoom.scale(this.prevScale)),(t?this.svg.transition().duration(t):this.svg).attr("transform","translate("+this.zoom.translate()+")scale("+this.zoom.scale()+")"),this.prevTranslate=this.zoom.translate(),this.prevScale!==this.zoom.scale()&&(this._fixIEMarkers(),this.prevScale=this.zoom.scale()),this.brush.x(e.scale.identity().domain([(-this.prevTranslate[0]-this._size.width/2)*1/this.zoom.scale(),(-this.prevTranslate[0]+this._size.width/2)*1/this.zoom.scale()])),this.brush.y(e.scale.identity().domain([(-this.prevTranslate[1]-this._size.height/2)*1/this.zoom.scale(),(-this.prevTranslate[1]+this._size.height/2)*1/this.zoom.scale()]))},f.prototype.enter=function(n,r,i){function o(t){if(s.allowDragging()){e.event.sourceEvent.stopPropagation(),s._dragging=!0;if(s.forceLayout){var n=s.forceLayout.vertexMap[t.id()];n.fixed=!0}s.svgMarkerGlitch&&s.graphData.nodeEdges(t.id()).forEach(function(e){var t=s.graphData.edge(e);s._pushMarkers(t.element(),t)})}}function u(t){if(s.allowDragging()){e.event.sourceEvent.stopPropagation(),t.move({x:e.event.x,y:e.event.y});if(s.forceLayout){var n=s.forceLayout.vertexMap[t.id()];n.fixed=!0,n.x=n.px=e.event.x,n.y=n.py=e.event.y}s.refreshIncidentEdges(t,!0)}}function a(t){if(s.allowDragging()){e.event.sourceEvent.stopPropagation(),s._dragging=!1;if(s.snapToGrid()){var n=t.calcSnap(s.snapToGrid());t.move(n[0]),s.refreshIncidentEdges(t,!0)}if(s.forceLayout){var r=s.forceLayout.vertexMap[t.id()];r.fixed=!1}s.svgMarkerGlitch&&s.graphData.nodeEdges(t.id()).forEach(function(e){var t=s.graphData.edge(e);s._popMarkers(t.element(),t)})}}t.prototype.enter.apply(this,arguments);var s=this;this.prevTranslate=[0,0],this.prevScale=1,this.zoom=e.behavior.zoom().scaleExtent([.01,4]).on("zoomstart",function(t){s.prevTranslate=s.zoom.translate(),s.prevScale=s.zoom.scale(),e.event.sourceEvent&&e.event.sourceEvent.shiftKey&&e.event.sourceEvent.ctrlKey?s._zoomMode="selection":e.event.sourceEvent&&e.event.sourceEvent.shiftKey?(s._zoomMode="selection",s._selection.clear()):s._zoomMode="zoom";switch(s._zoomMode){case"selection":r.select(".extent").style("visibility",null);break;default:r.select(".extent").style("visibility","hidden")}}).on("zoomend",function(e){switch(s._zoomMode){case"selection":s.zoom.translate(s.prevTranslate),s.zoom.scale(s.prevScale);break;default:}s._svgBrush.call(s.brush.clear())}).on("zoom",function(e){switch(s._zoomMode){case"selection":break;default:s.applyZoom()}}),this.brush=e.svg.brush().x(e.scale.identity().domain([-s._size.width/2,s._size.width/2])).y(e.scale.identity().domain([-s._size.height/2,s._size.height/2])).on("brushstart",function(e){switch(s._zoomMode){case"selection":break;default:}}).on("brushend",function(t){switch(s._zoomMode){case"selection":var n=e.event.target.extent();s.svgV.selectAll(".graphVertex").select("*").each(function(e){n[0][0]<=e.x()&&e.x()<n[1][0]&&n[0][1]<=e.y()&&e.y()<n[1][1]&&s._selection.append(e)}),s.graph_selection(s.selection());break;default:}}).on("brush",function(){switch(s._zoomMode){case"selection":var t=s.zoom.translate();console.log(t[0]);var n=e.event.target.extent();s.svgV.selectAll(".graphVertex").select("*").classed("selected",function(e){return s._selection.isSelected(e)||n[0][0]<=e.x()&&e.x()<n[1][0]&&n[0][1]<=e.y()&&e.y()<n[1][1]});break;default:}}),this.drag=e.behavior.drag().origin(function(e){return e.pos()}).on("dragstart",o).on("dragend",a).on("drag",u),this._svgZoom=r.append("rect").attr("class","zoom").attr("x",-this._size.width/2).attr("y",-this._size.height/2).attr("width",this._size.width).attr("height",this._size.height),this.defs=r.append("defs"),this.addMarkers(),r.call(this.zoom),this.svg=r.append("g"),this._svgBrush=this.svg.append("g").attr("class","selectionBrush").call(this.brush),this._svgBrush.select(".background").style("cursor",null),s._svgBrush.call(s.brush.clear()),this.svgC=this.svg.append("g").attr("id",this._id+"C"),this.svgE=this.svg.append("g").attr("id",this._id+"E"),this.svgV=this.svg.append("g").attr("id",this._id+"V")},f.prototype.getBounds=function(e,t){var n=[[null,null],[null,null]];return e.forEach(function(e){var r=t?t.nodePos(e._id):{x:e.x(),y:e.y(),width:e.width(),height:e.height()},i=r.x-r.width/2,s=r.x+r.width/2,o=r.y-r.height/2,u=r.y+r.height/2;if(n[0][0]===null||n[0][0]>i)n[0][0]=i;if(n[0][1]===null||n[0][1]>o)n[0][1]=o;if(n[1][0]===null||n[1][0]<s)n[1][0]=s;if(n[1][1]===null||n[1][1]<u)n[1][1]=u}),n},f.prototype.getVertexBounds=function(e){return this.getBounds(this.graphData.nodeValues(),e)},f.prototype.getSelectionBounds=function(e){return this.getBounds(this._selection.get(),e)},f.prototype.shrinkToFit=function(e,t){var n=this.width(),r=this.height(),i=e[1][0]-e[0][0],s=e[1][1]-e[0][1],o=(e[0][0]+e[1][0])/2,u=(e[0][1]+e[1][1])/2,a=1/Math.max(i/n,s/r);a>1&&(a=1);var f=[-a*o,-a*u];this.setZoom(f,a,t)},f.prototype._origScale=f.prototype.scale,f.prototype.scale=function(e,t){var n=f.prototype._origScale.apply(this,arguments);return arguments.length&&this.zoomTo(e,t),n},f.prototype.zoomTo=function(e,t){switch(e){case"all":this.shrinkToFit(this.getVertexBounds(),t);break;case"width":var n=this.getVertexBounds();n[0][1]=0,n[1][1]=0,this.shrinkToFit(n,t);break;case"selection":this.shrinkToFit(this._selection.isEmpty()?this.getVertexBounds():this.getSelectionBounds(),t);break;default:var r=parseInt(e);if(isNaN(r)||r<=0||r>200)r=100;this.zoom.scale(r/100),this.applyZoom(t)}},f.prototype.centerOn=function(e,t){var n=(e[0][0]+e[1][0])/2,r=(e[0][1]+e[1][1])/2,i=[n,r];this.setZoom(i,1,t)},f.prototype._origLayout=f.prototype.layout,f.prototype.layout=function(e,t){var n=f.prototype._origLayout.apply(this,arguments);if(arguments.length&&this._renderCount){this.forceLayout&&(this.forceLayout.force.stop(),this.forceLayout=null);var r=this,i=this.getLayoutEngine();if(this.layout()==="ForceDirected2")this.forceLayout=i,this.forceLayout.force.on("tick",function(e){i.vertices.forEach(function(e){var t=r.graphData.node(e.id);e.fixed?(e.x=e.px,e.y=e.py):(e.px=e.x,e.py=e.y,t.move({x:e.x,y:e.y}))}),r.graphData.edgeValues().forEach(function(e){e.points([],!1,!1)});if(r.applyScaleOnLayout()){var t=r.getVertexBounds(i);r.shrinkToFit(t)}}),this.forceLayout.force.start();else if(i){this.forceLayout=null,r._dragging=!0,r.graphData.nodeValues().forEach(function(e){var n=i.nodePos(e._id);e.move({x:n.x,y:n.y},t),n.width&&n.height&&!e.width()&&!e.height()&&e.width(n.width).height(n.height).render()}),r.graphData.edgeValues().forEach(function(e){var n=i.edgePoints(e);e.points(n,t)});if(r.applyScaleOnLayout()){var s=r.getVertexBounds(i);r.shrinkToFit(s,t)}this._fixIEMarkers(),setTimeout(function(){r._dragging=!1},t?t+50:50)}}return n},f.prototype.update=function(n,r,i){function u(e){e.target(this).render(),e.element().call(s.drag),e.dispatch&&(e.dispatch.on("sizestart",function(e,t){e.allowResize(s.allowDragging()),s.allowDragging()&&(s._dragging=!0)}),e.dispatch.on("size",function(e,t){s.refreshIncidentEdges(e,!1)}),e.dispatch.on("sizeend",function(e,t){s._dragging=!1;if(s.snapToGrid()){var n=e.calcSnap(s.snapToGrid());e.pos(n[0]).size(n[1]).render(),s.refreshIncidentEdges(e,!1)}}))}function f(e){e.target(this).render()}function l(e){e.render()}function c(e){e.render()}t.prototype.update.apply(this,arguments);var s=this,o=this.svgV.selectAll("#"+this._id+"V > .graphVertex").data(this.graphData.nodeValues(),function(e){return e.id()});o.enter().append("g").attr("class","graphVertex").style("opacity",1e-6).on("click.selectionBag",function(t){s._selection.click(t,e.event)}).on("click",function(t){s.vertex_click(t,e.event)}).on("dblclick",function(t){s.vertex_dblclick(t,e.event)}).on("mouseover",function(t){if(s._dragging)return;s.vertex_mouseover(e.select(this),t)}).on("mouseout",function(t){if(s._dragging)return;s.vertex_mouseout(e.select(this),t)}).each(u).transition().duration(750).style("opacity",1);var a=this.svgE.selectAll("#"+this._id+"E > .edge").data(this.showEdges()?this.graphData.edgeValues():[],function(e){return e.id()});a.enter().append("g").attr("class","edge").style("opacity",1e-6).on("click",function(e){s.edge_click(e)}).on("mouseover",function(t){if(s._dragging)return;s.edge_mouseover(e.select(this),t)}).on("mouseout",function(t){if(s._dragging)return;s.edge_mouseout(e.select(this),t)}).each(f).transition().duration(750).style("opacity",1),o.each(l),a.each(c),o.exit().each(function(e){e.target(null)}).remove(),a.exit().each(function(e){e.target(null)}).remove(),this._renderCount||(this._renderCount++,this.setZoom([0,0],1),this.layout(this.layout()))},f.prototype.getLayoutEngine=function(){switch(this.layout()){case"Circle":return new u.Circle(this.graphData,this._size.width,this._size.height);case"ForceDirected":return new u.ForceDirected(this.graphData,this._size.width,this._size.height,!0);case"ForceDirected2":return new u.ForceDirected(this.graphData,this._size.width,this._size.height);case"Hierarchy":return new u.Hierarchy(this.graphData,this._size.width,this._size.height,{rankdir:this.hierarchyRankDirection(),nodesep:this.hierarchyNodeSeparation(),edgesep:this.hierarchyEdgeSeparation(),ranksep:this.hierarchyRankSeparation()})}return null},f.prototype.getNeighborMap=function(e){var t={},n={};if(e){n=this.graphData.nodeEdges(e.id());for(var r=0;r<n.length;++r){var i=this.graphData.edge(n[r]);n[i.id()]=i,i._sourceVertex.id()!==e.id()&&(t[i._sourceVertex.id()]=i._sourceVertex),i._targetVertex.id()!==e.id()&&(t[i._targetVertex.id()]=i._targetVertex)}}return{vertices:t,edges:n}},f.prototype.highlightVerticies=function(e){var t=this,n=this.svgV.selectAll(".graphVertex");return n.transition().duration(this.transitionDuration()).each("end",function(t){e&&e[t.id()]&&t._parentElement.node()&&t._parentElement.node().parentNode&&t._parentElement.node().parentNode.appendChild(t._parentElement.node())}).style("opacity",function(n){return!e||e[n.id()]?1:t.highlight.opacity}),this},f.prototype.highlightEdges=function(e){var t=this,n=this.svgE.selectAll(".edge");return n.style("stroke-width",function(n){return e&&e[n.id()]?t.highlight.edge:"1px"}).transition().duration(this.transitionDuration()).style("opacity",function(n){return!e||e[n.id()]?1:t.highlight.opacity}),this},f.prototype.highlightVertex=function(e,t){if(this.highlightOnMouseOverVertex())if(t){var n=this.getNeighborMap(t);n.vertices[t.id()]=t,this.highlightVerticies(n.vertices),this.highlightEdges(n.edges)}else this.highlightVerticies(null),this.highlightEdges(null)},f.prototype.highlightEdge=function(e,t){if(this.highlightOnMouseOverEdge())if(t){var n={};n[t._sourceVertex.id()]=t._sourceVertex,n[t._targetVertex.id()]=t._targetVertex;var r={};r[t.id()]=t,this.highlightVerticies(n),this.highlightEdges(r)}else this.highlightVerticies(null),this.highlightEdges(null)},f.prototype.refreshIncidentEdges=function(e,t){var n=this;this.graphData.nodeEdges(e.id()).forEach(function(e){var r=n.graphData.edge(e);r.points([],!1,t)})},f.prototype.graph_selection=function(e){},f.prototype.vertex_click=function(e){e._parentElement.node().parentNode.appendChild(e._parentElement.node()),r.prototype.vertex_click.apply(this,arguments)},f.prototype.vertex_dblclick=function(e){},f.prototype.vertex_mouseover=function(e,t){this.highlightVertex(e,t)},f.prototype.vertex_mouseout=function(e,t){this.highlightVertex(null,null)},f.prototype.edge_mouseover=function(e,t){this.highlightEdge(e,t)},f.prototype.edge_mouseout=function(e,t){this.highlightEdge(null,null)},f.prototype.addMarkers=function(e){e&&(this.defs.select("#"+this._id+"_arrowHead").remove(),this.defs.select("#"+this._id+"_circleFoot").remove(),this.defs.select("#"+this._id+"_circleHead").remove()),this.defs.append("marker").attr("class","marker").attr("id",this._id+"_arrowHead").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",8).attr("markerHeight",8).attr("markerUnits","strokeWidth").attr("orient","auto").append("polyline").attr("points","0,0 10,5 0,10 1,5"),this.defs.append("marker").attr("class","marker").attr("id",this._id+"_circleFoot").attr("viewBox","0 0 10 10").attr("refX",1).attr("refY",5).attr("markerWidth",7).attr("markerHeight",7).attr("markerUnits","strokeWidth").attr("orient","auto").append("circle").attr("cx",5).attr("cy",5).attr("r",4),this.defs.append("marker").attr("class","marker").attr("id",this._id+"_circleHead").attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerWidth",7).attr("markerHeight",7).attr("markerUnits","strokeWidth").attr("orient","auto").append("circle").attr("cx",5).attr("cy",5).attr("r",4)},f});