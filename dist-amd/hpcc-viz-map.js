// (c) 2008 David Troy

!function(){function t(e,t){function u(t){var n=e.arcs[t<0?~t:t],r=n[0],i;return e.transform?(i=[0,0],n.forEach(function(e){i[0]+=e[0],i[1]+=e[1]})):i=n[n.length-1],t<0?[i,r]:[r,i]}function a(e,t){for(var r in e){var i=e[r];delete t[i.start],delete i.start,delete i.end,i.forEach(function(e){n[e<0?~e:e]=1}),s.push(i)}}var n={},r={},i={},s=[],o=-1;return t.forEach(function(n,r){var i=e.arcs[n<0?~n:n],s;i.length<3&&!i[1][0]&&!i[1][1]&&(s=t[++o],t[o]=n,t[r]=s)}),t.forEach(function(e){var t=u(e),n=t[0],s=t[1],o,a;if(o=i[n]){delete i[o.end],o.push(e),o.end=s;if(a=r[s]){delete r[a.start];var f=a===o?o:o.concat(a);r[f.start=o.start]=i[f.end=a.end]=f}else r[o.start]=i[o.end]=o}else if(o=r[s]){delete r[o.start],o.unshift(e),o.start=n;if(a=i[n]){delete i[a.end];var l=a===o?o:a.concat(o);r[l.start=a.start]=i[l.end=o.end]=l}else r[o.start]=i[o.end]=o}else o=[e],r[o.start=n]=i[o.end=s]=o}),a(i,r),a(r,i),t.forEach(function(e){n[e<0?~e:e]||s.push([e])}),s}function r(e,n,r){var i=[];if(arguments.length>1){var s=[],o;function u(e){var t=e<0?~e:e;(s[t]||(s[t]=[])).push({i:e,g:o})}function a(e){e.forEach(u)}function f(e){e.forEach(a)}function l(e){e.type==="GeometryCollection"?e.geometries.forEach(l):e.type in c&&(o=e,c[e.type](e.arcs))}var c={LineString:a,MultiLineString:f,Polygon:f,MultiPolygon:function(e){e.forEach(f)}};l(n),s.forEach(arguments.length<3?function(e){i.push(e[0].i)}:function(e){r(e[0].g,e[e.length-1].g)&&i.push(e[0].i)})}else for(var h=0,p=e.arcs.length;h<p;++h)i.push(h);return{type:"MultiLineString",arcs:t(e,i)}}function i(e,r){function a(e){e.forEach(function(t){t.forEach(function(t){(i[t=t<0?~t:t]||(i[t]=[])).push(e)})}),s.push(e)}function f(t){return h(u(e,{type:"Polygon",arcs:[t]}).coordinates[0])>0}var i={},s=[],o=[];return r.forEach(function(e){e.type==="Polygon"?a(e.arcs):e.type==="MultiPolygon"&&e.arcs.forEach(a)}),s.forEach(function(e){if(!e._){var t=[],n=[e];e._=1,o.push(t);while(e=n.pop())t.push(e),e.forEach(function(e){e.forEach(function(e){i[e<0?~e:e].forEach(function(e){e._||(e._=1,n.push(e))})})})}}),s.forEach(function(e){delete e._}),{type:"MultiPolygon",arcs:o.map(function(r){var s=[];r.forEach(function(e){e.forEach(function(e){e.forEach(function(e){i[e<0?~e:e].length<2&&s.push(e)})})}),s=t(e,s);if((n=s.length)>1){var o=f(r[0][0]);for(var u=0,a;u<n;++u)if(o===f(s[u])){a=s[0],s[0]=s[u],s[u]=a;break}}return s})}}function s(e,t){return t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(t){return o(e,t)})}:o(e,t)}function o(e,t){var n={type:"Feature",id:t.id,properties:t.properties||{},geometry:u(e,t)};return t.id==null&&delete n.id,n}function u(e,t){function i(e,t){t.length&&t.pop();for(var i=r[e<0?~e:e],s=0,o=i.length,u;s<o;++s)t.push(u=i[s].slice()),n(u,s);e<0&&a(t,o)}function s(e){return e=e.slice(),n(e,0),e}function o(e){var t=[];for(var n=0,r=e.length;n<r;++n)i(e[n],t);return t.length<2&&t.push(t[0].slice()),t}function u(e){var t=o(e);while(t.length<4)t.push(t[0].slice());return t}function f(e){return e.map(u)}function l(e){var t=e.type;return t==="GeometryCollection"?{type:t,geometries:e.geometries.map(l)}:t in c?{type:t,coordinates:c[t](e)}:null}var n=m(e.transform),r=e.arcs,c={Point:function(e){return s(e.coordinates)},MultiPoint:function(e){return e.coordinates.map(s)},LineString:function(e){return o(e.arcs)},MultiLineString:function(e){return e.arcs.map(o)},Polygon:function(e){return f(e.arcs)},MultiPolygon:function(e){return e.arcs.map(f)}};return l(t)}function a(e,t){var n,r=e.length,i=r-t;while(i<--r)n=e[i],e[i++]=e[r],e[r]=n}function f(e,t){var n=0,r=e.length;while(n<r){var i=n+r>>>1;e[i]<t?n=i+1:r=i}return n}function l(e){function r(e,n){e.forEach(function(e){e<0&&(e=~e);var r=t[e];r?r.push(n):t[e]=[n]})}function i(e,t){e.forEach(function(e){r(e,t)})}function s(e,t){e.type==="GeometryCollection"?e.geometries.forEach(function(e){s(e,t)}):e.type in o&&o[e.type](e.arcs,t)}var t={},n=e.map(function(){return[]}),o={LineString:r,MultiLineString:i,Polygon:i,MultiPolygon:function(e,t){e.forEach(function(e){i(e,t)})}};e.forEach(s);for(var u in t)for(var a=t[u],l=a.length,c=0;c<l;++c)for(var h=c+1;h<l;++h){var p=a[c],d=a[h],v;(v=n[p])[u=f(v,d)]!==d&&v.splice(u,0,d),(v=n[d])[u=f(v,p)]!==p&&v.splice(u,0,p)}return n}function c(e,t){function s(e){i.remove(e),e[1][2]=t(e),i.push(e)}var n=m(e.transform),r=g(e.transform),i=v();return t||(t=p),e.arcs.forEach(function(e){var o=[],u=0,a;for(var f=0,l=e.length,c;f<l;++f)c=e[f],n(e[f]=[c[0],c[1],Infinity],f);for(var f=1,l=e.length-1;f<l;++f)a=e.slice(f-1,f+2),a[1][2]=t(a),o.push(a),i.push(a);for(var f=0,l=o.length;f<l;++f)a=o[f],a.previous=o[f-1],a.next=o[f+1];while(a=i.pop()){var h=a.previous,p=a.next;a[1][2]<u?a[1][2]=u:u=a[1][2],h&&(h.next=p,h[2]=a[2],s(h)),p&&(p.previous=h,p[0]=a[0],s(p))}e.forEach(r)}),e}function h(e){var t=-1,n=e.length,r,i=e[n-1],s=0;while(++t<n)r=i,i=e[t],s+=r[0]*i[1]-r[1]*i[0];return s*.5}function p(e){var t=e[0],n=e[1],r=e[2];return Math.abs((t[0]-r[0])*(n[1]-t[1])-(t[0]-n[0])*(r[1]-t[1]))}function d(e,t){return e[1][2]-t[1][2]}function v(){function r(e,n){while(n>0){var r=(n+1>>1)-1,i=t[r];if(d(e,i)>=0)break;t[i._=n]=i,t[e._=n=r]=e}}function i(e,r){for(;;){var i=r+1<<1,s=i-1,o=r,u=t[o];s<n&&d(t[s],u)<0&&(u=t[o=s]),i<n&&d(t[i],u)<0&&(u=t[o=i]);if(o===r)break;t[u._=r]=u,t[e._=r=o]=e}}var e={},t=[],n=0;return e.push=function(e){return r(t[e._=n]=e,n++),n},e.pop=function(){if(n<=0)return;var e=t[0],r;return--n>0&&(r=t[n],i(t[r._=0]=r,0)),e},e.remove=function(e){var s=e._,o;if(t[s]!==e)return;return s!==--n&&(o=t[n],(d(o,e)<0?r:i)(t[o._=s]=o,s)),s},e}function m(e){if(!e)return y;var t,n,r=e.scale[0],i=e.scale[1],s=e.translate[0],o=e.translate[1];return function(e,u){u||(t=n=0),e[0]=(t+=e[0])*r+s,e[1]=(n+=e[1])*i+o}}function g(e){if(!e)return y;var t,n,r=e.scale[0],i=e.scale[1],s=e.translate[0],o=e.translate[1];return function(e,u){u||(t=n=0);var a=(e[0]-s)/r|0,f=(e[1]-o)/i|0;e[0]=a-t,e[1]=f-n,t=a,n=f}}function y(){}var e={version:"1.6.19",mesh:function(e){return u(e,r.apply(this,arguments))},meshArcs:r,merge:function(e){return u(e,i.apply(this,arguments))},mergeArcs:i,feature:s,neighbors:l,presimplify:c};typeof define=="function"&&define.amd?define("topojson",e):typeof module=="object"&&module.exports?module.exports=e:this.topojson=e}(),function(e,t){typeof define=="function"&&define.amd?define("src/map/Utility",["d3"],t):e.map_Utility=t(e.d3)}(this,function(e){function t(){}t.prototype.constructor=t,t.prototype._class+=" map_Geohash",t.prototype.base32="0123456789bcdefghjkmnpqrstuvwxyz",t.prototype.encode=function(e,t,n){if(typeof n=="undefined"){for(var r=1;r<=12;r++){var i=this.encode(e,t,r),s=this.decode(i);if(s.lat===e&&s.lon===t)return i}n=12}e=Number(e),t=Number(t),n=Number(n);if(isNaN(e)||isNaN(t)||isNaN(n))throw new Error("Invalid geohash");var o=0,u=0,a=!0,f="",l=-90,c=90,h=-180,p=180;while(f.length<n){if(a){var d=(h+p)/2;t>d?(o=o*2+1,h=d):(o*=2,p=d)}else{var v=(l+c)/2;e>v?(o=o*2+1,l=v):(o*=2,c=v)}a=!a,++u===5&&(f+=this.base32.charAt(o),u=0,o=0)}return f},t.prototype.decode=function(e){var t=this.bounds(e),n=t.sw.lat,r=t.sw.lon,i=t.ne.lat,s=t.ne.lon,o=(n+i)/2,u=(r+s)/2;return o=o.toFixed(Math.floor(2-Math.log(i-n)/Math.LN10)),u=u.toFixed(Math.floor(2-Math.log(s-r)/Math.LN10)),{lat:Number(o),lon:Number(u)}},t.prototype.bounds=function(e){if(e.length===0)throw new Error("Invalid geohash");e=e.toLowerCase();var t=!0,n=-90,r=90,i=-180,s=180;for(var o=0;o<e.length;o++){var u=e.charAt(o),a=this.base32.indexOf(u);if(a===-1)throw new Error("Invalid geohash");for(var f=4;f>=0;f--){var l=a>>f&1;if(t){var c=(i+s)/2;l===1?i=c:s=c}else{var h=(n+r)/2;l===1?n=h:r=h}t=!t}}var p={sw:{lat:n,lon:i},ne:{lat:r,lon:s}};return p},t.prototype.adjacent=function(e,t){e=e.toLowerCase(),t=t.toLowerCase();if(e.length===0)throw new Error("Invalid geohash");if("nsew".indexOf(t)===-1)throw new Error("Invalid direction");var n={n:["p0r21436x8zb9dcf5h7kjnmqesgutwvy","bc01fg45238967deuvhjyznpkmstqrwx"],s:["14365h7k9dcfesgujnmqp0r2twvyx8zb","238967debc01fg45kmstqrwxuvhjyznp"],e:["bc01fg45238967deuvhjyznpkmstqrwx","p0r21436x8zb9dcf5h7kjnmqesgutwvy"],w:["238967debc01fg45kmstqrwxuvhjyznp","14365h7k9dcfesgujnmqp0r2twvyx8zb"]},r={n:["prxz","bcfguvyz"],s:["028b","0145hjnp"],e:["bcfguvyz","prxz"],w:["0145hjnp","028b"]},i=e.slice(-1),s=e.slice(0,-1),o=e.length%2;return r[t][o].indexOf(i)!==-1&&s!==""&&(s=this.adjacent(s,t)),s+this.base32.charAt(n[t][o].indexOf(i))},t.prototype.neighbours=function(e){return{n:this.adjacent(e,"n"),ne:this.adjacent(this.adjacent(e,"n"),"e"),e:this.adjacent(e,"e"),se:this.adjacent(this.adjacent(e,"s"),"e"),s:this.adjacent(e,"s"),sw:this.adjacent(this.adjacent(e,"s"),"w"),w:this.adjacent(e,"w"),nw:this.adjacent(this.adjacent(e,"n"),"w")}},t.prototype.contained=function(e,t,n,r,i){if(isNaN(t)||t>=90)t=89;if(isNaN(n)||n>180)n=180;if(isNaN(r)||r<=-90)r=-89;if(isNaN(e)||e<-180)e=-180;i=i||1;var s=this.encode(t,e,i),o=this.encode(t,n,i),u=this.encode(r,n,i),a=s,f=0,l=-1,c=[s,u],h=this.adjacent(s,"e");while(h!==u)c.push(h),++f,h===o||l===f?(l=f+1,f=0,h=this.adjacent(a,"s"),a=h):h=this.adjacent(h,"e");return c},t.prototype.calculateWidthDegrees=function(e){var t;e%2===0?t=-1:t=-0.5;var n=180/Math.pow(2,2.5*e+t);return n},t.prototype.width=function(e){var t=e%2;return 180/(2^(5*e+t)/2-1)};var n=function(){function s(){var s=Math.max(Math.log(n)/Math.LN2-8,0),o=Math.round(s+i),u=Math.pow(2,s-o+8),a=[(r[0]-n/2)/u,(r[1]-n/2)/u],f=[],l=e.range(Math.max(0,Math.floor(-a[0])),Math.max(0,Math.ceil(t[0]/u-a[0]))),c=e.range(Math.max(0,Math.floor(-a[1])),Math.max(0,Math.ceil(t[1]/u-a[1])));return c.forEach(function(e){l.forEach(function(t){f.push([t,e,o])})}),f.translate=a,f.scale=u,f}var t=[960,500],n=256,r=[t[0]/2,t[1]/2],i=0;return s.size=function(e){return arguments.length?(t=e,s):t},s.scale=function(e){return arguments.length?(n=e,s):n},s.translate=function(e){return arguments.length?(r=e,s):r},s.zoomDelta=function(e){return arguments.length?(i=+e,s):i},s},r=function(){function h(e){var t=e[0],n=e[1];return o=null,(a(t,n),o)||(f(t,n),o)||(l(t,n),o)||(c(t,n),o),o}var t=1e-6,n=e.geo.albers(),r=e.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),i=e.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),s=e.geo.conicEqualArea().rotate([66,0]).center([0,18]).parallels([8,18]),o,u={point:function(e,t){o=[e,t]}},a,f,l,c;return h.invert=function(e){var t=n.scale(),o=n.translate(),u=(e[0]-o[0])/t,a=(e[1]-o[1])/t;return(a>=.12&&a<.234&&u>=-0.425&&u<-0.214?r:a>=.166&&a<.234&&u>=-0.214&&u<-0.115?i:a>=.204&&a<.234&&u>=.32&&u<.38?s:n).invert(e)},h.stream=function(e){var t=n.stream(e),o=r.stream(e),u=i.stream(e),a=s.stream(e);return{point:function(e,n){t.point(e,n),o.point(e,n),u.point(e,n),a.point(e,n)},sphere:function(){t.sphere(),o.sphere(),u.sphere(),a.sphere()},lineStart:function(){t.lineStart(),o.lineStart(),u.lineStart(),a.lineStart()},lineEnd:function(){t.lineEnd(),o.lineEnd(),u.lineEnd(),a.lineEnd()},polygonStart:function(){t.polygonStart(),o.polygonStart(),u.polygonStart(),a.polygonStart()},polygonEnd:function(){t.polygonEnd(),o.polygonEnd(),u.polygonEnd(),a.polygonEnd()}}},h.precision=function(e){return arguments.length?(n.precision(e),r.precision(e),i.precision(e),s.precision(e),h):n.precision()},h.scale=function(e){return arguments.length?(n.scale(e),r.scale(e*.35),i.scale(e),s.scale(e),h.translate(n.translate())):n.scale()},h.translate=function(e){if(!arguments.length)return n.translate();var o=n.scale(),p=+e[0],d=+e[1];return a=n.translate(e).clipExtent([[p-.455*o,d-.238*o],[p+.455*o,d+.238*o]]).stream(u).point,f=r.translate([p-.307*o,d+.201*o]).clipExtent([[p-.425*o+t,d+.12*o+t],[p-.214*o-t,d+.234*o-t]]).stream(u).point,l=i.translate([p-.205*o,d+.212*o]).clipExtent([[p-.214*o+t,d+.166*o+t],[p-.115*o-t,d+.234*o-t]]).stream(u).point,c=s.translate([p+.35*o,d+.224*o]).clipExtent([[p+.32*o,d+.204*o],[p+.38*o,d+.234*o]]).stream(u).point,h},h.scale(1070)};return e.geo.albersUsaPr||(e.geo.albersUsaPr=r),{Geohash:t,Tile:n,albersUsaPr:r}}),define("css!src/map/Layered",[],function(){}),function(e,t){typeof define=="function"&&define.amd?define("src/map/Layered",["d3","topojson","../common/SVGWidget","./Utility","css!./Layered"],t):e.map_Layered=t(e.d3,e.topojson,e.common_SVGWidget,e.map_Utility)}(this,function(e,t,n,r){function o(){n.call(this),this._drawStartPos="origin",this._layers=[],this.projection("mercator")}var i=.25,s=2048/Math.PI;return o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype._class+=" map_Layered",o.prototype.publish("projection",null,"set","Map projection type",["albersUsa","albersUsaPr","azimuthalEqualArea","azimuthalEquidistant","conicEqualArea","conicConformal","conicEquidistant","equirectangular","gnomonic","mercator","orthographic","stereographic","transverseMercator"]),o.prototype.publish("centerLat",0,"number","Center Latitude",null,{tags:["Basic"]}),o.prototype.publish("centerLong",0,"number","Center Longtitude",null,{tags:["Basic"]}),o.prototype.publish("zoom",1,"number","Zoom Level",null,{tags:["Basic"]}),o.prototype.projection_orig=o.prototype.projection,o.prototype.projection=function(t){var n=o.prototype.projection_orig.apply(this,arguments);if(arguments.length){this._d3GeoProjection=e.geo[t]().scale(s).translate([0,0]);switch(t){case"orthographic":this._d3GeoProjection.clipAngle(90).rotate([0,0])}this._d3GeoPath=e.geo.path().projection(this._d3GeoProjection),this._zoomToFitOnNextRender=!0}return n},o.prototype.layers=function(e){return arguments.length?(this._layers=e,this):this._layers},o.prototype.size=function(e){var t=n.prototype.size.apply(this,arguments);return arguments.length&&(delete this._prevCenterLat,delete this._prevCenterLong),t},o.prototype.enter=function(t,r){n.prototype.enter.apply(this,arguments);var s=this;this._zoom=e.behavior.zoom().scaleExtent([.25*i,131072*i]).on("zoomstart",function(e){s._zoomstart_translate=s._zoom.translate(),s._zoomstart_scale=s._zoom.scale()}).on("zoom",function(){if(e.event&&e.event.sourceEvent&&e.event.sourceEvent.ctrlKey&&e.event.sourceEvent.type==="mousemove"){s.render();return}s.zoomed();var t=s.width()/2,n=s.height()/2,r=s.invert(t,n);s.centerLong(r[0]),s.centerLat(r[1]),s.zoom(s._zoom.scale()/i),s._prevCenterLong=s.centerLong(),s._prevCenterLat=s.centerLat(),s._prevZoom=s.zoom()}).on("zoomend",function(){}),this._zoomGrab=r.append("rect").attr("class","background"),this._layersTarget=r.append("g"),r.call(this._zoom)},o.prototype.update=function(t,r){n.prototype.update.apply(this,arguments);if(this._prevCenterLat!==this.centerLat()||this._prevCenterLong!==this.centerLong()||this._prevZoom!==this.zoom()){var o=e.geo[this.projection()]().scale(this.zoom()*i*s).translate([this.width()/2,this.height()/2]),u=o([this.centerLong(),this.centerLat()])||[this.width()/2,this.height()/2];this._zoom.scale(this.zoom()*i).translate([this.width()-u[0],this.height()-u[1]]),this._prevCenterLat=this.centerLat(),this._prevCenterLong=this.centerLong(),this._prevZoom=this.zoom()}this._zoomGrab.attr("width",this.width()).attr("height",this.height());var a=this._layersTarget.selectAll(".layerContainer").data(this.layers().filter(function(e){return e.visible()}),function(e){return e.id()}),f=this;a.enter().append("g").attr("class","layerContainer").each(function(t){t._svgElement=e.select(this),t._domElement=f._parentOverlay.append("div"),t.layerEnter(f,t._svgElement,t._domElement)}),a.each(function(e){e.layerUpdate(f)}),a.exit().each(function(e){e.layerExit(f),e._domElement.remove()}).remove(),a.order(),this.zoomed()},o.prototype.exit=function(e,t){n.prototype.enter.apply(this,arguments)},o.prototype.zoomed=function(){var e=this._layersTarget.selectAll(".layerContainer"),t=this;e.each(function(e){e.layerZoomed(t)})},o.prototype.render=function(e){n.prototype.render.apply(this,arguments),this._zoomToFitOnNextRender&&(this._zoomToFitOnNextRender=!1,this.zoomToFit())},o.prototype.project=function(e,t){e>=90?e=89:e<=-90&&(e=-89);var n=this._d3GeoProjection([t,e]);return n&&(n[0]*=this._zoom.scale(),n[1]*=this._zoom.scale(),n[0]+=this._zoom.translate()[0],n[1]+=this._zoom.translate()[1]),n},o.prototype.invert=function(e,t){return e-=this._zoom.translate()[0],t-=this._zoom.translate()[1],e/=this._zoom.scale(),t/=this._zoom.scale(),this._d3GeoProjection.invert([e,t])},o.prototype.zoomToFit=function(e){e=e||.95;var t=this._layersTarget.node().getBBox();if(t.width&&t.height){var n=this._zoom.translate(),r=t.x+t.width/2,i=t.y+t.height/2;n[0]-=r-this.width()/2,n[1]-=i-this.height()/2,this._zoom.translate(n);var s=this._zoom.scale(),o=s*Math.min(this.width()/t.width,this.height()/t.height);this._zoom.scale(o).event(this._layersTarget)}},o}),function(e,t){typeof define=="function"&&define.amd?define("src/map/Layer",["./Layered"],t):e.map_Layer=t(e.map_Layered)}(this,function(e,t){function n(t){e.call(this)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype._class+=" map_Layer",n.prototype.layerEnter=function(e,t,n){this._parentOverlay=e._parentOverlay},n.prototype.enter=function(t,n){e.prototype.enter.apply(this,arguments),this._svgElement=this._layersTarget.append("g"),this._domElement=this._parentOverlay.append("div"),this.layerEnter(this,this._svgElement,this._domElement)},n.prototype.layerUpdate=function(e){},n.prototype.update=function(t,n){e.prototype.update.apply(this,arguments),this.layerUpdate(this)},n.prototype.layerExit=function(e){},n.prototype.exit=function(t,n){this.layerExit(this),this._svgElement.remove(),this._domElement.remove(),e.prototype.exit.apply(this,arguments)},n.prototype.layerZoomed=function(e){},n.prototype.zoomed=function(){e.prototype.zoomed.apply(this,arguments),this.layerZoomed(this)},n}),define("css!src/map/Choropleth",[],function(){}),function(e,t){typeof define=="function"&&define.amd?define("src/map/Choropleth",["d3","topojson","./Layer","../common/Palette","../api/ITooltip","css!./Choropleth"],t):e.map_Choropleth=t(e.d3,e.topojson,e.map_Layer,e.common_Palette,e.api_ITooltip)}(this,function(e,t,n,r,i){function s(){n.call(this),i.call(this),this._dataMap={},this._path=e.select(null)}return s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype._class+=" map_Choropleth",s.prototype.implements(i.prototype),s.prototype._palette=r.rainbow("default"),s.prototype.publish("paletteID","YlOrRd","set","Palette ID",s.prototype._palette.switch(),{tags:["Basic","Shared"]}),s.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),s.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),s.prototype.publish("meshVisible",!0,"boolean","Mesh Visibility"),s.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),s.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),s.prototype.publish("internalOnly",!1,"boolean","Internal mesh only"),s.prototype.data=function(e){var t=n.prototype.data.apply(this,arguments);if(arguments.length){this._dataMap={},this._dataMinWeight=null,this._dataMaxWeight=null;var r=this;this.data().forEach(function(e){r._dataMap[e[0]]=e;if(!r._dataMinWeight||e[1]<r._dataMinWeight)r._dataMinWeight=e[1];if(!r._dataMaxWeight||e[1]>r._dataMaxWeight)r._dataMaxWeight=e[1]})}return t},s.prototype.layerEnter=function(e,t,r){n.prototype.layerEnter.apply(this,arguments),this._choroplethTransform=t.append("g"),this._choropleth=this._choroplethTransform.append("path").attr("class","mesh")},s.prototype.layerUpdate=function(e){n.prototype.layerUpdate.apply(this,arguments),this._palette=this._palette.switch(this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id()));if(!this.visible()||!this.meshVisible()){this._choropleth.attr("d",""),delete this._prevProjection;return}if(this._prevProjection!==e.projection()||this._prevInternalOnly!==this.internalOnly())this._choropleth.attr("d",e._d3GeoPath(t.mesh(this._choroTopology,this._choroTopologyObjects,this.internalOnly()?function(e,t){return e!==t}:function(e,t){return!0}))),this._prevProjection=e.projection(),this._prevInternalOnly=this.internalOnly();this._choropleth.style("stroke",this.meshColor())},s.prototype.layerExit=function(e){delete this._prevProjection,delete this._prevInternalOnly},s.prototype.layerZoomed=function(e){n.prototype.layerZoomed.apply(this,arguments),this._choroplethTransform.style("opacity",this.opacity()).attr("transform","translate("+e._zoom.translate()+")scale("+e._zoom.scale()+")").style("stroke-width",this.meshStrokeWidth()/e._zoom.scale()+"px")},s.prototype.click=function(e,t,n){console.log("Click:  "+JSON.stringify(e)+", "+t+", "+n)},s}),function(e,t){typeof define=="function"&&define.amd?define("src/map/ChoroplethContinents",["d3","topojson","./Choropleth","./countries","../common/Utility"],t):e.map_ChoroplethContinents=t(e.d3,e.topojson,e.map_Choropleth,e.map_countries,e.common_Utility)}(this,function(e,t,n,r,i){function s(){n.call(this),this._choroTopology=r.topology,this._choroTopologyObjects=r.topology.objects.land}return s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype._class+=" map_ChoroplethContinents",s}),function(e,t){typeof define=="function"&&define.amd?define("src/map/ChoroplethCounties",["d3","topojson","./Choropleth","./us-counties","../common/Utility"],t):e.map_ChoroplethCounties=t(e.d3,e.topojson,e.map_Choropleth,e.map_usCounties,e.common_Utility)}(this,function(e,t,n,r,i){function a(){n.call(this),this.projection("albersUsaPr"),this._choroTopology=r.topology,this._choroTopologyObjects=r.topology.objects.counties}var s=t.feature(r.topology,r.topology.objects.counties).features,o={};for(var u in s)s[u].id&&(o[s[u].id]=s[u]);return a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype._class+=" map_ChoroplethCounties",a.prototype.layerEnter=function(t,r,s){n.prototype.layerEnter.apply(this,arguments),this._choroplethCounties=this._choroplethTransform.insert("g",".mesh"),this._selection=new i.SimpleSelection(this._choroplethCounties),this.choroPaths=e.select(null)},a.prototype.layerUpdate=function(e){n.prototype.layerUpdate.apply(this,arguments),this.choroPaths=this._choroplethCounties.selectAll(".data").data(this.visible()?this.data():[],function(e){return e[0]});var t=this;this.choroPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(e){t._dataMap[e[0]]&&t.click(t.rowToObj(t._dataMap[e[0]]),"weight",t._selection.selected(this))}).on("mouseover.tooltip",function(e){t.tooltipShow([r.countyNames[e[0]],t._dataMap[e[0]]?t._dataMap[e[0]][1]:"N/A"],t.columns(),1)}).on("mouseout.tooltip",function(e){t.tooltipShow()}).on("mousemove.tooltip",function(e){t.tooltipShow([r.countyNames[e[0]],t._dataMap[e[0]]?t._dataMap[e[0]][1]:"N/A"],t.columns(),1)}),this.choroPaths.attr("d",function(t){var n=e._d3GeoPath(o[t[0]]);return n||console.log("Unknown US County:  "+t),n}).style("fill",function(e){var n=t._palette(e[1],t._dataMinWeight,t._dataMaxWeight);return n}),this.choroPaths.exit().remove()},a.prototype.layerZoomed=function(e){n.prototype.layerZoomed.apply(this,arguments),this.choroPaths.attr("stroke-width",1.5/e._zoom.scale()+"px")},a}),function(e,t){typeof define=="function"&&define.amd?define("src/map/ChoroplethCountries",["d3","topojson","./Choropleth","./countries","../common/Utility"],t):e.map_ChoroplethCountries=t(e.d3,e.topojson,e.map_Choropleth,e.map_countries,e.common_Utility)}(this,function(e,t,n,r,i){function a(){n.call(this),this._choroTopology=r.topology,this._choroTopologyObjects=r.topology.objects.countries}var s=t.feature(r.topology,r.topology.objects.countries).features,o={};for(var u in s)s[u].id&&r.countryNames[s[u].id]&&(o[r.countryNames[s[u].id].name]=s[u]);return a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype._class+=" map_ChoroplethCountries",a.prototype.layerEnter=function(t,r,s){n.prototype.layerEnter.apply(this,arguments),this._ChoroplethCountries=this._choroplethTransform.insert("g",".mesh"),this._selection=new i.SimpleSelection(this._ChoroplethCountries),this.choroPaths=e.select(null)},a.prototype.layerUpdate=function(e){n.prototype.layerUpdate.apply(this,arguments),this.choroPaths=this._ChoroplethCountries.selectAll(".data").data(this.visible()?this.data():[],function(e){return e[0]});var t=this;this.choroPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(e){t._dataMap[e[0]]&&t.click(t.rowToObj(t._dataMap[e[0]]),"weight",t._selection.selected(this))}).on("mouseover.tooltip",function(e){t.tooltipShow([e[0],e[1]],t.columns(),1)}).on("mouseout.tooltip",function(e){t.tooltipShow()}).on("mousemove.tooltip",function(e){t.tooltipShow([e[0],e[1]],t.columns(),1)}),this.choroPaths.attr("d",function(t){var n=e._d3GeoPath(o[t[0]]);return n||console.log("Unknown Country:  "+t),n}).style("fill",function(e){var n=t._palette(e[1],t._dataMinWeight,t._dataMaxWeight);return n}),this.choroPaths.exit().remove()},a.prototype.layerZoomed=function(e){n.prototype.layerZoomed.apply(this,arguments),this.choroPaths.attr("stroke-width",1.5/e._zoom.scale()+"px")},a}),function(e,t){typeof define=="function"&&define.amd?define("src/map/ChoroplethStates",["d3","topojson","./Choropleth","./us-states","../common/Utility"],t):e.map_ChoroplethStates=t(e.d3,e.topojson,e.map_Choropleth,e.map_usStates,e.common_Utility)}(this,function(e,t,n,r,i){function a(){n.call(this),this.projection("albersUsaPr"),this._choroTopology=r.topology,this._choroTopologyObjects=r.topology.objects.states}var s=t.feature(r.topology,r.topology.objects.states).features,o={};for(var u in s)s[u].id&&(o[r.stateNames[s[u].id].code]=s[u]);return a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype._class+=" map_ChoroplethStates",a.prototype.layerEnter=function(t,r,s){n.prototype.layerEnter.apply(this,arguments),this._choroplethStates=this._choroplethTransform.insert("g",".mesh"),this._selection=new i.SimpleSelection(this._choroplethStates),this.choroPaths=e.select(null)},a.prototype.layerUpdate=function(e){n.prototype.layerUpdate.apply(this,arguments),this.choroPaths=this._choroplethStates.selectAll(".data").data(this.visible()?this.data():[],function(e){return e[0]});var t=this;this.choroPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(e){t.click(t.rowToObj(e),"weight",t._selection.selected(this))}).on("mouseover.tooltip",function(e){var n=o[e[0]].id;t.tooltipShow([r.stateNames[n].name,e[1]],t.columns(),1)}).on("mouseout.tooltip",function(e){t.tooltipShow()}).on("mousemove.tooltip",function(e){var n=o[e[0]].id;t.tooltipShow([r.stateNames[n].name,e[1]],t.columns(),1)}),this.choroPaths.attr("d",function(t){var n=e._d3GeoPath(o[t[0]]);return n||console.log("Unknown US State:  "+t),n}).style("fill",function(e){var n=t._palette(e[1],t._dataMinWeight,t._dataMaxWeight);return n}),this.choroPaths.exit().remove()},a.prototype.layerZoomed=function(e){n.prototype.layerZoomed.apply(this,arguments),this.choroPaths.attr("stroke-width",1.5/e._zoom.scale()+"px")},a}),function(e,t){typeof define=="function"&&define.amd?define("src/map/ChoroplethStatesHeat",["../layout/Layered"],t):e.map_ChoroplethStatesHeat=t(e.layout_Layered)}(this,function(e){function t(t){e.call(this)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype._class+=" map_ChoroplethStatesHeat",t}),define("css!src/map/GeoHash",[],function(){}),function(e,t){typeof define=="function"&&define.amd?define("src/map/GeoHash",["d3","topojson","./Layer","./Utility","../common/Palette","../common/Utility","css!./GeoHash"],t):e.map_GeoHash=t(e.d3,e.topojson,e.map_Layer,e.map_Utility,e.common_Palette,e.common_Utility)}(this,function(e,t,n,r,i,s){function o(){n.call(this)}return o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype._class+=" map_GeoHash",o.prototype._palette=i.rainbow("default"),o.prototype.publish("paletteID","YlOrRd","set","Palette ID",o.prototype._palette.switch(),{tags:["Basic","Shared"]}),o.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),o.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),o.prototype.publish("meshVisible",!0,"boolean","Mesh Visibility"),o.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),o.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),o.prototype.data=function(e){var t=n.prototype.data.apply(this,arguments);return arguments.length&&(this._dataMinWeight=null,this._dataMaxWeight=null,this.data().forEach(function(e){if(!this._dataMinWeight||e[1]<this._dataMinWeight)this._dataMinWeight=e[1];if(!this._dataMaxWeight||e[1]>this._dataMaxWeight)this._dataMaxWeight=e[1]},this)),t},o.prototype.layerEnter=function(t,i,o){n.prototype.layerEnter.apply(this,arguments),this.geohash=new r.Geohash,this._geoHashTransform=i.append("g"),this._selection=new s.SimpleSelection(this._geoHashTransform),this.geoHashPaths=e.select(null)},o.prototype.layerUpdate=function(e){n.prototype.layerUpdate.apply(this,arguments),this._palette=this._palette.switch(this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id())),this.geoHashPaths=this._geoHashTransform.selectAll(".data").data(this.visible()?this.data():[],function(e){return e[0]});var t=this;this.geoHashPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(e){t.click(t.rowToObj(e),"weight",t._selection.selected(this))}),this.geoHashPaths.attr("d",function(n){var r=t.geohash.bounds(n[0]),i={type:"LineString",coordinates:[[r.sw.lon,r.ne.lat],[r.ne.lon,r.ne.lat],[r.ne.lon,r.sw.lat],[r.sw.lon,r.sw.lat]]};return e._d3GeoPath(i)}).style("fill",function(e){var n=t._palette(e[1],t._dataMinWeight,t._dataMaxWeight);return n}),this.geoHashPaths.exit().remove()},o.prototype.layerZoomed=function(e){n.prototype.layerZoomed.apply(this,arguments),this._geoHashTransform.style("opacity",this.opacity()).attr("transform","translate("+e._zoom.translate()+")scale("+e._zoom.scale()+")").attr("stroke-width",1.5/e._zoom.scale()+"px")},o.prototype.click=function(e,t,n){console.log("Click:  "+JSON.stringify(e)+", "+t+", "+n)},o}),define("css!src/map/GMap",[],function(){}),function(e,t){if(typeof define=="function"&&define.amd){var n=window.location.protocol!=="https"?"http://":"https://";define("src/map/GMap",["d3","../common/HTMLWidget","../layout/AbsoluteSurface","async!"+n+"maps.google.com/maps/api/js","css!./GMap"],t)}else e.map_GMap=t(e.d3,e.common_HTMLWidget,e.layout_AbsoluteSurface)}(this,function(e,t,n){function r(e,t,n){google.maps.OverlayView.call(this),this._div=null,this._worldSurface=t,this._viewportSurface=n,this._map=e,this.setMap(e);var r=this;google.maps.event.addListener(e,"bounds_changed",function(){r.draw()}),google.maps.event.addListener(e,"projection_changed",function(){r.draw()}),this._prevWorldMin={x:0,y:0},this._prevWorldMax={x:0,y:0},this._prevMin={x:0,y:0},this._prevMax={x:0,y:0}}function i(){function r(t,n,r){var i=e._overlay.getProjection(),s=i.fromLatLngToDivPixel(new google.maps.LatLng(n,r)),o=i.getWorldWidth(),u=parseFloat(t.widgetX()),a=parseFloat(t.widgetY()),f=parseFloat(t.widgetWidth());s.x-=u,s.y-=a;while(s.x<0)s.x+=o;while(s.x>f)s.x-=o;return s}t.call(this),this._tag="div";var e=this;this._worldSurface=new n,this._worldSurface.project=function(e,t){return r(this,e,t)},this._viewportSurface=new n,this._viewportSurface.project=function(e,t){return r(this,e,t)}}return r.prototype=google.maps.OverlayView.prototype,r.prototype.onAdd=function(){this.div=document.createElement("div"),this._viewportSurface.target(this.div).units("pixels");var e=this.getPanes();e.overlayMouseTarget.appendChild(this.div)},r.prototype.draw=function(){var e=this.getProjection();if(!e)return;var t=this._map.getBounds(),n=e.fromLatLngToDivPixel(t.getCenter()),r=e.fromLatLngToDivPixel(t.getSouthWest()),i=e.fromLatLngToDivPixel(t.getNorthEast()),s={x:r.x,y:i.y},o={x:i.x,y:r.y},u=e.getWorldWidth();while(o.x<s.x+100)o.x+=u;while(s.x>n.x)s.x-=u,o.x-=u;if(s.x!==this._prevMin.x||s.y!==this._prevMin.y||o.x!==this._prevMax.x||o.y!==this._prevMax.y)this._viewportSurface.widgetX(s.x).widgetY(s.y).widgetWidth(o.x-s.x).widgetHeight(o.y-s.y).render(),this._prevMin=s,this._prevMax=o;var a=e.fromLatLngToDivPixel(new google.maps.LatLng(85,-179.9)),f=e.fromLatLngToDivPixel(new google.maps.LatLng(-85,179.9));while(f.x<a.x+100)f.x+=u;while(a.x>n.x)a.x-=u,f.x-=u;if(a.x!==this._prevWorldMin.x||a.y!==this._prevWorldMin.y||f.x!==this._prevWorldMax.x||f.y!==this._prevWorldMax.y)this._worldSurface.widgetX(a.x).widgetY(a.y).widgetWidth(f.x-a.x).widgetHeight(f.y-a.y).render(),this._prevWorldMin=f,this._prevWorldMax=f},r.prototype.onRemove=function(){this._viewportSurface.target(null),this._div.parentNode.removeChild(this._div),this._div=null},i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype._class+=" map_GMap",i.prototype.publish("type","road","set","Map Type",["terrain","road","satellite","hybrid"],{tags:["Basic"]}),i.prototype.publish("centerLat",42.877742,"number","Center Latitude",null,{tags:["Basic"]}),i.prototype.publish("centerLong",-97.380979,"number","Center Longtitude",null,{tags:["Basic"]}),i.prototype.publish("zoom",4,"number","Zoom Level",null,{tags:["Basic"]}),i.prototype.publish("panControl",!0,"boolean","Pan Controls",null,{tags:["Basic"]}),i.prototype.publish("zoomControl",!0,"boolean","Pan Controls",null,{tags:["Basic"]}),i.prototype.publish("mapTypeControl",!1,"boolean","Pan Controls",null,{tags:["Basic"]}),i.prototype.publish("scaleControl",!0,"boolean","Pan Controls",null,{tags:["Basic"]}),i.prototype.publish("streetViewControl",!1,"boolean","Pan Controls",null,{tags:["Basic"]}),i.prototype.publish("overviewMapControl",!1,"boolean","Pan Controls",null,{tags:["Basic"]}),i.prototype.data=function(e){var n=t.prototype.data.apply(this,arguments);return n},i.prototype.getMapType=function(){switch(this.type()){case"terrain":return google.maps.MapTypeId.TERRAIN;case"road":return google.maps.MapTypeId.ROADMAP;case"satellite":return google.maps.MapTypeId.SATELLITE;case"hybrid":return google.maps.MapTypeId.HYBRID;default:return google.maps.MapTypeId.ROADMAP}},i.prototype.getMapOptions=function(){return{panControl:this.panControl(),zoomControl:this.zoomControl(),mapTypeControl:this.mapTypeControl(),scaleControl:this.scaleControl(),streetViewControl:this.streetViewControl(),overviewMapControl:this.overviewMapControl(),overviewMapControlOptions:{opened:!0}}},i.prototype.size=function(e){var n=t.prototype.size.apply(this,arguments);return arguments.length&&this._googleMapNode&&(this._googleMapNode.style({width:e.width+"px",height:e.height+"px"}),google.maps.event.trigger(this._googleMap,"resize")),n},i.prototype.enter=function(n,i){t.prototype.enter.apply(this,arguments),this._googleMapNode=i.append("div").style({width:this.width()+"px",height:this.height()+"px"}),this._googleMap=new google.maps.Map(this._googleMapNode.node(),{zoom:this.zoom(),center:new google.maps.LatLng(this.centerLat(),this.centerLong()),mapTypeId:this.getMapType(),disableDefaultUI:!0}),this._overlay=new r(this._googleMap,this._worldSurface,this._viewportSurface),this._circleMap=e.map([]),this._pinMap=e.map([]),this._prevCenterLat=this.centerLat(),this._prevCenterLong=this.centerLong(),this._prevZoom=this.zoom()},i.prototype.update=function(e,t){this._googleMap.setMapTypeId(this.getMapType()),this._googleMap.setOptions(this.getMapOptions());if(this._prevCenterLat!==this.centerLat()||this._prevCenterLong!==this.centerLong())this._googleMap.setCenter(new google.maps.LatLng(this.centerLat(),this.centerLong())),this._prevCenterLat=this.centerLat(),this._prevCenterLong=this.centerLong();this._prevZoom!==this.zoom()&&(this._googleMap.setZoom(this.zoom()),this._prevZoom=this.zoom()),this.updateCircles(),this.updatePins()},i.prototype.updateCircles=function(){function t(e){return e[0]+"_"+e[1]}var n=[],r=[],i=e.map(this._circleMap.keys(),function(e){return e});this.data().forEach(function(e){i.remove(t(e)),e[3]&&!this._circleMap.has(t(e))?n.push(e):e[3]&&this._circleMap.has(t(e))?r.push(e):!e[3]&&this._circleMap.has(t(e))&&i.set(t(e),!0)},this),n.forEach(function(e){var n=this.createCircle(e[0],e[1],e[3],"");this._circleMap.set(t(e),n)},this),r.forEach(function(e){},this);var s=this;i.forEach(function(e){s._circleMap.get(e).setMap(null),s._circleMap.remove(e)})},i.prototype.updatePins=function(){function t(e){return e[0]+"_"+e[1]}var n=[],r=[],i=e.map(this._pinMap.keys(),function(e){return e});this.data().forEach(function(e){i.remove(t(e)),e[2]&&!this._pinMap.has(t(e))?n.push(e):e[2]&&this._pinMap.has(t(e))?r.push(e):!e[2]&&this._pinMap.has(t(e))&&i.set(t(e),!0)},this),n.forEach(function(e){var n=this.createMarker(e[0],e[1],e[2],"");this._pinMap.set(t(e),n)},this),r.forEach(function(e){this._pinMap.get(t(e)).setIcon(this.createIcon(e[2]))},this);var s=this;i.forEach(function(e){s._pinMap.get(e).setMap(null),s._pinMap.remove(e)})},i.prototype.createIcon=function(e){return{path:"M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z M -2,-30",fillColor:e.fillColor,fillOpacity:e.fillOpacity||.8,scale:.5,strokeColor:e.strokeColor||"black",strokeWeight:.25}},i.prototype.createMarker=function(e,t,n){return new google.maps.Marker({position:new google.maps.LatLng(e,t),animation:google.maps.Animation.DROP,title:n.title||"",icon:this.createIcon(n),map:this._googleMap})},i.prototype.createCircle=function(e,t,n){return new google.maps.Circle({center:new google.maps.LatLng(e,t),radius:16093*n.radius/10,fillColor:n.fillColor||"red",strokeColor:n.strokeColor||n.fillColor||"black",strokeWeight:.5,map:this._googleMap})},i.prototype.zoomTo=function(e){var t=0,n=new google.maps.LatLngBounds;return e.forEach(function(e){var r=new google.maps.LatLng(e[0],e[1]);n.extend(r),++t}),t&&(this._googleMap.setCenter(n.getCenter()),this._googleMap.fitBounds(n),this._googleMap.getZoom()>12&&this._googleMap.setZoom(12)),this},i.prototype.zoomToFit=function(){return this.zoomTo(this.data())},i}),function(e,t){typeof define=="function"&&define.amd?define("src/map/GMapGraph",["./GMap","../graph/Graph","../graph/Edge","../common/Shape"],t):e.map_GMapGraph=t(e.map_GMap,e.graph_Graph,e.graph_Edge,e.common_Shape)}(this,function(e,t,n,r){function i(){e.call(this)}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype._class+=" map_GMapGraph",i.prototype.enter=function(){e.prototype.enter.apply(this,arguments);var i=(new t).layout("None"),s=i.render,o=this;i.render=function(){var e=[],t=[],i=null;o.data().forEach(function(s){var u=o._viewportSurface.project(s[0],s[1]),a=(new r).shape("circle").radius(3).data(s).pos(u);e.push(a),i&&t.push((new n).sourceVertex(i).targetVertex(a).targetMarker("arrowHead")),i=a}),this.data({vertices:e,edges:t}),s.apply(this,arguments),this.graphData.nodeValues().forEach(function(e){var t=o._viewportSurface.project(e.data()[0],e.data()[1]);t.x-=o.width()/2,t.y-=o.height()/2,e.move(t)}),this.graphData.edgeValues().forEach(function(e){e.points([])})},this._viewportSurface.widget(i)},i}),function(e,t){typeof define=="function"&&define.amd?define("src/map/GMapHeat",["./GMap","../other/HeatMap"],t):e.map_GMapHeat=t(e.map_GMap,e.other_HeatMap)}(this,function(e,t){function n(){e.call(this)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype._class+=" map_GMapHeat",n.prototype.enter=function(){e.prototype.enter.apply(this,arguments);var n=new t,r=n.render,i=this;n.render=function(){this.data(i.data().map(function(e){var t=i._viewportSurface.project(e[0],e[1]);return[t.x,t.y,e[4]]})),r.apply(this,arguments)},this._viewportSurface.widget(n)},n}),function(e,t){typeof define=="function"&&define.amd?define("src/map/GMapLayered",["d3","./GMap","../common/SVGWidget"],t):e.map_GMapLayered=t(e.d3,e.map_GMap,e.common_SVGWidget)}(this,function(e,t,n){function s(){n.call(this),this._drawStartPos="origin"}function o(){t.call(this),this._layers=[]}var r=1/16,i=4096;return s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype._class+=" map_Layered",s.prototype.enter=function(t,r){n.prototype.enter.apply(this,arguments),this._zoom=e.behavior.zoom().translate([0,0]).scale(1),this._d3GeoProjection=e.geo.mercator().scale(i/2/Math.PI).translate([0,0]),this._d3GeoPath=e.geo.path().projection(this._d3GeoProjection)},s.prototype.update=function(e,t){n.prototype.update.apply(this,arguments),this._hasZoomed=!0,this._hasRendered?this.zoomed():this.fullRender()},s.prototype.fullRender=function(){if(!this._hasZoomed)return;this._hasRendered=!0,this.size(this.gmap.size());var t=this._element.selectAll(".layerContainer").data(this.gmap.layers(),function(e){return e.id()}),n=this;t.enter().append("g").attr("class","layerContainer").each(function(t){var r=e.select(this),i=n._parentOverlay.append("div");t.layerEnter(n,r,i)}),t.each(function(e){e.layerUpdate(n)}),t.exit().each(function(e){e.layerExit(n)}).remove(),this.zoomed()},s.prototype.zoomed=function(){var e=this.gmap._overlay.getProjection();if(e){var t=new google.maps.LatLng(0,0),n=e.fromLatLngToDivPixel(t),i=parseFloat(this.surface.widgetX()),s=parseFloat(this.surface.widgetY()),o=[n.x-i,n.y-s],u=this.gmap._googleMap.getZoom();this._zoom.scale(r*(1<<u)).translate(o);var a=this._element.selectAll(".layerContainer"),f=this;a.each(function(e){e.layerZoomed(f)})}},s.prototype.projection=function(){return"mercator"},s.prototype.project=function(e,t){var n=this.surface.project(e,t);return[n.x,n.y]},o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype._class+=" map_GMapLayered",o.prototype.layers=function(e){return arguments.length?(this._layers=e,this):this._layers},o.prototype.enter=function(){t.prototype.enter.apply(this,arguments),this.layered=new s,this.layered.gmap=this,this.layered.surface=this._viewportSurface,this.layered.surface.widget(this.layered).render()},o.prototype.render=function(e){t.prototype.render.apply(this,arguments),this.layered.fullRender()},o}),define("css!src/map/Pins",[],function(){}),function(e,t){typeof define=="function"&&define.amd?define("src/map/Pins",["d3","topojson","./Layer","./Utility","../common/Palette","../common/Utility","css!./Pins"],t):e.map_Pins=t(e.d3,e.topojson,e.map_Layer,e.map_Utility,e.common_Palette,e.common_Utility)}(this,function(e,t,n,r,i,s){function o(){n.call(this)}return o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype._class+=" map_Pins",o.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),o.prototype.publish("pinColor","#006ccc","html-color","Pin Color",null,{optional:!0}),o.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),o.prototype.layerEnter=function(t,r,i){n.prototype.layerEnter.apply(this,arguments),this._pinsTransform=r,this._selection=new s.SimpleSelection(this._pinsTransform),this.pinsPaths=e.select(null)},o.prototype.layerUpdate=function(e){n.prototype.layerUpdate.apply(this,arguments),this.pinsPaths=this._pinsTransform.selectAll(".data").data(this.visible()?this.data():[],function(e){return e[0]});var t=this;this.pinsPaths.enter().append("path").attr("class","data").attr("d",function(e){return"M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z M -2,-30"}).call(this._selection.enter.bind(this._selection)).on("click",function(e){t.click(t.rowToObj(e),"weight",t._selection.selected(this))}),this.pinsPaths.style("fill",function(e){return e[2]&&e[2].fillColor?e[2].fillColor:t.pinColor()}),this.pinsPaths.exit().remove()},o.prototype.layerZoomed=function(e){n.prototype.layerZoomed.apply(this,arguments),this.pinsPaths.style("display",function(t){var n=e.project(t[0],t[1]);return n?null:"none"}).attr("transform",function(t){var n=e.project(t[0],t[1]);return n||(n=[0,0]),"translate("+n[0]+", "+n[1]+")scale("+.5+")"}).attr("stroke-width","1.5px")},o.prototype.click=function(e,t,n){console.log("Click:  "+JSON.stringify(e)+", "+t+", "+n)},o}),define("css!src/map/Graph",[],function(){}),function(e,t){typeof define=="function"&&define.amd?define("src/map/Graph",["d3","topojson","./Pins","../graph/Graph","../graph/Edge","../common/Shape","css!./Graph"],t):e.map_Graph=t(e.d3,e.topojson,e.map_Pins,e.graph_Graph,e.graph_Edge,e.common_Shape)}(this,function(e,t,n,r,i,s){function o(){n.call(this)}return o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype._class+=" map_Graph",o.prototype.data=function(e){var t=n.prototype.data.apply(this,arguments);if(arguments.length){this.dataEdges=[];var r=null;e.forEach(function(e){r&&this.dataEdges.push({type:"LineString",coordinates:[[r[1],r[0]],[e[1],e[0]]]}),r=e},this)}return t},o.prototype.layerEnter=function(t,r,i){n.prototype.layerEnter.apply(this,arguments),r.append("defs").append("marker").attr("class","marker").attr("id",this._id+"_arrowHead").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",16).attr("markerHeight",16).attr("markerUnits","strokeWidth").attr("orient","auto").append("polyline").attr("points","0,0 10,5 0,10 1,5"),this._edgesTransform=r.append("g"),this.edgesPaths=e.select(null)},o.prototype.layerUpdate=function(e){n.prototype.layerUpdate.apply(this,arguments),this.edgesPaths=this._edgesTransform.selectAll(".dataEdge").data(this.visible()?this.dataEdges:[]),this.edgesPaths.enter().append("path").attr("class","dataEdge").attr("marker-end","url(#"+this._id+"_arrowHead)"),this.edgesPaths.attr("d",e._d3GeoPath),this.edgesPaths.exit().remove()},o.prototype.layerZoomed=function(e){n.prototype.layerZoomed.apply(this,arguments),this._edgesTransform.style("opacity",this.opacity()).attr("transform","translate("+e._zoom.translate()+")scale("+e._zoom.scale()+")").style("stroke-width",.5/e._zoom.scale()+"px")},o}),define("css!src/map/Graticule",[],function(){}),function(e,t){typeof define=="function"&&define.amd?define("src/map/Graticule",["d3","topojson","./Layer","../common/Palette","../api/ITooltip","css!./Graticule"],t):e.map_Graticule=t(e.d3,e.topojson,e.map_Layer,e.common_Palette,e.api_ITooltip)}(this,function(e,t,n,r,i){function s(){n.call(this),i.call(this),this._dataMap={},this._path=e.select(null)}return s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype._class+=" map_Graticule",s.prototype.implements(i.prototype),s.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),s.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),s.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),s.prototype.layerEnter=function(t,r,i){n.prototype.layerEnter.apply(this,arguments),this._graticule=e.geo.graticule(),this._graticulePath=r.append("path").datum(this._graticule).attr("class","graticule"),this._graticuleOutlinePath=r.append("path").datum(this._graticule.outline).attr("class","graticuleOutline")},s.prototype.layerUpdate=function(e){if(!this.visible()){this._graticulePath.attr("d",""),this._graticuleOutlinePath.attr("d",""),delete this._prevProjection;return}this._prevProjection!==e.projection()&&(this._graticulePath.attr("d",e._d3GeoPath),this._graticuleOutlinePath.attr("d",e._d3GeoPath),this._prevProjection=e.projection()),this._graticulePath.style("stroke",this.meshColor()),this._graticuleOutlinePath.style("stroke",this.meshColor())},s.prototype.layerExit=function(e){delete this._prevProjection},s.prototype.layerZoomed=function(e){this._graticulePath.style("opacity",this.opacity()).attr("transform","translate("+e._zoom.translate()+")scale("+e._zoom.scale()+")").style("stroke-width",this.meshStrokeWidth()/e._zoom.scale()+"px"),this._graticuleOutlinePath.style("opacity",this.opacity()).attr("transform","translate("+e._zoom.translate()+")scale("+e._zoom.scale()+")").style("stroke-width",this.meshStrokeWidth()/e._zoom.scale()+"px")},s}),define("css!src/map/Heat",[],function(){}),function(e,t){typeof define=="function"&&define.amd?define("src/map/Heat",["d3","topojson","./Layer","../other/HeatMap","../common/Palette","../api/ITooltip","css!./Heat"],t):e.map_Heat=t(e.d3,e.topojson,e.map_Layer,e.other_HeatMap,e.common_Palette,e.api_ITooltip)}(this,function(e,t,n,r,i,s){function o(){n.call(this)}return o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype._class+=" map_Heat",o.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),o.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),o.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),o.prototype.layerEnter=function(e,t,i){n.prototype.layerEnter.apply(this,arguments),this._parentOverlay.style("pointer-events","none"),this._heatTransform=i.style("pointer-events","none").append("div").attr("class",this.classID()).style("width",e.width()+"px").style("height",e.height()+"px"),this.heat=(new r).target(this._heatTransform.node())},o.prototype.layerUpdate=function(e){n.prototype.layerUpdate.apply(this,arguments),this._heatTransform.style("width",e.width()+"px").style("height",e.height()+"px"),this.heat.resize(e.size()),this.heat.columns(this.columns()).data(this.data().map(function(t){var n=e.project(t[0],t[1]);return[n[0],n[1],t[4]]})).render()},o.prototype.layerExit=function(e){delete this._prevProjection,this.heat.target(null),delete this.heat},o.prototype.layerZoomed=function(e){n.prototype.layerZoomed.apply(this,arguments),this.heat.columns(this.columns()).data(this.visible()?this.data().map(function(t){var n=e.project(t[0],t[1]);return[n[0],n[1],t[4]]}):[]).render()},o}),function(e,t){typeof define=="function"&&define.amd?define("src/map/IChoropleth",["../common/Palette"],t):e.map_IChoropleth=t(e.common_Palette,e.usStates,e.usCounties)}(this,function(e,t,n){function r(){}return r.prototype._palette=e.rainbow("default"),r.prototype.click=function(e,t,n){console.log("Click:  "+JSON.stringify(e)+", "+t+", "+n)},r}),define("css!src/map/OpenStreet",[],function(){}),function(e,t){typeof define=="function"&&define.amd?define("src/map/OpenStreet",["d3","topojson","./Layer","./Utility","css!./OpenStreet"],t):e.map_OpenStreet=t(e.d3,e.topojson,e.map_Layer,e.map_Utility)}(this,function(e,t,n,r){function i(){n.call(this)}return i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype._class+=" map_OpenStreet",i.prototype._copyrightText=" OpenStreetMap contributors",i.prototype.publish("tileProvider","OpenStreetMap","set","Tile Provider",["OpenStreetMap","OpenStreetMap Hot","MapQuest","MapQuest Sat","Stamen Watercolor","OpenCycleMap"],{tags:["Basic","Shared"]}),i.prototype.layerEnter=function(e,t,i){n.prototype.layerEnter.apply(this,arguments),this._tile=r.Tile(),this._openStreetTransform=t.append("g"),this._openStreet=this._openStreetTransform.append("g"),this._copyright=t.append("text").attr("x",-100).attr("y",-100).style("opacity",.5).text(this._copyrightText),this._copyrightBBox=this._copyright.node().getBBox()},i.prototype.layerUpdate=function(e){this.visible()?this._copyright.attr("x",e.width()-this._copyrightBBox.width-this._copyrightBBox.height/2).attr("y",e.height()-this._copyrightBBox.height/2).text(this._copyrightText):this._copyright.text("")},i.prototype.layerZoomed=function(e){var t=[];if(this.visible()){var n=e.project(-85,180);if(!n||n[0]<=0||n[1]<=0)n=[e.width(),e.height()];this._tile.size([Math.min(e.width(),n[0]),Math.min(e.height(),n[1])]).scale(e._zoom.scale()*4096).translate(e._zoom.translate()),t=this._tile(),this._openStreetTransform.attr("transform","scale("+t.scale+")translate("+t.translate+")")}this._prevTileProvider!==this.tileProvider()&&(this._openStreet.selectAll("image").remove(),this._prevTileProvider=this.tileProvider());var r=this,i=this._openStreet.selectAll("image").data(t,function(e){return e[2]+"/"+e[0]+"/"+e[1]});i.enter().append("image").attr("xlink:href",function(e){switch(r.tileProvider()){case"OpenStreetMap Hot":return"http://"+["a","b","c"][Math.random()*3|0]+".tile.openstreetmap.fr/hot/"+e[2]+"/"+e[0]+"/"+e[1]+".png";case"MapQuest":return"http://otile"+["1","2","3","4"][Math.random()*4|0]+".mqcdn.com/tiles/1.0.0/osm/"+e[2]+"/"+e[0]+"/"+e[1]+".png";case"MapQuest Sat":return"http://otile"+["1","2","3","4"][Math.random()*4|0]+".mqcdn.com/tiles/1.0.0/sat/"+e[2]+"/"+e[0]+"/"+e[1]+".png";case"Stamen Watercolor":return"http://"+["a","b","c"][Math.random()*3|0]+".tile.stamen.com/watercolor/"+e[2]+"/"+e[0]+"/"+e[1]+".png";case"OpenCycleMap":return"http://"+["a","b"][Math.random()*2|0]+".tile.opencyclemap.org/cycle/"+e[2]+"/"+e[0]+"/"+e[1]+".png";default:return"http://"+["a","b","c"][Math.random()*3|0]+".tile.openstreetmap.org/"+e[2]+"/"+e[0]+"/"+e[1]+".png"}}).attr("width",1).attr("height",1).attr("x",function(e){return e[0]}).attr("y",function(e){return e[1]}).style("opacity",0).transition().duration(500).style("opacity",1),i.exit().remove()},i}),function(e,t){typeof define=="function"&&define.amd?define("src/map/TestHeatMap",["../layout/Layered","../layout/AbsoluteSurface","./ChoroplethStates","../other/HeatMap"],t):e.map_TestHeatMap=t(e.layout_Layered,e.layout_AbsoluteSurface,e.map_ChoroplethStates,e.other_HeatMap)}(this,function(e,t,n,r){function i(t){e.call(this)}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype._class+=" map_TestHeatMap",i}),function(e){var t=document,n="appendChild",r="styleSheet",i=t.createElement("style");i.type="text/css",t.getElementsByTagName("head")[0][n](i),i[r]?i[r].cssText=e:i[n](t.createTextNode(e))}(".map_Layered .background{fill:#fff}.map_Layered .raster image{fill:#b5d0d0}.map_Layered .hash path{fill:none;stroke:red;stroke-linejoin:round}.map_Layered .checkerFill{fill:red;stroke:red;opacity:.5}.map_Layered .checkerNoFill{fill:none;stroke:none;opacity:.5}.map_Layered .mesh{fill:none;stroke:#6d6e71}.map_GMap .marker{fill:#656565;stroke:none;stroke-width:1px}.map_GMap .map_Layered{pointer-events:auto;cursor:auto}.gm-style img{max-width:none}.gm-style label{width:auto;display:inline}.map_Layered .data{stroke:none}.map_Layered .data.selected{stroke:red}.map_Layered .data.over{stroke:orange}.map_Layered .data.selected.over{stroke:red}.map_Layered .marker{fill:#656565;stroke:none;stroke-width:1px}.map_Layered .dataEdge{stroke:#000;fill:none}.map_Layered .graticule{fill:none;stroke:#a9a9a9;stroke-linejoin:round}.map_Layered .graticuleOutline{fill:none;stroke:#000;stroke-linejoin:round}.map_Heat{//pointer-events:none}.map_Heat canvas{pointer-events:none}.map_OpenStreet .background{fill:#fff}.map_OpenStreet .graticule{fill:none;stroke:#777;stroke-width:.5px;stroke-opacity:.5}.map_Layered .vector{fill:none;stroke:navy;stroke-linejoin:round}"),define("hpcc-viz-map",function(){});