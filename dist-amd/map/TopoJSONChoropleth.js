!function(o,t){"function"==typeof define&&define.amd?define(["d3","topojson","./Choropleth","require"],t):o.map_TopoJSONChoropleth=t(o.d3,o.topojson,o.map_Choropleth,o.require)}(this,function(o,t,e,n){function i(){e.call(this),this.projection("mercator")}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype._class+=" map_TopoJSONChoropleth",i.prototype.publish("region","GB","set","Region Data",["AT","BE","BG","CHLI","CY","CZ","DE","DK","EE","ES","FI","FR","GB","GE","GR","HR","HU","IE","IS","IT","KS","LT","LU","LV","MD","MK","MT","ND","NL","NO","PL","PT","RO","RS","SE","SI","SK","UA"]),i.prototype.layerEnter=function(t,n,i){e.prototype.layerEnter.apply(this,arguments),this._selection.widgetElement(this._choroplethData),this.choroPaths=o.select(null);var r=this;this.tooltipHTML(function(o){var t=r.columns(),e=t&&t.length?t[0]:"Location",n=o&&o.length?o[o.length-1]:[""];return r.tooltipFormat({label:n[0],series:e,value:o[1]})})},i.prototype.layerUpdate=function(o){e.prototype.layerUpdate.apply(this,arguments);var t=[],n=this;this.data().forEach(function(o){if(isNaN(o[0]))for(var e in n._choroTopologyIndex)for(var i in n._choroTopologyIndex[e])i===o[0]&&n._choroTopologyIndex[e][i].forEach(function(e){t.push([e].concat(o.filter(function(o,t){return t>0})).concat([o]))});else t.push(o.concat([o]))}),this.choroPaths=this._choroplethData.selectAll(".data").data(this.visible()?t:[],function(o){return o[0]}),this.choroPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(o){n._dataMap[o[0]]&&n.click(n.rowToObj(n._dataMap[o[0]]),"weight",n._selection.selected(n))}).on("dblclick",function(o){n._dataMap[o[0]]&&n.dblclick(n.rowToObj(n._dataMap[o[0]]),"weight",n._selection.selected(n))}).on("mouseout.tooltip",this.tooltip.hide).on("mousemove.tooltip",this.tooltip.show),this.choroPaths.attr("d",function(t){var e=o._d3GeoPath(n._choroTopologyFeatures[t[0]]);return e||console.log("Unknown Country:  "+t),e}).style("fill",function(o){var t=n._palette(o[1],n._dataMinWeight,n._dataMaxWeight);return t}),this.choroPaths.exit().remove()},i.prototype.layerPreRender=function(){if(this._prevRegion!==this.region()&&(this._prevRegion=this.region(),delete this._topoJsonPromise),!this._topoJsonPromise){var o=this;this._topoJsonPromise=new Promise(function(e,i){n(["json!src/map/TopoJSON/"+o.region()+".json"],function(i){function r(t){o._choroTopologyIndex=t,e()}o._choroTopology=i,o._choroTopologyObjects=i.objects.PolbndA,o._choroTopologyFeatures=t.feature(o._choroTopology,o._choroTopologyObjects).features,n(["json!src/map/TopoJSON/"+o.region()+"_idx.json"],r,function(o){r({})})})})}return this._topoJsonPromise},i});