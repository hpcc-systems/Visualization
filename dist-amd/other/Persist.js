(function(e,t){typeof define=="function"&&define.amd?define(["require"],t):e.other_Persist=t(e.require)})(this,function(e){function t(e){var t=[],n=e._id===undefined;for(var r in e)if(r.indexOf("__meta_")>=0){var i=e,s=i[r];if(s.type)if(!n||s.type!=="proxy"){while(s.type==="proxy")i=i[s.proxy],s=i["__meta_"+s.method];s.id!==e[r].id&&(s=JSON.parse(JSON.stringify(s)),s.id=e[r].id),t.push(s)}}return t}function n(e,r){if(!e)return;r(e);var i=t(e);for(var s=0;s<i.length;++s){var o=i[s];switch(o.type){case"widget":n(e[o.id](),r);break;case"widgetArray":var u=e[o.id]();u.forEach(function(e){n(e,r)})}}}function r(e,n,r){var i=t(e);for(var s=0;s<i.length;++s){var o=i[s];(typeof n!="function"||!n(e,o))&&r(e,o)}}function i(e,t,i){n(e,function(e){r(e,t,i)})}return{discover:t,widgetWalker:n,propertyWalker:r,widgetPropertyWalker:i,serializeTheme:function(e,t){return JSON.stringify(this.serializeThemeToObject(e,t))},serializeThemeToObject:function(e,t){function r(e,t){var n=!1;for(var r in t)if(e.indexOf(t[r])!==-1){n=!0;break}return n}t=t||["surface","Color","Font","palette"];var n={};return i(e,null,function(e,i){if(e[i.id+"_modified"]()||e["__meta_"+i.id].origDefaultValue!==e["__meta_"+i.id].defaultValue)if(r(i.id,t)){var s=e._class.trim().split(" ");for(var o in s){n[s[o]]===undefined&&(n[s[o]]={});if(n[s[o]][i.id]===undefined){n[s[o]][i.id]=e[i.id]();break}if(n[s[o]][i.id]===e[i.id]())break}}}),n},removeTheme:function(e,t){i(e,null,function(e,t){e["__meta_"+t.id].defaultValue=e["__meta_"+t.id].origDefaultValue}),typeof t=="function"&&t.call(this)},applyTheme:function(e,t,n){var r=this;i(e,null,function(e,n){switch(n.type){case"widget":return r.applyTheme(e[n.id](),t),!0;case"widgetArray":var i=e[n.id]();return i.forEach(function(e){r.applyTheme(e,t)},this),!0;default:e.applyTheme(t)}}),typeof n=="function"&&n.call(this)},serializeToObject:function(e,t,n){var i={__version:3,__class:e.classID(),__properties:{}};e._id.indexOf("_w")!==0&&(i.__id=e._id);var s=this;r(e,t,function(e,t){if(e[t.id+"_modified"]())switch(t.type){case"widget":return i.__properties[t.id]=s.serializeToObject(e[t.id](),null,n),!0;case"widgetArray":i.__properties[t.id]=[];var r=e[t.id]();return r.forEach(function(e,r){i.__properties[t.id].push(s.serializeToObject(e,null,n))}),!0;default:i.__properties[t.id]=e[t.id]()}});if(e.classID()==="marshaller_Graph"){var o=e.data().vertices;o&&(this.__vertices=o.map(function(e){return this.serializeToObject(e,null,n)},this))}return n&&(i.__data={},i.__data.columns=e.columns(),i.__data.data=e.data()),i},serialize:function(e,t,n){return JSON.stringify(this.serializeToObject(e,t,n))},deserializeFromObject:function(e,t,n){var r=0,s=this;i(e,null,function(e,n){e[n.id+"_reset"]();if(t.__properties[n.id]!==undefined)switch(n.type){case"widget":++r;var i=n.id;s.create(t.__properties[n.id],function(t){e[i](t),--r});break;case"widgetArray":++r;var o=n.id,u=t.__properties[n.id],a=[];a.length=u.length;var f=0;u.forEach(function(t,n){++f,s.create(t,function(e){a[n]=e,--f});var i=setInterval(function(){f<=0&&(clearInterval(i),f=undefined,e[o](a),--r)},20)});break;default:e[n.id](t.__properties[n.id])}});var o=setInterval(function(){if(r<=0){clearInterval(o),r=undefined;if(t.__data)for(var i in t.__data)e[i](t.__data[i]);n(e)}},20)},deserialize:function(e,t,n){typeof t=="string"&&(t=JSON.parse(t)),t.__id&&t.__id.indexOf("_w")!==0&&e._id!==t.__id&&console.log("Deserialize:  IDs do not match - "+e._id),this.deserializeFromObject(e,t,n)},create:function(t,n){typeof t=="string"&&(t=JSON.parse(t));var r="src/"+t.__class.split("_").join("/"),i=this;e([r],function(e){var r=new e;t.__id&&t.__id.indexOf("_w")!==0&&(r._id=t.__id),i.deserializeFromObject(r,t,n)})},clone:function(e,t){this.create(this.serializeToObject(e,[],!0),t)}}});