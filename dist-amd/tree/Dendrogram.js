(function(e,t){typeof define=="function"&&define.amd?define(["d3","../common/SVGWidget","../api/ITree","css!./Dendrogram"],t):e.tree_Dendrogram=t(e.d3,e.common_SVGWidget,e.api_ITree)})(this,function(e,t,n){function r(e){t.call(this),n.call(this),this._drawStartPos="origin",this._maxTextWidth=0}return r.prototype=Object.create(t.prototype),r.prototype._class+=" tree_Dendrogram",r.prototype.implements(n.prototype),r.prototype.publish("paletteID","default","set","Palette ID",r.prototype._palette.switch(),{tags:["Basic","Shared"]}),r.prototype.publish("textOffset",8,"number","Text offset from circle",null,{tags:["Private"]}),r.prototype.publish("orientation","horizontal","set","Orientation",["horizontal","vertical"],{tags:["Private"]}),r.prototype.enter=function(n,r){t.prototype.enter.apply(this,arguments);var i=this;this.layout=e.layout.cluster(),this.diagonal=e.svg.diagonal().projection(function(e){return i.orientation()==="horizontal"?[e.y,e.x]:[e.x,e.y]})},r.prototype.update=function(n,r,i){var s=this;t.prototype.update.apply(this,arguments),this._palette=this._palette.switch(this.paletteID()),this.x(this._maxTextWidth);var o=this.width()-this._maxTextWidth*2;this.orientation()==="horizontal"?this.layout.size([this.height(),o]):this.layout.size([o,this.height()]);var u=this.layout.nodes(this.data()),a=this.layout.links(u),f=r.selectAll(".link").data(a);f.enter().append("path").attr("class","link"),f.attr("d",this.diagonal),f.exit().remove();var l=r.selectAll(".node").data(u);l.enter().append("g").attr("class","node").on("click",function(e){s.click(e)}).each(function(t){var n=e.select(this);n.append("circle"),n.append("text")});var c=0;l.attr("transform",function(e){return s.orientation()==="horizontal"?"translate("+e.y+","+e.x+")":"translate("+e.x+","+e.y+")"}),l.select("circle").attr("r",4.5).style("fill",function(e){return s._palette(e.label)}).append("title").text(function(e){return e.label}),l.select("text").style("text-anchor",function(e){return e.children?"end":"start"}).attr("dx",function(e){return e.children?-s.textOffset():s.textOffset()}).attr("dy",3).text(function(e){return e.label}).each(function(t){if(!i){var n=e.select(this).node().getBBox();n.width>c&&(c=n.width)}}),c+=this.textOffset(),l.exit().remove(),!i&&this._maxTextWidth!==c&&(this._maxTextWidth=c,this.update(n,r,!0))},r});