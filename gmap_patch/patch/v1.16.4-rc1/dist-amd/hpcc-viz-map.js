// (c) 2008 David Troy

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define("topojson",["exports"],e):e(t.topojson=t.topojson||{})}(this,function(t){"use strict";function e(){}function o(t){if(!t)return e;var o,r,n=t.scale[0],i=t.scale[1],a=t.translate[0],s=t.translate[1];return function(t,e){e||(o=r=0),t[0]=(o+=t[0])*n+a,t[1]=(r+=t[1])*i+s}}function r(t){if(!t)return e;var o,r,n=t.scale[0],i=t.scale[1],a=t.translate[0],s=t.translate[1];return function(t,e){e||(o=r=0);var p=Math.round((t[0]-a)/n),l=Math.round((t[1]-s)/i);t[0]=p-o,t[1]=l-r,o=p,r=l}}function n(t,e){for(var o,r=t.length,n=r-e;n<--r;)o=t[n],t[n++]=t[r],t[r]=o}function i(t,e){for(var o=0,r=t.length;r>o;){var n=o+r>>>1;t[n]<e?o=n+1:r=n}return o}function a(t,e){return"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map(function(e){return s(t,e)})}:s(t,e)}function s(t,e){var o={type:"Feature",id:e.id,properties:e.properties||{},geometry:p(t,e)};return null==e.id&&delete o.id,o}function p(t,e){function r(t,e){e.length&&e.pop();for(var o,r=h[0>t?~t:t],i=0,a=r.length;a>i;++i)e.push(o=r[i].slice()),c(o,i);0>t&&n(e,a)}function i(t){return t=t.slice(),c(t,0),t}function a(t){for(var e=[],o=0,n=t.length;n>o;++o)r(t[o],e);return e.length<2&&e.push(e[0].slice()),e}function s(t){for(var e=a(t);e.length<4;)e.push(e[0].slice());return e}function p(t){return t.map(s)}function l(t){var e=t.type;return"GeometryCollection"===e?{type:e,geometries:t.geometries.map(l)}:e in u?{type:e,coordinates:u[e](t)}:null}var c=o(t.transform),h=t.arcs,u={Point:function(t){return i(t.coordinates)},MultiPoint:function(t){return t.coordinates.map(i)},LineString:function(t){return a(t.arcs)},MultiLineString:function(t){return t.arcs.map(a)},Polygon:function(t){return p(t.arcs)},MultiPolygon:function(t){return t.arcs.map(p)}};return l(e)}function l(t,e){function o(e){var o,r=t.arcs[0>e?~e:e],n=r[0];return t.transform?(o=[0,0],r.forEach(function(t){o[0]+=t[0],o[1]+=t[1]})):o=r[r.length-1],0>e?[o,n]:[n,o]}function r(t,e){for(var o in t){var r=t[o];delete e[r.start],delete r.start,delete r.end,r.forEach(function(t){n[0>t?~t:t]=1}),s.push(r)}}var n={},i={},a={},s=[],p=-1;return e.forEach(function(o,r){var n,i=t.arcs[0>o?~o:o];i.length<3&&!i[1][0]&&!i[1][1]&&(n=e[++p],e[p]=o,e[r]=n)}),e.forEach(function(t){var e,r,n=o(t),s=n[0],p=n[1];if(e=a[s])if(delete a[e.end],e.push(t),e.end=p,r=i[p]){delete i[r.start];var l=r===e?e:e.concat(r);i[l.start=e.start]=a[l.end=r.end]=l}else i[e.start]=a[e.end]=e;else if(e=i[p])if(delete i[e.start],e.unshift(t),e.start=s,r=a[s]){delete a[r.end];var c=r===e?e:r.concat(e);i[c.start=r.start]=a[c.end=e.end]=c}else i[e.start]=a[e.end]=e;else e=[t],i[e.start=s]=a[e.end=p]=e}),r(a,i),r(i,a),e.forEach(function(t){n[0>t?~t:t]||s.push([t])}),s}function c(t){return p(t,h.apply(this,arguments))}function h(t,e,o){function r(t){var e=0>t?~t:t;(c[e]||(c[e]=[])).push({i:t,g:p})}function n(t){t.forEach(r)}function i(t){t.forEach(n)}function a(t){"GeometryCollection"===t.type?t.geometries.forEach(a):t.type in h&&(p=t,h[t.type](t.arcs))}var s=[];if(arguments.length>1){var p,c=[],h={LineString:n,MultiLineString:i,Polygon:i,MultiPolygon:function(t){t.forEach(i)}};a(e),c.forEach(arguments.length<3?function(t){s.push(t[0].i)}:function(t){o(t[0].g,t[t.length-1].g)&&s.push(t[0].i)})}else for(var u=0,d=t.arcs.length;d>u;++u)s.push(u);return{type:"MultiLineString",arcs:l(t,s)}}function u(t){var e=t[0],o=t[1],r=t[2];return Math.abs((e[0]-r[0])*(o[1]-e[1])-(e[0]-o[0])*(r[1]-e[1]))}function d(t){for(var e,o=-1,r=t.length,n=t[r-1],i=0;++o<r;)e=n,n=t[o],i+=e[0]*n[1]-e[1]*n[0];return i/2}function y(t){return p(t,f.apply(this,arguments))}function f(t,e){function o(t){t.forEach(function(e){e.forEach(function(e){(n[e=0>e?~e:e]||(n[e]=[])).push(t)})}),i.push(t)}function r(e){return Math.abs(d(p(t,{type:"Polygon",arcs:[e]}).coordinates[0]))}var n={},i=[],a=[];return e.forEach(function(t){"Polygon"===t.type?o(t.arcs):"MultiPolygon"===t.type&&t.arcs.forEach(o)}),i.forEach(function(t){if(!t._){var e=[],o=[t];for(t._=1,a.push(e);t=o.pop();)e.push(t),t.forEach(function(t){t.forEach(function(t){n[0>t?~t:t].forEach(function(t){t._||(t._=1,o.push(t))})})})}}),i.forEach(function(t){delete t._}),{type:"MultiPolygon",arcs:a.map(function(e){var o,i=[];if(e.forEach(function(t){t.forEach(function(t){t.forEach(function(t){n[0>t?~t:t].length<2&&i.push(t)})})}),i=l(t,i),(o=i.length)>1)for(var a,s,p=1,c=r(i[0]);o>p;++p)(a=r(i[p]))>c&&(s=i[0],i[0]=i[p],i[p]=s,c=a);return i})}}function g(t){function e(t,e){t.forEach(function(t){0>t&&(t=~t);var o=n[t];o?o.push(e):n[t]=[e]})}function o(t,o){t.forEach(function(t){e(t,o)})}function r(t,e){"GeometryCollection"===t.type?t.geometries.forEach(function(t){r(t,e)}):t.type in s&&s[t.type](t.arcs,e)}var n={},a=t.map(function(){return[]}),s={LineString:e,MultiLineString:o,Polygon:o,MultiPolygon:function(t,e){t.forEach(function(t){o(t,e)})}};t.forEach(r);for(var p in n)for(var l=n[p],c=l.length,h=0;c>h;++h)for(var u=h+1;c>u;++u){var d,y=l[h],f=l[u];(d=a[y])[p=i(d,f)]!==f&&d.splice(p,0,f),(d=a[f])[p=i(d,y)]!==y&&d.splice(p,0,y)}return a}function m(t,e){return t[1][2]-e[1][2]}function _(){function t(t,e){for(;e>0;){var o=(e+1>>1)-1,n=r[o];if(m(t,n)>=0)break;r[n._=e]=n,r[t._=e=o]=t}}function e(t,e){for(;;){var o=e+1<<1,i=o-1,a=e,s=r[a];if(n>i&&m(r[i],s)<0&&(s=r[a=i]),n>o&&m(r[o],s)<0&&(s=r[a=o]),a===e)break;r[s._=e]=s,r[t._=e=a]=t}}var o={},r=[],n=0;return o.push=function(e){return t(r[e._=n]=e,n++),n},o.pop=function(){if(!(0>=n)){var t,o=r[0];return--n>0&&(t=r[n],e(r[t._=0]=t,0)),o}},o.remove=function(o){var i,a=o._;if(r[a]===o)return a!==--n&&(i=r[n],(m(i,o)<0?t:e)(r[i._=a]=i,a)),a},o}function v(t,e){function n(t){s.remove(t),t[1][2]=e(t),s.push(t)}var i=o(t.transform),a=r(t.transform),s=_();return e||(e=u),t.arcs.forEach(function(t){var o,r,p,l,c=[],h=0;for(r=0,p=t.length;p>r;++r)l=t[r],i(t[r]=[l[0],l[1],1/0],r);for(r=1,p=t.length-1;p>r;++r)o=t.slice(r-1,r+2),o[1][2]=e(o),c.push(o),s.push(o);for(r=0,p=c.length;p>r;++r)o=c[r],o.previous=c[r-1],o.next=c[r+1];for(;o=s.pop();){var u=o.previous,d=o.next;o[1][2]<h?o[1][2]=h:h=o[1][2],u&&(u.next=d,u[2]=o[2],n(u)),d&&(d.previous=u,d[0]=o[0],n(d))}t.forEach(a)}),t}var b="1.6.27";t.version=b,t.mesh=c,t.meshArcs=h,t.merge=y,t.mergeArcs=f,t.feature=a,t.neighbors=g,t.presimplify=v,Object.defineProperty(t,"__esModule",{value:!0})}),function(t,e){"function"==typeof define&&define.amd?define("src/map/Utility",["d3"],e):t.map_Utility=e(t.d3)}(this,function(t){function e(){}e.prototype.constructor=e,e.prototype._class+=" map_Geohash",e.prototype.base32="0123456789bcdefghjkmnpqrstuvwxyz",e.prototype.encode=function(t,e,o){if("undefined"==typeof o){for(var r=1;12>=r;r++){var n=this.encode(t,e,r),i=this.decode(n);if(i.lat===t&&i.lon===e)return n}o=12}if(t=Number(t),e=Number(e),o=Number(o),isNaN(t)||isNaN(e)||isNaN(o))throw new Error("Invalid geohash");for(var a=0,s=0,p=!0,l="",c=-90,h=90,u=-180,d=180;l.length<o;){if(p){var y=(u+d)/2;e>y?(a=2*a+1,u=y):(a=2*a,d=y)}else{var f=(c+h)/2;t>f?(a=2*a+1,c=f):(a=2*a,h=f)}p=!p,5===++s&&(l+=this.base32.charAt(a),s=0,a=0)}return l},e.prototype.decode=function(t){var e=this.bounds(t),o=e.sw.lat,r=e.sw.lon,n=e.ne.lat,i=e.ne.lon,a=(o+n)/2,s=(r+i)/2;return a=a.toFixed(Math.floor(2-Math.log(n-o)/Math.LN10)),s=s.toFixed(Math.floor(2-Math.log(i-r)/Math.LN10)),{lat:Number(a),lon:Number(s)}},e.prototype.bounds=function(t){if(0===t.length)throw new Error("Invalid geohash");t=t.toLowerCase();for(var e=!0,o=-90,r=90,n=-180,i=180,a=0;a<t.length;a++){var s=t.charAt(a),p=this.base32.indexOf(s);if(-1===p)throw new Error("Invalid geohash");for(var l=4;l>=0;l--){var c=p>>l&1;if(e){var h=(n+i)/2;1===c?n=h:i=h}else{var u=(o+r)/2;1===c?o=u:r=u}e=!e}}var d={sw:{lat:o,lon:n},ne:{lat:r,lon:i}};return d},e.prototype.adjacent=function(t,e){if(t=t.toLowerCase(),e=e.toLowerCase(),0===t.length)throw new Error("Invalid geohash");if(-1==="nsew".indexOf(e))throw new Error("Invalid direction");var o={n:["p0r21436x8zb9dcf5h7kjnmqesgutwvy","bc01fg45238967deuvhjyznpkmstqrwx"],s:["14365h7k9dcfesgujnmqp0r2twvyx8zb","238967debc01fg45kmstqrwxuvhjyznp"],e:["bc01fg45238967deuvhjyznpkmstqrwx","p0r21436x8zb9dcf5h7kjnmqesgutwvy"],w:["238967debc01fg45kmstqrwxuvhjyznp","14365h7k9dcfesgujnmqp0r2twvyx8zb"]},r={n:["prxz","bcfguvyz"],s:["028b","0145hjnp"],e:["bcfguvyz","prxz"],w:["0145hjnp","028b"]},n=t.slice(-1),i=t.slice(0,-1),a=t.length%2;return-1!==r[e][a].indexOf(n)&&""!==i&&(i=this.adjacent(i,e)),i+this.base32.charAt(o[e][a].indexOf(n))},e.prototype.neighbours=function(t){return{n:this.adjacent(t,"n"),ne:this.adjacent(this.adjacent(t,"n"),"e"),e:this.adjacent(t,"e"),se:this.adjacent(this.adjacent(t,"s"),"e"),s:this.adjacent(t,"s"),sw:this.adjacent(this.adjacent(t,"s"),"w"),w:this.adjacent(t,"w"),nw:this.adjacent(this.adjacent(t,"n"),"w")}},e.prototype.contained=function(t,e,o,r,n){(isNaN(e)||e>=90)&&(e=89),(isNaN(o)||o>180)&&(o=180),(isNaN(r)||-90>=r)&&(r=-89),(isNaN(t)||-180>t)&&(t=-180),n=n||1;for(var i=this.encode(e,t,n),a=this.encode(e,o,n),s=this.encode(r,o,n),p=i,l=0,c=-1,h=[i,s],u=this.adjacent(i,"e");u!==s;)h.push(u),++l,u===a||c===l?(c=l+1,l=0,u=this.adjacent(p,"s"),p=u):u=this.adjacent(u,"e");return h},e.prototype.calculateWidthDegrees=function(t){var e;e=t%2===0?-1:-.5;var o=180/Math.pow(2,2.5*t+e);return o},e.prototype.width=function(t){var e=t%2;return 180/(2^(5*t+e)/2-1)};var o=function(){function e(){var e=Math.max(Math.log(r)/Math.LN2-8,0),a=Math.round(e+i),s=Math.pow(2,e-a+8),p=[(n[0]-r/2)/s,(n[1]-r/2)/s],l=[],c=t.range(Math.max(0,Math.floor(-p[0])),Math.max(0,Math.ceil(o[0]/s-p[0]))),h=t.range(Math.max(0,Math.floor(-p[1])),Math.max(0,Math.ceil(o[1]/s-p[1])));return h.forEach(function(t){c.forEach(function(e){l.push([e,t,a])})}),l.translate=p,l.scale=s,l}var o=[960,500],r=256,n=[o[0]/2,o[1]/2],i=0;return e.size=function(t){return arguments.length?(o=t,e):o},e.scale=function(t){return arguments.length?(r=t,e):r},e.translate=function(t){return arguments.length?(n=t,e):n},e.zoomDelta=function(t){return arguments.length?(i=+t,e):i},e},r=function(){function e(t){var e=t[0],s=t[1];return o=null,r(e,s),o||(n(e,s),o)||(i(e,s),o)||(a(e,s),o),o}var o,r,n,i,a,s=1e-6,p=t.geo.albers(),l=t.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),c=t.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),h=t.geo.conicEqualArea().rotate([66,0]).center([0,18]).parallels([8,18]),u={point:function(t,e){o=[t,e]}};return e.invert=function(t){var e=p.scale(),o=p.translate(),r=(t[0]-o[0])/e,n=(t[1]-o[1])/e;return(n>=.12&&.234>n&&r>=-.425&&-.214>r?l:n>=.166&&.234>n&&r>=-.214&&-.115>r?c:n>=.204&&.234>n&&r>=.32&&.38>r?h:p).invert(t)},e.stream=function(t){var e=p.stream(t),o=l.stream(t),r=c.stream(t),n=h.stream(t);return{point:function(t,i){e.point(t,i),o.point(t,i),r.point(t,i),n.point(t,i)},sphere:function(){e.sphere(),o.sphere(),r.sphere(),n.sphere()},lineStart:function(){e.lineStart(),o.lineStart(),r.lineStart(),n.lineStart()},lineEnd:function(){e.lineEnd(),o.lineEnd(),r.lineEnd(),n.lineEnd()},polygonStart:function(){e.polygonStart(),o.polygonStart(),r.polygonStart(),n.polygonStart()},polygonEnd:function(){e.polygonEnd(),o.polygonEnd(),r.polygonEnd(),n.polygonEnd()}}},e.precision=function(t){return arguments.length?(p.precision(t),l.precision(t),c.precision(t),h.precision(t),e):p.precision()},e.scale=function(t){return arguments.length?(p.scale(t),l.scale(.35*t),c.scale(t),h.scale(t),e.translate(p.translate())):p.scale()},e.translate=function(t){if(!arguments.length)return p.translate();var o=p.scale(),d=+t[0],y=+t[1];return r=p.translate(t).clipExtent([[d-.455*o,y-.238*o],[d+.455*o,y+.238*o]]).stream(u).point,n=l.translate([d-.307*o,y+.201*o]).clipExtent([[d-.425*o+s,y+.12*o+s],[d-.214*o-s,y+.234*o-s]]).stream(u).point,i=c.translate([d-.205*o,y+.212*o]).clipExtent([[d-.214*o+s,y+.166*o+s],[d-.115*o-s,y+.234*o-s]]).stream(u).point,a=h.translate([d+.35*o,y+.224*o]).clipExtent([[d+.32*o,y+.204*o],[d+.38*o,y+.234*o]]).stream(u).point,e},e.scale(1070)};return t.geo.albersUsaPr||(t.geo.albersUsaPr=r),{Geohash:e,Tile:o,albersUsaPr:r}}),define("css!src/map/Layered",[],function(){}),function(t,e){"function"==typeof define&&define.amd?define("src/map/Layered",["d3","topojson","../common/SVGWidget","./Utility","css!./Layered"],e):t.map_Layered=e(t.d3,t.topojson,t.common_SVGWidget,t.map_Utility)}(this,function(t,e,o,r){function n(){o.call(this),this._drawStartPos="origin",this.projection("mercator");var e=this;this._zoom=t.behavior.zoom().scaleExtent([.25*i,131072*i]).on("zoomstart",function(t){e._zoomstart_translate=e._zoom.translate(),e._zoomstart_scale=e._zoom.scale()}).on("zoom",function(){if(t.event&&t.event.sourceEvent&&t.event.sourceEvent.ctrlKey&&"mousemove"===t.event.sourceEvent.type)return void e.render();e.zoomed();var o=e.width()/2,r=e.height()/2,n=e.invert(o,r);e.centerLong(n[0]),e.centerLat(n[1]),e.zoom(e._zoom.scale()/i),e._prevCenterLong=e.centerLong(),e._prevCenterLat=e.centerLat(),e._prevZoom=e.zoom()}).on("zoomend",function(){})}var i=.25,a=2048/Math.PI;return n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype._class+=" map_Layered",n.prototype.publish("projection",null,"set","Map projection type",["albersUsa","albersUsaPr","azimuthalEqualArea","azimuthalEquidistant","conicEqualArea","conicConformal","conicEquidistant","equirectangular","gnomonic","mercator","orthographic","stereographic","transverseMercator"]),n.prototype.publish("centerLat",0,"number","Center Latitude",null,{tags:["Basic"]}),n.prototype.publish("centerLong",0,"number","Center Longtitude",null,{tags:["Basic"]}),n.prototype.publish("zoom",1,"number","Zoom Level",null,{tags:["Basic"]}),n.prototype.publish("autoScaleMode","all","set","Auto Scale",["none","all"],{tags:["Basic"]}),n.prototype.publish("layers",[],"widgetArray","Layers",null,{render:!1}),n.prototype.data=function(t){var e=o.prototype.data.apply(this,arguments);return arguments.length&&(this._autoScaleOnNextRender=!0),e},n.prototype.projection_orig=n.prototype.projection,n.prototype.projection=function(e){var o=n.prototype.projection_orig.apply(this,arguments);if(arguments.length){switch(this._d3GeoProjection=t.geo[e]().scale(a).translate([0,0]),e){case"orthographic":this._d3GeoProjection.clipAngle(90).rotate([0,0])}this._d3GeoPath=t.geo.path().projection(this._d3GeoProjection),this._autoScaleOnNextRender=!0}return o},n.prototype.size=function(t){var e=o.prototype.size.apply(this,arguments);return arguments.length&&(delete this._prevCenterLat,delete this._prevCenterLong),e},n.prototype.enter=function(t,e){o.prototype.enter.apply(this,arguments),this._zoomGrab=e.append("rect").attr("class","background"),this._layersTarget=e.append("g").attr("class","layersTarget"),e.call(this._zoom)},n.prototype.update=function(e,r){if(o.prototype.update.apply(this,arguments),this._prevCenterLat!==this.centerLat()||this._prevCenterLong!==this.centerLong()||this._prevZoom!==this.zoom()){var n=t.geo[this.projection()]().scale(this.zoom()*i*a).translate([this.width()/2,this.height()/2]),s=n([this.centerLong(),this.centerLat()])||[this.width()/2,this.height()/2];this._zoom.scale(this.zoom()*i).translate([this.width()-s[0],this.height()-s[1]]),this._prevCenterLat=this.centerLat(),this._prevCenterLong=this.centerLong(),this._prevZoom=this.zoom()}this._zoomGrab.attr("width",this.width()).attr("height",this.height());var p=this._layersTarget.selectAll(".layerContainer").data(this.layers().filter(function(t){return t.visible()}),function(t){return t.id()}),l=this;p.enter().append("g").attr("id",function(t){return t.id()}).attr("class","layerContainer").each(function(e){e._svgElement=t.select(this),e._domElement=l._parentOverlay.append("div"),e.layerEnter(l,e._svgElement,e._domElement)}),p.each(function(t){t.layerUpdate(l)}),p.exit().each(function(t){t.layerExit(l),t._domElement.remove()}).remove(),p.order(),this.zoomed()},n.prototype.exit=function(t,e){o.prototype.exit.apply(this,arguments)},n.prototype.zoomed=function(){var t=this._layersTarget.selectAll(".layerContainer"),e=this;t.each(function(t){t.layerZoomed(e)})},n.prototype.preRender=function(t){return Promise.all(this.layers().filter(function(t){return t.visible()}).map(function(t){return t.layerPreRender()}))},n.prototype.render=function(t){var e=this;return this.preRender().then(function(){o.prototype.render.call(e,function(o){e._layersTarget&&(e._renderCount&&e._autoScaleOnNextRender||e._prevAutoScaleMode!==e.autoScaleMode())?(e._prevAutoScaleMode=e.autoScaleMode(),e._autoScaleOnNextRender=!1,setTimeout(function(){e.autoScale(),e.autoScale(),t&&t(o)},0)):t&&t(o)})}),this},n.prototype.project=function(t,e){t>=90?t=89:-90>=t&&(t=-89);var o=this._d3GeoProjection([e,t]);return o&&(o[0]*=this._zoom.scale(),o[1]*=this._zoom.scale(),o[0]+=this._zoom.translate()[0],o[1]+=this._zoom.translate()[1]),o},n.prototype.invert=function(t,e){return t-=this._zoom.translate()[0],e-=this._zoom.translate()[1],t/=this._zoom.scale(),e/=this._zoom.scale(),this._d3GeoProjection.invert([t,e])},n.prototype.getBounds=function(){var t=this._layersTarget.node().getBBox();return{x:t.x,y:t.y,width:t.width,height:t.height}},n.prototype.autoScale=function(){switch(this.autoScaleMode()){case"none":return;case"all":this.shrinkToFit(this.getBounds())}},n.prototype.shrinkToFit=function(t){if(t.width&&t.height){var e=this.width(),o=this.height(),r=this._zoom.translate(),n=this._zoom.scale();t.x+=t.width/2,t.y+=t.height/2,r[0]-=t.x-e/2,r[1]-=t.y-o/2;var i=n*Math.min(e/t.width,o/t.height);this._zoom.translate(r).scale(i).event(this._layersTarget)}else console.log("Layered.prototype.shrinkToFit - invalid rect:  "+t)},n}),function(t,e){"function"==typeof define&&define.amd?define("src/map/Layer",["./Layered","../api/ITooltip"],e):t.map_Layer=e(t.map_Layered,t.api_ITooltip)}(this,function(t,e){function o(o){t.call(this),e.call(this)}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype._class+=" map_Layer",o.prototype["implements"](e.prototype),o.prototype.layerEnter=function(t,e,o){this._parentOverlay=t._parentOverlay},o.prototype.enter=function(e,o){t.prototype.enter.apply(this,arguments),this._svgElement=this._layersTarget.append("g"),this._domElement=this._parentOverlay.append("div"),this.layerEnter(this,this._svgElement,this._domElement)},o.prototype.layerUpdate=function(t){},o.prototype.update=function(e,o){t.prototype.update.apply(this,arguments),this.layerUpdate(this)},o.prototype.layerExit=function(t){},o.prototype.exit=function(e,o){this.layerExit(this),this._svgElement.remove(),this._domElement.remove(),t.prototype.exit.apply(this,arguments)},o.prototype.layerPreRender=function(t){return Promise.resolve()},o.prototype.render=function(e){var o=this,r=arguments;return this.layerPreRender().then(function(){t.prototype.render.apply(o,r)}),this},o.prototype.layerZoomed=function(t){},o.prototype.zoomed=function(){t.prototype.zoomed.apply(this,arguments),this.layerZoomed(this)},o}),define("css!src/map/Choropleth",[],function(){}),function(t,e){"function"==typeof define&&define.amd?define("src/map/Choropleth",["d3","topojson","./Layer","../common/Palette","../common/Utility","css!./Choropleth"],e):t.map_Choropleth=e(t.d3,t.topojson,t.map_Layer,t.common_Palette,t.common_Utility)}(this,function(t,e,o,r,n){function i(){o.call(this),n.SimpleSelectionMixin.call(this),this._dataMap={},this._path=t.select(null)}return i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype._class+=" map_Choropleth",i.prototype.mixin(n.SimpleSelectionMixin),i.prototype._palette=r.rainbow("default"),i.prototype.publish("paletteID","YlOrRd","set","Palette ID",i.prototype._palette["switch"](),{tags:["Basic","Shared"]}),i.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),i.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),i.prototype.publish("meshVisible",!0,"boolean","Mesh Visibility"),i.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),i.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),i.prototype.publish("internalOnly",!1,"boolean","Internal mesh only"),i.prototype.publish("autoScaleMode","mesh","set","Auto Scale",["none","mesh","data"],{tags:["Basic"],override:!0}),i.prototype.data=function(t){var e=o.prototype.data.apply(this,arguments);if(arguments.length){this._dataMap={},this._dataMinWeight=null,this._dataMaxWeight=null;var r=this;this.data().forEach(function(t){r._dataMap[t[0]]=t,(!r._dataMinWeight||t[1]<r._dataMinWeight)&&(r._dataMinWeight=t[1]),(!r._dataMaxWeight||t[1]>r._dataMaxWeight)&&(r._dataMaxWeight=t[1])})}return e},i.prototype.getDataBounds=function(){var t=this._choroplethData.node().getBBox(),e={x:t.x,y:t.y,width:t.width,height:t.height},o=this._zoom.scale();e.x*=o,e.y*=o,e.width*=o,e.height*=o;var r=this._zoom.translate();return e.x+=r[0],e.y+=r[1],e},i.prototype.autoScale=function(){switch(this.autoScaleMode()){case"none":return;case"mesh":this.shrinkToFit(this.getBounds());break;case"data":this.shrinkToFit(this.getDataBounds())}},i.prototype.layerEnter=function(t,e,r){o.prototype.layerEnter.apply(this,arguments),this._choroplethTransform=e,this._choroplethData=this._choroplethTransform.append("g"),this._choropleth=this._choroplethTransform.append("path").attr("class","mesh")},i.prototype.layerUpdate=function(t,r){return o.prototype.layerUpdate.apply(this,arguments),this._palette=this._palette["switch"](this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id())),this.visible()&&this.meshVisible()?((r||this._prevProjection!==t.projection()||this._prevInternalOnly!==this.internalOnly())&&(this._choropleth.attr("d",t._d3GeoPath(e.mesh(this._choroTopology,this._choroTopologyObjects,this.internalOnly()?function(t,e){return t!==e}:function(t,e){return!0}))),this._prevProjection=t.projection(),this._prevInternalOnly=this.internalOnly()),void this._choroplethTransform.style("opacity",this.opacity()).style("stroke",this.meshColor())):(this._choropleth.attr("d",""),void delete this._prevProjection)},i.prototype.layerExit=function(t){delete this._prevProjection,delete this._prevInternalOnly},i.prototype.layerZoomed=function(t){o.prototype.layerZoomed.apply(this,arguments),this._choroplethTransform.attr("transform","translate("+t._zoom.translate()+")scale("+t._zoom.scale()+")").style("stroke-width",this.meshStrokeWidth()/t._zoom.scale()+"px")},i.prototype.click=function(t,e,o){console.log("Click:  "+JSON.stringify(t)+", "+e+", "+o)},i.prototype.dblclick=function(t,e,o){console.log("Double click:  "+JSON.stringify(t)+", "+e+", "+o)},i}),function(t,e){"function"==typeof define&&define.amd?define("src/map/ChoroplethCountries",["d3","topojson","./Choropleth","require"],e):t.map_ChoroplethCountries=e(t.d3,t.topojson,t.map_Choropleth,t.require)}(this,function(t,e,o,r){function n(){o.call(this)}var i=null,a=null,s=null;return n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype._class+=" map_ChoroplethCountries",n.prototype.layerEnter=function(e,r,n){o.prototype.layerEnter.apply(this,arguments),this._choroTopology=i.topology,this._choroTopologyObjectsCountries=i.topology.objects.countries,this._choroTopologyObjectsLand=i.topology.objects.land,this._choroTopologyObjects=this._choroTopologyObjectsCountries,this._selection.widgetElement(this._choroplethData),this.choroPaths=t.select(null);var a=this;this.tooltipHTML(function(t){return a.tooltipFormat({label:t[0],value:t[1]})})},n.prototype.layerUpdate=function(t){o.prototype.layerUpdate.apply(this,arguments),this.choroPaths=this._choroplethData.selectAll(".data").data(this.visible()?this.data():[],function(t){return t[0]});var e=this;this.choroPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(t){e._dataMap[t[0]]&&e.click(e.rowToObj(e._dataMap[t[0]]),"weight",e._selection.selected(this))}).on("dblclick",function(t){e._dataMap[t[0]]&&e.dblclick(e.rowToObj(e._dataMap[t[0]]),"weight",e._selection.selected(this))}).on("mouseout.tooltip",this.tooltip.hide).on("mousemove.tooltip",this.tooltip.show),this.choroPaths.attr("d",function(e){var o=t._d3GeoPath(s[e[0]]);return o||console.log("Unknown Country:  "+e),o}).style("fill",function(t){var o=e._palette(t[1],e._dataMinWeight,e._dataMaxWeight);return o}),this.choroPaths.exit().remove()},n.prototype.layerPreRender=function(){return this._topoJsonPromise||(this._topoJsonPromise=new Promise(function(t,o){i&&t(),r(["json!src/map/TopoJSON/countries.json"],function(o){i=o,a=e.feature(i.topology,i.topology.objects.countries).features,s={};for(var r in a)a[r].id&&i.countryNames[a[r].id]&&(s[i.countryNames[a[r].id].name]=a[r]);t()})})),this._topoJsonPromise},n}),function(t,e){"function"==typeof define&&define.amd?define("src/map/ChoroplethContinents",["d3","topojson","./ChoroplethCountries"],e):t.map_ChoroplethContinents=e(t.d3,t.topojson,t.map_ChoroplethCountries)}(this,function(t,e,o){function r(){o.call(this)}return r.prototype=Object.create(o.prototype),r.prototype.constructor=r,r.prototype._class+=" map_ChoroplethContinents",r.prototype.layerEnter=function(t,e,r){o.prototype.layerEnter.apply(this,arguments),this._choroTopologyObjects=this._choroTopologyObjectsLand},r}),function(t,e){"function"==typeof define&&define.amd?define("src/map/ChoroplethCounties",["d3","topojson","./Choropleth","require"],e):t.map_ChoroplethCounties=e(t.d3,t.topojson,t.map_Choropleth,t.require)}(this,function(t,e,o,r){function n(){o.call(this),this.projection("albersUsaPr")}var i=null,a=null,s=null,p=t.format("05d");return n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype._class+=" map_ChoroplethCounties",n.prototype.publish("onClickFormatFIPS",!1,"boolean","format FIPS code as a String on Click"),n.prototype.layerEnter=function(e,r,n){o.prototype.layerEnter.apply(this,arguments),this._choroTopology=i.topology,this._choroTopologyObjects=i.topology.objects.counties,this._selection.widgetElement(this._choroplethData),this.choroPaths=t.select(null);var a=this;this.tooltipHTML(function(t){return a.tooltipFormat({label:i.countyNames[+t[0]],value:a._dataMap[t[0]]?a._dataMap[t[0]][1]:"N/A"})})},n.prototype.layerUpdate=function(t){function e(t){return r.onClickFormatFIPS()?r._dataMap[t[0]].map(function(t,e){return r.onClickFormatFIPS()&&0===e?p(t):t}):r._dataMap[t[0]]}o.prototype.layerUpdate.apply(this,arguments),this.choroPaths=this._choroplethData.selectAll(".data").data(this.visible()?this.data():[],function(t){return t[0]});var r=this;this.choroPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(t){r._dataMap[t[0]]&&r.click(r.rowToObj(e(t)),"weight",r._selection.selected(this))}).on("dblclick",function(t){r._dataMap[t[0]]&&r.dblclick(r.rowToObj(e(t)),"weight",r._selection.selected(this))}).on("mouseout.tooltip",this.tooltip.hide).on("mousemove.tooltip",this.tooltip.show),this.choroPaths.attr("d",function(e){var o=t._d3GeoPath(s[+e[0]]);return o||console.log("Unknown US County:  "+e[0]),o}).style("fill",function(t){var e=r._palette(t[1],r._dataMinWeight,r._dataMaxWeight);return e}),this.choroPaths.exit().remove()},n.prototype.layerPreRender=function(){return this._topoJsonPromise||(this._topoJsonPromise=new Promise(function(t,o){i&&t(),r(["json!src/map/TopoJSON/us-counties.json"],function(o){i=o,a=e.feature(i.topology,i.topology.objects.counties).features,s={};for(var r in a)a[r].id&&(s[a[r].id]=a[r]);t()})})),this._topoJsonPromise},n}),function(t,e){"function"==typeof define&&define.amd?define("src/map/ChoroplethStates",["d3","topojson","./Choropleth","require"],e):t.map_ChoroplethStates=e(t.d3,t.topojson,t.map_Choropleth,t.require)}(this,function(t,e,o,r){function n(){o.call(this),this.projection("albersUsaPr")}var i=null,a=null,s=null;return n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype._class+=" map_ChoroplethStates",n.prototype.layerEnter=function(e,r,n){o.prototype.layerEnter.apply(this,arguments),this._choroTopology=i.topology,this._choroTopologyObjects=i.topology.objects.states,this._selection.widgetElement(this._choroplethData),this.choroPaths=t.select(null);var a=this;this.tooltipHTML(function(t){var e=s[t[0]].id;return a.tooltipFormat({label:i.stateNames[e].name,value:t[1]})})},n.prototype.layerUpdate=function(t){o.prototype.layerUpdate.apply(this,arguments),this.choroPaths=this._choroplethData.selectAll(".data").data(this.visible()?this.data():[],function(t){return t[0]});var e=this;this.choroPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(t){e.click(e.rowToObj(t),"weight",e._selection.selected(this))}).on("dblclick",function(t){e.dblclick(e.rowToObj(t),"weight",e._selection.selected(this))}).on("mouseout.tooltip",this.tooltip.hide).on("mousemove.tooltip",this.tooltip.show),this.choroPaths.attr("d",function(e){var o=t._d3GeoPath(s[e[0]]);return o||console.log("Unknown US State:  "+e),o}).style("fill",function(t){var o=e._palette(t[1],e._dataMinWeight,e._dataMaxWeight);return o}),this.choroPaths.exit().remove()},n.prototype.layerPreRender=function(){return this._topoJsonPromise||(this._topoJsonPromise=new Promise(function(t,o){i&&t(),r(["json!src/map/TopoJSON/us-states.json"],function(o){i=o,a=e.feature(i.topology,i.topology.objects.states).features,s={};for(var r in a)a[r].id&&(s[i.stateNames[a[r].id].code]=a[r]);t()})})),this._topoJsonPromise},n}),function(t,e){"function"==typeof define&&define.amd?define("src/map/ChoroplethStatesHeat",["../layout/Layered"],e):t.map_ChoroplethStatesHeat=e(t.layout_Layered)}(this,function(t){function e(e){t.call(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype._class+=" map_ChoroplethStatesHeat",e}),define("css!src/map/GeoHash",[],function(){}),function(t,e){"function"==typeof define&&define.amd?define("src/map/GeoHash",["d3","topojson","./Layer","./Utility","../common/Palette","../common/Utility","css!./GeoHash"],e):t.map_GeoHash=e(t.d3,t.topojson,t.map_Layer,t.map_Utility,t.common_Palette,t.common_Utility)}(this,function(t,e,o,r,n,i){function a(){o.call(this)}return a.prototype=Object.create(o.prototype),a.prototype.constructor=a,a.prototype._class+=" map_GeoHash",a.prototype._palette=n.rainbow("default"),a.prototype.publish("paletteID","YlOrRd","set","Palette ID",a.prototype._palette["switch"](),{tags:["Basic","Shared"]}),a.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),a.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),a.prototype.publish("meshVisible",!0,"boolean","Mesh Visibility"),a.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),a.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),a.prototype.data=function(t){var e=o.prototype.data.apply(this,arguments);return arguments.length&&(this._dataMinWeight=null,this._dataMaxWeight=null,this.data().forEach(function(t){(!this._dataMinWeight||t[1]<this._dataMinWeight)&&(this._dataMinWeight=t[1]),(!this._dataMaxWeight||t[1]>this._dataMaxWeight)&&(this._dataMaxWeight=t[1])},this)),e},a.prototype.layerEnter=function(e,n,a){o.prototype.layerEnter.apply(this,arguments),this.geohash=new r.Geohash,this._geoHashTransform=n.append("g"),this._selection=new i.SimpleSelection(this._geoHashTransform),this.geoHashPaths=t.select(null)},a.prototype.layerUpdate=function(t){o.prototype.layerUpdate.apply(this,arguments),this._palette=this._palette["switch"](this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id())),this._geoHashTransform.style("opacity",this.opacity()),this.geoHashPaths=this._geoHashTransform.selectAll(".data").data(this.visible()?this.data():[],function(t){
return t[0]});var e=this;this.geoHashPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(t){e.click(e.rowToObj(t),"weight",e._selection.selected(this))}).on("dblclick",function(t){e.dblclick(e.rowToObj(t),"weight",e._selection.selected(this))}),this.geoHashPaths.attr("d",function(o){var r=e.geohash.bounds(o[0]),n={type:"LineString",coordinates:[[r.sw.lon,r.ne.lat],[r.ne.lon,r.ne.lat],[r.ne.lon,r.sw.lat],[r.sw.lon,r.sw.lat]]};return t._d3GeoPath(n)}).style("fill",function(t){var o=e._palette(t[1],e._dataMinWeight,e._dataMaxWeight);return o}),this.geoHashPaths.exit().remove()},a.prototype.layerZoomed=function(t){o.prototype.layerZoomed.apply(this,arguments),this._geoHashTransform.attr("transform","translate("+t._zoom.translate()+")scale("+t._zoom.scale()+")").attr("stroke-width",1.5/t._zoom.scale()+"px")},a.prototype.click=function(t,e,o){console.log("Click:  "+JSON.stringify(t)+", "+e+", "+o)},a.prototype.dblclick=function(t,e,o){console.log("Double click:  "+JSON.stringify(t)+", "+e+", "+o)},a}),define("css!src/map/GMap",[],function(){}),function(t,e){"function"==typeof define&&define.amd?define("src/map/GMap",["d3","../common/HTMLWidget","../layout/AbsoluteSurface","css!./GMap"],e):t.map_GMap=e(t.d3,t.common_HTMLWidget,t.layout_AbsoluteSurface)}(this,function(t,e,o){function r(t,e,o){function r(t,e,o){google.maps.OverlayView.call(this),this._div=null,this._worldSurface=e,this._viewportSurface=o,this._map=t,this.setMap(t);var r=this;google.maps.event.addListener(t,"bounds_changed",function(){r.draw()}),google.maps.event.addListener(t,"projection_changed",function(){r.draw()}),this._prevWorldMin={x:0,y:0},this._prevWorldMax={x:0,y:0},this._prevMin={x:0,y:0},this._prevMax={x:0,y:0}}return r.prototype=google.maps.OverlayView.prototype,r.prototype.onAdd=function(){this.div=document.createElement("div"),this._viewportSurface.target(this.div).units("pixels");var t=this.getPanes();t.overlayMouseTarget.appendChild(this.div)},r.prototype.draw=function(){var t=this.getProjection();if(t){for(var e=this._map.getBounds(),o=t.fromLatLngToDivPixel(e.getCenter()),r=t.fromLatLngToDivPixel(e.getSouthWest()),n=t.fromLatLngToDivPixel(e.getNorthEast()),i={x:r.x,y:n.y},a={x:n.x,y:r.y},s=t.getWorldWidth();a.x<i.x+100;)a.x+=s;for(;i.x>o.x;)i.x-=s,a.x-=s;(i.x!==this._prevMin.x||i.y!==this._prevMin.y||a.x!==this._prevMax.x||a.y!==this._prevMax.y)&&(this._viewportSurface.widgetX(i.x).widgetY(i.y).widgetWidth(a.x-i.x).widgetHeight(a.y-i.y),this._viewportSurface._renderCount?(this._viewportSurface.render(),this._prevMin=i,this._prevMax=a):this._viewportSurface.lazyRender());for(var p=t.fromLatLngToDivPixel(new google.maps.LatLng(85,-179.9)),l=t.fromLatLngToDivPixel(new google.maps.LatLng(-85,179.9));l.x<p.x+100;)l.x+=s;for(;p.x>o.x;)p.x-=s,l.x-=s;(p.x!==this._prevWorldMin.x||p.y!==this._prevWorldMin.y||l.x!==this._prevWorldMax.x||l.y!==this._prevWorldMax.y)&&(this._worldSurface.widgetX(p.x).widgetY(p.y).widgetWidth(l.x-p.x).widgetHeight(l.y-p.y).render(),this._prevWorldMin=l,this._prevWorldMax=l)}},r.prototype.onRemove=function(){this._viewportSurface.target(null),this._div.parentNode.removeChild(this._div),this._div=null},new r(t,e,o)}function n(t){this._userShapes=[],this.mapContext=t}function i(){function t(t,e,o){var n=r._overlay.getProjection(),i=n.fromLatLngToDivPixel(new google.maps.LatLng(e,o)),a=n.getWorldWidth(),s=parseFloat(t.widgetX()),p=parseFloat(t.widgetY()),l=parseFloat(t.widgetWidth());for(i.x-=s,i.y-=p;i.x<0;)i.x+=a;for(;i.x>l;)i.x-=a;return i}e.call(this),this._tag="div";var r=this;this._userShapes=new n(this),this._worldSurface=new o,this._worldSurface.project=function(e,o){return t(this,e,o)},this._viewportSurface=new o,this._viewportSurface.project=function(e,o){return t(this,e,o)}}return n.prototype.add=function(t){var e=this._userShapes.indexOf(t);e>=0||this._userShapes.push(t)},n.prototype.remove=function(t){var e=this._userShapes.indexOf(t);e>=0&&this._userShapes.splice(e,1),t.setMap(null)},n.prototype.save=function(){return this._userShapes.map(function(t){return n.prototype._saveShape(t)})},n.prototype.load=function(t){this._deserializeShapes(t)},n.prototype._saveShape=function(t){var e={},o={circle:function(t){e.type="circle",e.pos={lat:t.center.lat(),lng:t.center.lng()},e.radius=t.radius},rectangle:function(t){e.type="rectangle",e.bounds={ne:t.bounds.getNorthEast(),sw:t.bounds.getSouthWest()}},polygon:function(t){e.type=t.__hpcc_type;var o=t.getPath();e.vertices=[];for(var r=0;r<o.length;r++)e.vertices.push(o.getAt(r))},polyline:function(t){o.polygon(t)}};return o[t.__hpcc_type](t),e.strokeWeight=t.strokeWeight,e.fillColor=t.fillColor,e.fillOpacity=t.fillOpacity,e.editable=t.editable,e.clickable=t.clickable||!0,e},n.prototype._deserializeShapes=function(t){for(var e=JSON.parse(t),o={strokeWeight:0,fillOpacity:.45,fillColor:"#1f77b4",editable:!0,clickable:!0},r={circle:function(t,e){var r=new google.maps.Circle({strokeWeight:t.strokeWeight||o.strokeWeight,fillColor:t.fillColor||o.fillColor,fillOpacity:t.fillOpacity||o.fillOpacity,editable:t.editable||o.editable,clickable:t.clickable||o.clickable,map:e,center:t.pos,radius:t.radius});return r},rectangle:function(t,e){var r=new google.maps.Rectangle({strokeWeight:t.strokeWeight||o.strokeWeight,fillColor:t.fillColor||o.fillColor,fillOpacity:t.fillOpacity||o.fillOpacity,editable:t.editable||o.editable,clickable:t.clickable||o.clickable,map:e,bounds:{north:t.bounds.ne.lat,west:t.bounds.sw.lng,south:t.bounds.sw.lat,east:t.bounds.ne.lng}});return r},polygon:function(t,e){var r=new google.maps.Polygon({strokeWeight:t.strokeWeight||o.strokeWeight,fillColor:t.fillColor||o.fillColor,fillOpacity:t.fillOpacity||o.fillOpacity,editable:t.editable||o.editable,clickable:t.clickable||o.clickable,map:e,paths:t.vertices});return r},polyline:function(t,e){var r=new google.maps.Polyline({strokeWeight:t.strokeWeight||o.strokeWeight,fillColor:t.fillColor||o.fillColor,fillOpacity:t.fillOpacity||o.fillOpacity,editable:t.editable||o.editable,clickable:t.clickable||o.clickable,map:e,path:t.vertices});return r}},n=0;n<e.length;n++){var i=r[e[n].type](e[n],this.mapContext._googleMap);this.mapContext.onDrawingComplete({type:e[n].type,overlay:i})}},i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype._class+=" map_GMap",i.prototype.publish("type","road","set","Map Type",["terrain","road","satellite","hybrid"],{tags:["Basic"]}),i.prototype.publish("centerLat",42.877742,"number","Center Latitude",null,{tags:["Basic"]}),i.prototype.publish("centerLong",-97.380979,"number","Center Longtitude",null,{tags:["Basic"]}),i.prototype.publish("centerAddress",null,"string","Address to center map on",null,{tags:["Basic"],optional:!0}),i.prototype.publish("zoom",4,"number","Zoom Level",null,{tags:["Basic"]}),i.prototype.publish("panControl",!0,"boolean","Pan Controls",null,{tags:["Basic"]}),i.prototype.publish("zoomControl",!0,"boolean","Zoom Controls",null,{tags:["Basic"]}),i.prototype.publish("scaleControl",!0,"boolean","Scale Controls",null,{tags:["Basic"]}),i.prototype.publish("mapTypeControl",!1,"boolean","Map Type Controls",null,{tags:["Basic"]}),i.prototype.publish("fullscreenControl",!1,"boolean","Fullscreen Controls",null,{tags:["Basic"]}),i.prototype.publish("streetViewControl",!1,"boolean","StreetView Controls",null,{tags:["Basic"]}),i.prototype.publish("overviewMapControl",!1,"boolean","OverviewMap Controls",null,{tags:["Basic"]}),i.prototype.publish("streetView",!1,"boolean","Streetview",null,{tags:["Basic"]}),i.prototype.publish("drawingTools",!1,"boolean","Drawing Tools",null,{tags:["Basic"]}),i.prototype.publish("drawingState","","string","Map Drawings",null,{disabel:function(t){return t.drawingTools()===!1}}),i.prototype.publish("googleMapStyles",{},"object","Styling for map colors etc",null,{tags:["Basic"]}),i.prototype.data=function(t){var o=e.prototype.data.apply(this,arguments);return o},i.prototype.getMapType=function(){switch(this.type()){case"terrain":return google.maps.MapTypeId.TERRAIN;case"road":return google.maps.MapTypeId.ROADMAP;case"satellite":return google.maps.MapTypeId.SATELLITE;case"hybrid":return google.maps.MapTypeId.HYBRID;default:return google.maps.MapTypeId.ROADMAP}},i.prototype.getMapOptions=function(){return{panControl:this.panControl(),zoomControl:this.zoomControl(),fullscreenControl:this.fullscreenControl(),mapTypeControl:this.mapTypeControl(),scaleControl:this.scaleControl(),streetViewControl:this.streetViewControl(),overviewMapControl:this.overviewMapControl(),overviewMapControlOptions:{opened:!0},styles:this.googleMapStyles()}},i.prototype.size=function(t){var o=e.prototype.size.apply(this,arguments);return arguments.length&&this._googleMapNode&&(this._googleMapNode.style({width:t.width+"px",height:t.height+"px"}),google.maps.event.trigger(this._googleMap,"resize")),o},i.prototype.enter=function(o,n){e.prototype.enter.apply(this,arguments);var i=this;this._googleGeocoder=new google.maps.Geocoder,this._googleMapNode=n.append("div").style({width:this.width()+"px",height:this.height()+"px"}),this._googleMap=new google.maps.Map(this._googleMapNode.node(),{zoom:this.zoom(),center:new google.maps.LatLng(this.centerLat(),this.centerLong()),mapTypeId:this.getMapType(),disableDefaultUI:!0}),this._overlay=r(this._googleMap,this._worldSurface,this._viewportSurface),this._googleMap.addListener("center_changed",function(){i.centerLat(i._googleMap.center.lat()),i._prevCenterLat=i.centerLat(),i.centerLong(i._googleMap.center.lng()),i._prevCenterLong=i.centerLong(),i._googleMapPanorama.setPosition({lat:i.centerLat(),lng:i.centerLong()}),i.zoom(i._googleMap.getZoom()),i._prevZoom=i.zoom()}),this._googleMap.addListener("zoom_changed",function(){i.zoom(i._googleMap.zoom),i._prevZoom=i.zoom()}),this._googleMapPanorama=this._googleMap.getStreetView(),this._googleMapPanorama.addListener("visible_changed",function(){i.streetView(i._googleMapPanorama.getVisible()),i._prevStreetView=i.streetView()}),this._circleMap=t.map([]),this._pinMap=t.map([]),this._prevCenterLat=this.centerLat(),this._prevCenterLong=this.centerLong(),this._prevZoom=this.zoom();var a={strokeWeight:0,fillOpacity:.45,fillColor:"#1f77b4",editable:!0,clickable:!0};this._drawingManager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.MARKER,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:["polygon","rectangle","circle"]},rectangleOptions:a,circleOptions:a,polygonOptions:a}),this.drawingState()&&this._userShapes.load(this.drawingState())},i.prototype.update=function(t,e){var o=this;this._googleMap.setMapTypeId(this.getMapType()),this._googleMap.setOptions(this.getMapOptions()),this.centerAddress_exists()&&this._prevCenterAddress!==this.centerAddress()&&(this._prevCenterAddress=this.centerAddress(),this._googleGeocoder.geocode({address:this.centerAddress()},function(t,e){e===google.maps.GeocoderStatus.OK?o._googleMap.fitBounds(t[0].geometry.bounds):console.error("Geocode was not successful for the following reason: "+e)})),(this._prevCenterLat!==this.centerLat()||this._prevCenterLong!==this.centerLong())&&(this._googleMap.setCenter(new google.maps.LatLng(this.centerLat(),this.centerLong())),this._prevCenterLat=this.centerLat(),this._prevCenterLong=this.centerLong()),this._prevZoom!==this.zoom()&&(this._googleMap.setZoom(this.zoom()),this._prevZoom=this.zoom()),this.updateCircles(),this.updatePins(),this._prevStreetView!==this.streetView()&&(this.streetView()?(this._googleMapPanorama.setPosition({lat:this.centerLat(),lng:this.centerLong()}),this._googleMapPanorama.setPov({heading:0,pitch:0}),this._googleMapPanorama.setVisible(!0)):this._googleMapPanorama.setVisible(!1),this._prevStreetView=this.streetView()),this.drawingTools()?(this._drawingManager.setMap(this._googleMap),google.maps.event.addListener(this._drawingManager,"overlaycomplete",function(){i.prototype.onDrawingComplete.apply(o,arguments)})):(this._drawingManager.setMap(null),google.maps.event.clearInstanceListeners(this._drawingManager))},i.prototype.requireGoogleMap=function(){return this._googleMapPromise||(this._googleMapPromise=new Promise(function(t,e){window.google&&window.google.maps&&t();var o="https:"===window.location.protocol?"https:":"http:",r=r||"AIzaSyDwGn2i1i_pMZvnqYJN1BksD_tjYaCOWKg";require(["async!"+o+"//maps.google.com/maps/api/js?key="+r+"&libraries=drawing,geometry"],function(){t()})})),this._googleMapPromise},i.prototype.render=function(t){var o=this,r=arguments;return this.requireGoogleMap().then(function(){e.prototype.render.apply(o,r)}),this},i.prototype.updateCircles=function(){function e(t){return t[0]+"_"+t[1]}var o=[],r=[],n=t.map(this._circleMap.keys(),function(t){return t});this.data().forEach(function(t){n.remove(e(t)),t[3]&&!this._circleMap.has(e(t))?o.push(t):t[3]&&this._circleMap.has(e(t))?r.push(t):!t[3]&&this._circleMap.has(e(t))&&n.set(e(t),!0)},this),o.forEach(function(t){var o=this.createCircle(t[0],t[1],t[3],"");this._circleMap.set(e(t),o)},this),r.forEach(function(t){},this);var i=this;n.forEach(function(t){i._circleMap.get(t).setMap(null),i._circleMap.remove(t)})},i.prototype.updatePins=function(){function e(t){return t[0]+"_"+t[1]}var o=[],r=[],n=t.map(this._pinMap.keys(),function(t){return t});this.data().forEach(function(t){n.remove(e(t)),t[2]&&!this._pinMap.has(e(t))?o.push(t):t[2]&&this._pinMap.has(e(t))?r.push(t):!t[2]&&this._pinMap.has(e(t))&&n.set(e(t),!0)},this),o.forEach(function(t){var o=this.createMarker(t[0],t[1],t[2],"");this._pinMap.set(e(t),o)},this),r.forEach(function(t){this._pinMap.get(e(t)).setIcon(this.createIcon(t[2]))},this);var i=this;n.forEach(function(t){i._pinMap.get(t).setMap(null),i._pinMap.remove(t)})},i.prototype.createIcon=function(t){return{path:"M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z M -2,-30",fillColor:t.fillColor,fillOpacity:t.fillOpacity||.8,scale:.5,strokeColor:t.strokeColor||"black",strokeWeight:.25}},i.prototype.createMarker=function(t,e,o){return new google.maps.Marker({position:new google.maps.LatLng(t,e),animation:google.maps.Animation.DROP,title:o.title||"",icon:this.createIcon(o),map:this._googleMap})},i.prototype.createCircle=function(t,e,o){return new google.maps.Circle({center:new google.maps.LatLng(t,e),radius:16093*o.radius/10,fillColor:o.fillColor||"red",strokeColor:o.strokeColor||o.fillColor||"black",strokeWeight:.5,map:this._googleMap})},i.prototype.zoomTo=function(t){var e=0,o=new google.maps.LatLngBounds;return t.forEach(function(t){var r=new google.maps.LatLng(t[0],t[1]);o.extend(r),++e}),e&&(this._googleMap.setCenter(o.getCenter()),this._googleMap.fitBounds(o),this._googleMap.getZoom()>12&&this._googleMap.setZoom(12)),this},i.prototype.zoomToFit=function(){return this.zoomTo(this.data())},i.prototype.drawingOptions=function(t){return arguments.length?(this._drawingManager.setOptions(t),this):this._drawingManager},i.prototype.userShapeSelection=function(t){return arguments.length?(this._userShapeSelection&&this._userShapeSelection.setEditable(!1),this._userShapeSelection=t,this._userShapeSelection&&this._userShapeSelection.setEditable(!0),this):this._userShapeSelection},i.prototype.deleteUserShape=function(t){this._userShapeSelection===t&&this.userShapeSelection(null),this._userShapes.remove(t)},i.prototype.onDrawingComplete=function(t){if(t.type!==google.maps.drawing.OverlayType.MARKER){this._drawingManager.setDrawingMode(null);var e=t.overlay;e.__hpcc_type=t.type,this._userShapes.add(e);var o=this,r=!1;window.addEventListener("keydown",function(t){("Control"===t.keyIdentifier||t.ctrlKey===!0)&&(r=!0)}),window.addEventListener("keyup",function(t){t.ctrlKey===!1&&(r=!1)}),google.maps.event.addListener(e,"click",function(t){return o.userShapeSelection(e),t&&r===!0&&(o.deleteUserShape(e),o.drawingState(JSON.stringify(o._userShapes.save()))),!1}),this.userShapeSelection(e),this.drawingState(JSON.stringify(this._userShapes.save()))}},i}),function(t,e){"function"==typeof define&&define.amd?define("src/map/GMapGraph",["./GMap","../graph/Graph","../graph/Edge","../common/Shape"],e):t.map_GMapGraph=e(t.map_GMap,t.graph_Graph,t.graph_Edge,t.common_Shape)}(this,function(t,e,o,r){function n(){t.call(this)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.prototype._class+=" map_GMapGraph",n.prototype.enter=function(){t.prototype.enter.apply(this,arguments);var n=(new e).layout("None"),i=n.render,a=this;n.render=function(){var t=[],e=[],n=null;a.data().forEach(function(i){var s=a._viewportSurface.project(i[0],i[1]),p=(new r).shape("circle").radius(3).data(i).pos(s);t.push(p),n&&e.push((new o).sourceVertex(n).targetVertex(p).targetMarker("arrowHead")),n=p}),this.data({vertices:t,edges:e}),i.apply(this,arguments),this.graphData.nodeValues().forEach(function(t){var e=a._viewportSurface.project(t.data()[0],t.data()[1]);e.x-=a.width()/2,e.y-=a.height()/2,t.move(e)}),this.graphData.edgeValues().forEach(function(t){t.points([])})},this._viewportSurface.widget(n)},n}),function(t,e){"function"==typeof define&&define.amd?define("src/map/GMapHeat",["./GMap","../other/HeatMap"],e):t.map_GMapHeat=e(t.map_GMap,t.other_HeatMap)}(this,function(t,e){function o(){t.call(this)}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype._class+=" map_GMapHeat",o.prototype.enter=function(){t.prototype.enter.apply(this,arguments);var o=new e,r=o.render,n=this;o.render=function(){this.data(n.data().map(function(t){var e=n._viewportSurface.project(t[0],t[1]);return[e.x,e.y,t[4]]})),r.apply(this,arguments)},this._viewportSurface.widget(o)},o}),function(t,e){"function"==typeof define&&define.amd?define("src/map/GMapLayered",["d3","./GMap","../common/SVGWidget"],e):t.map_GMapLayered=e(t.d3,t.map_GMap,t.common_SVGWidget)}(this,function(t,e,o){function r(){o.call(this),this._drawStartPos="origin"}function n(){e.call(this),this._layers=[]}var i=1/16,a=4096;return r.prototype=Object.create(o.prototype),r.prototype.constructor=r,r.prototype._class+=" map_Layered map_GMapLayered",r.prototype.enter=function(e,r){o.prototype.enter.apply(this,arguments),this._zoom=t.behavior.zoom().translate([0,0]).scale(1),this._d3GeoProjection=t.geo.mercator().scale(a/2/Math.PI).translate([0,0]),this._d3GeoPath=t.geo.path().projection(this._d3GeoProjection)},r.prototype.update=function(t,e){o.prototype.update.apply(this,arguments),this._hasZoomed=!0,this._hasRendered?this.zoomed():this.fullRender()},r.prototype.preRender=function(t){return Promise.all(this.gmap.layers().filter(function(t){return t.visible()}).map(function(t){return t.layerPreRender()}))},r.prototype.fullRender=function(){if(this._hasZoomed){this._hasRendered=!0,this.size(this.gmap.size());var e=this._element.selectAll(".layerContainer").data(this.gmap.layers().filter(function(t){return t.visible()}),function(t){return t.id()}),o=this;e.enter().append("g").attr("class","layerContainer").each(function(e){var r=t.select(this),n=o._parentOverlay.append("div");e.layerEnter(o,r,n)}),e.each(function(t){t.layerUpdate(o)}),e.exit().each(function(t){t.layerExit(o)}).remove(),this.zoomed()}},r.prototype.zoomed=function(){var t=this.gmap._overlay.getProjection();if(t){var e=new google.maps.LatLng(0,0),o=t.fromLatLngToDivPixel(e),r=parseFloat(this.surface.widgetX()),n=parseFloat(this.surface.widgetY()),a=[o.x-r,o.y-n],s=this.gmap._googleMap.getZoom();this._zoom.scale(i*(1<<s)).translate(a);var p=this._element.selectAll(".layerContainer"),l=this;p.each(function(t){t.layerZoomed(l)})}},r.prototype.projection=function(){return"mercator"},r.prototype.project=function(t,e){var o=this.surface.project(t,e);return[o.x,o.y]},n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype._class+=" map_GMapLayered",n.prototype.updateCircles=function(){},n.prototype.updatePins=function(){},n.prototype.layers=function(t){return arguments.length?(this._layers=t,this):this._layers},n.prototype.enter=function(){e.prototype.enter.apply(this,arguments),this.layered=new r,this.layered.gmap=this,this.layered.surface=this._viewportSurface,this.layered.surface.widget(this.layered).render()},n.prototype.render=function(t){var o=this,r=e.prototype.render.call(this,function(e){o.layered.preRender().then(function(){o.layered.fullRender(),t&&t(e)})});return r},n}),define("css!src/map/Pins",[],function(){}),function(t,e){"function"==typeof define&&define.amd?define("src/map/Pins",["d3","./Layer","./Utility","../common/Palette","../common/Utility","css!./Pins"],e):t.map_Pins=e(t.d3,t.map_Layer,t.map_Utility,t.common_Palette,t.common_Utility)}(this,function(t,e,o,r,n){function i(){e.call(this),n.SimpleSelectionMixin.call(this),this._geohash=new o.Geohash}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype._class+=" map_Pins",i.prototype.mixin(n.SimpleSelectionMixin),i.prototype.publish("geohashColumn",null,"set","Geohash column",function(){return this.columns()},{optional:!0}),i.prototype.publish("tooltipColumn",null,"set","Tooltip column",function(){return this.columns()},{optional:!0}),i.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),i.prototype.publish("fillColor","#00FFDD","html-color","Pin Color",null,{optional:!0}),i.prototype.publish("strokeWidth",.5,"number","Pin Border Thickness (pixels)",null,{tags:["Basic"]}),i.prototype.publish("strokeColor",null,"html-color","Pin Border Color",null,{optional:!0}),i.prototype.publish("fontSize",18,"number","Font Size",null,{tags:["Basic","Shared"]}),i.prototype.publish("fontFamily","Verdana","string","Font Name",null,{tags:["Basic","Shared","Shared"]}),i.prototype.publish("fontColor","#000000","html-color","Font Color",null,{tags:["Basic","Shared"]}),i.prototype.publish("pinType","pin","set","Pin Type",["pin","circle","rectangle","rectangle-pin"],{tags:["Basic"]}),i.prototype.publish("arrowWidth",8,"number","Pin arrow width (pixels)",null,{tags:["Basic"],disable:function(t){return-1===["pin","rectangle-pin"].indexOf(t.pinType())}}),i.prototype.publish("arrowHeight",12,"number","Pin arrow height (pixels)",null,{tags:["Basic"],disable:function(t){return-1===["pin","rectangle-pin"].indexOf(t.pinType())}}),i.prototype.publish("pinWidth",20,"number","Width of pin (pixels)",null,{tags:["Basic"],disable:function(t){return-1===["rectangle","rectangle-pin"].indexOf(t.pinType())}}),i.prototype.publish("pinHeight",20,"number","Height of pin (pixels) (not including arrow)",null,{tags:["Basic"],disable:function(t){return-1===["rectangle","rectangle-pin"].indexOf(t.pinType())}}),i.prototype.publish("cornerRadius",10,"number","Radius of rectangular pin corners (pixels)",null,{tags:["Basic"],disable:function(t){return-1===["rectangle","rectangle-pin"].indexOf(t.pinType())}}),i.prototype.publish("pinRadius",12,"number","Radius of circle (pixels)",null,{tags:["Basic"],disable:function(t){return"circle"!==t.pinType()}}),i.prototype.publish("textBaseline","central","set","Pin text vertical alignment",["auto","use-script","no-change","reset-size","ideographic","alphabetic","hanging","mathematical","central","middle","text-after-edge","text-before-edge","inherit"],{tags:["Basic"]}),i.prototype.publish("omitNullLatLong",!1,"boolean","Remove lat=0,lng=0 from pinsData",null,{tags:["Basic"]}),i.prototype.pinsData=function(){var t=this._db.fieldByLabel(this.geohashColumn()),e=this._db.fieldByLabel(this.tooltipColumn()),o=this;return this.data().filter(function(t){return o.omitNullLatLong()&&0===t[0]&&0===t[1]?!1:!0}).map(function(o){var r={lat:o[0],"long":o[1],ext:o[2]instanceof Object?o[2]:{},origRow:o};if(t)try{var n=this._geohash.bounds(o[t.idx]);r.lat=(n.ne.lat+n.sw.lat)/2,r["long"]=(n.ne.lon+n.sw.lon)/2}catch(i){}return e&&(r.ext.tooltip=o[e.idx]),r},this)},i.prototype.layerEnter=function(o,r,n){e.prototype.layerEnter.apply(this,arguments),this._pinsTransform=r,this._selection.widgetElement(this._pinsTransform),this.pinsPaths=t.select(null)},i.prototype.layerUpdate=function(t){e.prototype.layerUpdate.apply(this,arguments),this._pinsTransform.style("opacity",this.opacity()),this.pinsPaths=this._pinsTransform.selectAll(".pin").data(this.visible()?this.pinsData():[]);var o=this,r=this.pinsPaths.enter().append("g").attr("class","pin").call(this._selection.enter.bind(this._selection)).on("click",function(t){o.click(o.rowToObj(t.origRow),"geohash",o._selection.selected(this))}).on("dblclick",function(t){o.dblclick(o.rowToObj(t[2].origRow),"geohash",o._selection.selected(this))}).on("mouseover",function(t){o.isIE||this.parentNode.appendChild(this)});r.append("path").attr("class","data").append("title"),r.append("text").attr("text-anchor","middle"),this.pinsPaths.selectAll("text").style("stroke",this.fontColor()).style("fill",this.fontColor()).style("font-size",this.fontSize()).style("font-family",this.fontFamily()).style("dominant-baseline",this.textBaseline()).attr("dx",0).attr("dy",this.pinTextDY()).text(function(t){return t.ext&&t.ext.text?t.ext.text:""});var n=this.svgPinPath();this.pinsPaths.selectAll("path.data").attr("d",n).attr("stroke-width",this.strokeWidth()+"px").style("display",function(e){var o=t.project(e.lat,e["long"]);return o?null:"none"}).style("stroke",function(t){return t.ext&&t.ext.strokeColor?t.ext.strokeColor:o.strokeColor()}).style("fill",function(t){return t.ext&&t.ext.fillColor?t.ext.fillColor:o.fillColor()}),this.pinsPaths.select("title").text(function(t){return t.ext&&t.ext.tooltip?t.ext.tooltip:""}),this.pinsPaths.exit().remove()},i.prototype.layerZoomed=function(t){e.prototype.layerZoomed.apply(this,arguments),this.pinsPaths.attr("transform",function(e){var o=t.project(e.lat,e["long"]);return o||(o=[0,0]),"translate("+o[0]+", "+o[1]+")scale(1)"})},i.prototype.pinTextDY=function(){switch(this.pinType()){case"pin":case"rectangle-pin":return-this.arrowHeight();case"circle":case"rectangle":return 0}},i.prototype.svgPinPath=function(){switch(this.pinType()){case"pin":return this.circlePinPath();case"circle":return this.circlePath();case"rectangle":return this.rectanglePath();case"rectangle-pin":return this.rectanglePinPath()}},i.prototype.rectanglePinPath=function(){var t=this.pinWidth(),e=this.pinHeight(),o=this.cornerRadius(),r=this.arrowHeight(),n=this.arrowWidth(),i=0-t/2,a=0-e+o,s=(t-2*o-n)/2;return"M"+i+","+a+"a"+-o+","+-o+" 0 0 1 "+o+","+-o+"h"+(t+2*-o)+"a"+o+","+o+" 0 0 1 "+o+","+o+"v"+(e+2*-o)+"a"+o+","+o+" 0 0 1 "+-o+","+o+"h"+-s+"l"+-n/2+","+r+"l"+-n/2+","+-r+"h"+-s+"a"+-o+","+-o+" 0 0 1 "+-o+","+-o+"z"},i.prototype.rectanglePath=function(){var t=this.pinWidth(),e=this.pinHeight(),o=this.cornerRadius(),r=-t/2,n=-e/2;return n+=o,"M"+r+","+n+"a"+-o+","+-o+" 0 0 1 "+o+","+-o+"h"+(t+2*-o)+"a"+o+","+o+" 0 0 1 "+o+","+o+"v"+(e+2*-o)+"a"+o+","+o+" 0 0 1 "+-o+","+o+"h"+(-t+2*o)+"a"+-o+","+-o+" 0 0 1 "+-o+","+-o+"z"},i.prototype.circlePinPath=function(){var t=this.arrowHeight(),e=this.arrowWidth(),o=0-e/2,r=0-t,n=e/2,i=t,a=-n,s=-i,p=e+n,l=s,c=e,h=0;return"M"+o+","+r+"c"+a+" "+s+", "+p+" "+l+", "+c+" "+h+"l"+-e/2+","+t+"l"+-e/2+","+-t+"z"},i.prototype.circlePath=function(){var t=this.pinRadius(),e=t/2,o=0,r=t/2,n=t/2;return"M"+e+","+o+"a "+r+" "+n+" 0 1 0 0 0.01 0z"},i.prototype.click=function(t,e,o){console.log("Click:  "+JSON.stringify(t)+", "+e+", "+o)},i.prototype.dblclick=function(t,e,o){console.log("Double click:  "+JSON.stringify(t)+", "+e+", "+o)},i}),function(t,e){"function"==typeof define&&define.amd?define("src/map/GMapPin",["d3","./GMapLayered","./Pins"],e):t.map_GMapPin=e(t.d3,t.map_GMapLayered,t.map_Pins)}(this,function(t,e,o){function r(t){e.call(this);var r=this;this._pins=(new o).columns(["lat","long","ext"]).on("click",function(t,e,o){r.click(r.rowToObj(t.ext.origRow),"",o)}).on("dblclick",function(t,e,o){r.dblclick(r.rowToObj(t.ext.origRow),"",o)})}return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype._class+=" map_GMapPin",r.prototype.publishProxy("pinColor","_pins","fillColor"),r.prototype.publishProxy("pinType","_pins","pinType"),r.prototype.publishProxy("pinWidth","_pins","pinWidth"),r.prototype.publishProxy("pinHeight","_pins","pinHeight"),r.prototype.publishProxy("cornerRadius","_pins","cornerRadius"),r.prototype.publishProxy("pinRadius","_pins","pinRadius"),r.prototype.publishProxy("arrowWidth","_pins","arrowWidth"),r.prototype.publishProxy("arrowHeight","_pins","arrowHeight"),r.prototype.publishProxy("textBaseline","_pins","textBaseline"),r.prototype.publishProxy("strokeWidth","_pins","strokeWidth"),r.prototype.publishProxy("omitNullLatLong","_pins","omitNullLatLong"),r.prototype.publish("latitudeColumn",null,"set","Latitude",function(){return this.columns()},{optional:!0}),r.prototype.publish("longtitudeColumn",null,"set","Longtitude",function(){return this.columns()},{optional:!0}),r.prototype.publish("colorColumn",null,"set","Color",function(){return this.columns()},{optional:!0}),r.prototype.publish("tooltipColumn",null,"set","Tooltip",function(){return this.columns()},{optional:!0}),r.prototype.pinsData=function(){var t=this.columns();return this._view=this._db.rollupView([this.latitudeColumn(),this.longtitudeColumn()]),this._view.entries().map(function(e){var o=e.values[0].values[0];return[e.key,e.values[0].key,{fillColor:o[t.indexOf(this.colorColumn())],tooltip:o[t.indexOf(this.tooltipColumn())],origRow:o}]},this)},r.prototype.enter=function(t,o){e.prototype.enter.apply(this,arguments),this.layers([this._pins])},r.prototype.update=function(t,o){e.prototype.update.apply(this,arguments),this._pins.data(this.pinsData())},r.prototype.exit=function(t,o){e.prototype.exit.apply(this,arguments)},r.prototype.click=function(t,e,o){console.log("Click:  "+JSON.stringify(t)+", "+e+","+o)},r.prototype.dblclick=function(t,e,o){console.log("Double click:  "+JSON.stringify(t)+", "+e+","+o)},r}),define("css!src/map/Lines",[],function(){}),function(t,e){"function"==typeof define&&define.amd?define("src/map/Lines",["d3","./Layer","css!./Lines"],e):t.map_Graph=e(t.d3,t.map_Layer)}(this,function(t,e){function o(){e.call(this)}return o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.prototype._class+=" map_Lines",o.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),o.prototype.data=function(t){var o=e.prototype.data.apply(this,arguments);return arguments.length&&(this.dataEdges=[],t.forEach(function(t){this.dataEdges.push({type:"LineString",coordinates:[[t[1],t[0]],[t[3],t[2]]]})},this)),o},o.prototype.layerEnter=function(o,r,n){e.prototype.layerEnter.apply(this,arguments),r.append("defs").append("marker").attr("class","marker").attr("id",this._id+"_arrowHead").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",16).attr("markerHeight",16).attr("markerUnits","strokeWidth").attr("orient","auto").append("polyline").attr("points","0,0 10,5 0,10 1,5"),this._edgesTransform=r.append("g"),this.edgesPaths=t.select(null)},o.prototype.layerUpdate=function(t){e.prototype.layerUpdate.apply(this,arguments),this._edgesTransform.style("opacity",this.opacity()),this.edgesPaths=this._edgesTransform.selectAll(".dataEdge").data(this.visible()?this.dataEdges:[]),this.edgesPaths.enter().append("path").attr("class","dataEdge").attr("marker-end","url(#"+this._id+"_arrowHead)"),this.edgesPaths.attr("d",t._d3GeoPath),this.edgesPaths.exit().remove()},o.prototype.layerZoomed=function(t){e.prototype.layerZoomed.apply(this,arguments),this._edgesTransform.attr("transform","translate("+t._zoom.translate()+")scale("+t._zoom.scale()+")").style("stroke-width",.5/t._zoom.scale()+"px")},o}),function(t,e){"function"==typeof define&&define.amd?define("src/map/GMapPinLine",["d3","./GMapLayered","./Lines","./Pins"],e):t.map_GMapPinLine=e(t.d3,t.map_GMapLayered,t.map_Lines,t.map_Pins)}(this,function(t,e,o,r){function n(t){e.call(this);var n=this;this._lines=new o,this._pins=(new r).columns(["lat","long","ext"]).on("click",function(t,e,o){n.click(n.rowToObj(t.ext.origRow),"",o)}).on("dblclick",function(t,e,o){n.click(n.rowToObj(t.ext.origRow),"",o);
})}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype._class+=" map_GMapPinLine",n.prototype.publish("fromPinColor","green","color","From Pin Color"),n.prototype.publish("fromLatitudeColumn",null,"set","From Latitude",function(){return this.columns()},{optional:!0}),n.prototype.publish("fromLongtitudeColumn",null,"set","From Longtitude",function(){return this.columns()},{optional:!0}),n.prototype.publish("fromColorColumn",null,"set","From Color",function(){return this.columns()},{optional:!0}),n.prototype.publish("fromTooltipColumn",null,"set","From Tooltip",function(){return this.columns()},{optional:!0}),n.prototype.publish("toPinColor","red","color","To Pin Color"),n.prototype.publish("toLatitudeColumn",null,"set","To Latitude",function(){return this.columns()},{optional:!0}),n.prototype.publish("toLongtitudeColumn",null,"set","To Longtitude",function(){return this.columns()},{optional:!0}),n.prototype.publish("toColorColumn",null,"set","To Color",function(){return this.columns()},{optional:!0}),n.prototype.publish("toTooltipColumn",null,"set","To Tooltip",function(){return this.columns()},{optional:!0}),n.prototype.pinsData=function(){var t=this.columns();this._fromView=this._db.rollupView([this.fromLatitudeColumn(),this.fromLongtitudeColumn()]),this._toView=this._db.rollupView([this.toLatitudeColumn(),this.toLongtitudeColumn()]);var e=this._fromView.entries().map(function(e){var o=e.values[0].values[0];return[e.key,e.values[0].key,{fillColor:o[t.indexOf(this.fromColorColumn())]||this.fromPinColor(),tooltip:o[t.indexOf(this.fromTooltipColumn())],origRow:o}]},this),o=this._toView.entries().map(function(e){var o=e.values[0].values[0];return[e.key,e.values[0].key,{fillColor:o[t.indexOf(this.toColorColumn())]||this.toPinColor(),tooltip:o[t.indexOf(this.toTooltipColumn())],origRow:o}]},this);return e.concat(o)},n.prototype.linesData=function(){return this._linesView=this._db.rollupView([this.fromLatitudeColumn(),this.fromLongtitudeColumn(),this.toLatitudeColumn(),this.toLongtitudeColumn()]),this._linesView.data()},n.prototype.enter=function(t,o){e.prototype.enter.apply(this,arguments),this.layers([this._lines,this._pins])},n.prototype.update=function(t,o){e.prototype.update.apply(this,arguments),this._pins.data(this.pinsData()),this._lines.data(this.linesData())},n.prototype.exit=function(t,o){e.prototype.exit.apply(this,arguments)},n.prototype.click=function(t,e,o){console.log("Click:  "+JSON.stringify(t)+", "+e+","+o)},n.prototype.dblclick=function(t,e,o){console.log("Double click:  "+JSON.stringify(t)+", "+e+","+o)},n}),define("css!src/map/Graph",[],function(){}),function(t,e){"function"==typeof define&&define.amd?define("src/map/Graph",["d3","topojson","./Pins","../graph/Graph","../graph/Edge","../common/Shape","css!./Graph"],e):t.map_Graph=e(t.d3,t.topojson,t.map_Pins,t.graph_Graph,t.graph_Edge,t.common_Shape)}(this,function(t,e,o,r,n,i){function a(){o.call(this)}return a.prototype=Object.create(o.prototype),a.prototype.constructor=a,a.prototype._class+=" map_Graph",a.prototype.data=function(t){var e=o.prototype.data.apply(this,arguments);if(arguments.length){this.dataEdges=[];var r=null;t.forEach(function(t){r&&this.dataEdges.push({type:"LineString",coordinates:[[r[1],r[0]],[t[1],t[0]]]}),r=t},this)}return e},a.prototype.layerEnter=function(e,r,n){o.prototype.layerEnter.apply(this,arguments),r.append("defs").append("marker").attr("class","marker").attr("id",this._id+"_arrowHead").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",16).attr("markerHeight",16).attr("markerUnits","strokeWidth").attr("orient","auto").append("polyline").attr("points","0,0 10,5 0,10 1,5"),this._edgesTransform=r.append("g"),this.edgesPaths=t.select(null)},a.prototype.layerUpdate=function(t){o.prototype.layerUpdate.apply(this,arguments),this._edgesTransform.style("opacity",this.opacity()),this.edgesPaths=this._edgesTransform.selectAll(".dataEdge").data(this.visible()?this.dataEdges:[]),this.edgesPaths.enter().append("path").attr("class","dataEdge").attr("marker-end","url(#"+this._id+"_arrowHead)"),this.edgesPaths.attr("d",t._d3GeoPath),this.edgesPaths.exit().remove()},a.prototype.layerZoomed=function(t){o.prototype.layerZoomed.apply(this,arguments),this._edgesTransform.attr("transform","translate("+t._zoom.translate()+")scale("+t._zoom.scale()+")").style("stroke-width",.5/t._zoom.scale()+"px")},a}),define("css!src/map/Graticule",[],function(){}),function(t,e){"function"==typeof define&&define.amd?define("src/map/Graticule",["d3","topojson","./Layer","../common/Palette","css!./Graticule"],e):t.map_Graticule=e(t.d3,t.topojson,t.map_Layer,t.common_Palette)}(this,function(t,e,o,r){function n(){o.call(this),this._dataMap={},this._path=t.select(null)}return n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype._class+=" map_Graticule",n.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),n.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),n.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),n.prototype.layerEnter=function(e,r,n){o.prototype.layerEnter.apply(this,arguments),this._graticule=t.geo.graticule(),this._graticulePath=r.append("path").datum(this._graticule).attr("class","graticule"),this._graticuleOutlinePath=r.append("path").datum(this._graticule.outline).attr("class","graticuleOutline")},n.prototype.layerUpdate=function(t){return this.visible()?(this._prevProjection!==t.projection()&&(this._graticulePath.attr("d",t._d3GeoPath),this._graticuleOutlinePath.attr("d",t._d3GeoPath),this._prevProjection=t.projection()),this._graticulePath.style("stroke",this.meshColor()),void this._graticuleOutlinePath.style("stroke",this.meshColor())):(this._graticulePath.attr("d",""),this._graticuleOutlinePath.attr("d",""),void delete this._prevProjection)},n.prototype.layerExit=function(t){delete this._prevProjection},n.prototype.layerZoomed=function(t){this._graticulePath.style("opacity",this.opacity()).attr("transform","translate("+t._zoom.translate()+")scale("+t._zoom.scale()+")").style("stroke-width",this.meshStrokeWidth()/t._zoom.scale()+"px"),this._graticuleOutlinePath.style("opacity",this.opacity()).attr("transform","translate("+t._zoom.translate()+")scale("+t._zoom.scale()+")").style("stroke-width",this.meshStrokeWidth()/t._zoom.scale()+"px")},n}),define("css!src/map/Heat",[],function(){}),function(t,e){"function"==typeof define&&define.amd?define("src/map/Heat",["d3","topojson","./Layer","../other/HeatMap","../common/Palette","css!./Heat"],e):t.map_Heat=e(t.d3,t.topojson,t.map_Layer,t.other_HeatMap,t.common_Palette)}(this,function(t,e,o,r,n){function i(){o.call(this)}return i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype._class+=" map_Heat",i.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),i.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),i.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),i.prototype.layerEnter=function(t,e,n){o.prototype.layerEnter.apply(this,arguments),this._parentOverlay.style("pointer-events","none"),this._heatTransform=n.style("pointer-events","none").append("div").attr("class",this.classID()).style("width",t.width()+"px").style("height",t.height()+"px"),this.heat=(new r).target(this._heatTransform.node())},i.prototype.layerUpdate=function(t){o.prototype.layerUpdate.apply(this,arguments),this._heatTransform.style("opacity",this.opacity()).style("width",t.width()+"px").style("height",t.height()+"px"),this.heat.resize(t.size()),this.heat.columns(this.columns()).data(this.data().map(function(e){var o=t.project(e[0],e[1]);return[o[0],o[1],e[4]]})).render()},i.prototype.layerExit=function(t){delete this._prevProjection,this.heat.target(null),delete this.heat},i.prototype.layerZoomed=function(t){o.prototype.layerZoomed.apply(this,arguments),this.heat.columns(this.columns()).data(this.visible()?this.data().map(function(e){var o=t.project(e[0],e[1]);return[o[0],o[1],e[4]]}):[]).render()},i}),function(t,e){"function"==typeof define&&define.amd?define("src/map/IChoropleth",["../common/Palette"],e):t.map_IChoropleth=e(t.common_Palette,t.usStates,t.usCounties)}(this,function(t,e,o){function r(){}return r.prototype._palette=t.rainbow("default"),r.prototype.click=function(t,e,o){console.log("Click:  "+JSON.stringify(t)+", "+e+", "+o)},r}),define("css!src/map/OpenStreet",[],function(){}),function(t,e){"function"==typeof define&&define.amd?define("src/map/OpenStreet",["d3","topojson","./Layer","./Utility","css!./OpenStreet"],e):t.map_OpenStreet=e(t.d3,t.topojson,t.map_Layer,t.map_Utility)}(this,function(t,e,o,r){function n(){o.call(this)}return n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype._class+=" map_OpenStreet",n.prototype._copyrightText=" OpenStreetMap contributors",n.prototype.publish("tileProvider","OpenStreetMap","set","Tile Provider",["OpenStreetMap","OpenStreetMap Hot","MapQuest","MapQuest Sat","Stamen Watercolor","OpenCycleMap"],{tags:["Basic","Shared"]}),n.prototype.layerEnter=function(t,e,n){o.prototype.layerEnter.apply(this,arguments),this._tile=r.Tile(),this._openStreetTransform=e.append("g"),this._openStreet=this._openStreetTransform.append("g"),this._copyright=e.append("text").attr("x",-100).attr("y",-100).style("opacity",.5).text(this._copyrightText),this._copyrightBBox=this._copyright.node().getBBox()},n.prototype.layerUpdate=function(t){this.visible()?this._copyright.attr("x",t.width()-this._copyrightBBox.width-this._copyrightBBox.height/2).attr("y",t.height()-this._copyrightBBox.height/2).text(this._copyrightText):this._copyright.text("")},n.prototype.layerZoomed=function(t){var e=[];if(this.visible()){var o=t.project(-85,180);(!o||o[0]<=0||o[1]<=0)&&(o=[t.width(),t.height()]),this._tile.size([Math.min(t.width(),o[0]),Math.min(t.height(),o[1])]).scale(4096*t._zoom.scale()).translate(t._zoom.translate()),e=this._tile(),this._openStreetTransform.attr("transform","scale("+e.scale+")translate("+e.translate+")")}this._prevTileProvider!==this.tileProvider()&&(this._openStreet.selectAll("image").remove(),this._prevTileProvider=this.tileProvider());var r=this,n="https:"===window.location.protocol?"https:":"http:",i=this._openStreet.selectAll("image").data(e,function(t){return t[2]+"/"+t[0]+"/"+t[1]});i.enter().append("image").attr("xlink:href",function(t){switch(r.tileProvider()){case"OpenStreetMap Hot":return n+"//"+["a","b","c"][3*Math.random()|0]+".tile.openstreetmap.fr/hot/"+t[2]+"/"+t[0]+"/"+t[1]+".png";case"MapQuest":return n+"//otile"+["1","2","3","4"][4*Math.random()|0]+".mqcdn.com/tiles/1.0.0/osm/"+t[2]+"/"+t[0]+"/"+t[1]+".png";case"MapQuest Sat":return n+"//otile"+["1","2","3","4"][4*Math.random()|0]+".mqcdn.com/tiles/1.0.0/sat/"+t[2]+"/"+t[0]+"/"+t[1]+".png";case"Stamen Watercolor":return n+"//"+["a","b","c"][3*Math.random()|0]+".tile.stamen.com/watercolor/"+t[2]+"/"+t[0]+"/"+t[1]+".png";case"OpenCycleMap":return n+"//"+["a","b"][2*Math.random()|0]+".tile.opencyclemap.org/cycle/"+t[2]+"/"+t[0]+"/"+t[1]+".png";default:return n+"//"+["a","b","c"][3*Math.random()|0]+".tile.openstreetmap.org/"+t[2]+"/"+t[0]+"/"+t[1]+".png"}}).attr("width",1).attr("height",1).attr("x",function(t){return t[0]}).attr("y",function(t){return t[1]}).style("opacity",0).transition().duration(500).style("opacity",1),i.exit().remove()},n}),function(t,e){"function"==typeof define&&define.amd?define("src/map/TestHeatMap",["../layout/Layered","../layout/AbsoluteSurface","./ChoroplethStates","../other/HeatMap"],e):t.map_TestHeatMap=e(t.layout_Layered,t.layout_AbsoluteSurface,t.map_ChoroplethStates,t.other_HeatMap)}(this,function(t,e,o,r){function n(e){t.call(this)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.prototype._class+=" map_TestHeatMap",n}),function(t,e){"function"==typeof define&&define.amd?define("src/map/TopoJSONChoropleth",["d3","topojson","./Choropleth","require"],e):t.map_TopoJSONChoropleth=e(t.d3,t.topojson,t.map_Choropleth,t.require)}(this,function(t,e,o,r){function n(){o.call(this),this.projection("mercator")}return n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype._class+=" map_TopoJSONChoropleth",n.prototype.publish("region","GB","set","Region Data",["AT","BE","BG","CHLI","CY","CZ","DE","DK","EE","ES","FI","FR","GB","GE","GR","HR","HU","IE","IS","IT","KS","LT","LU","LV","MD","MK","MT","ND","NL","NO","PL","PT","RO","RS","SE","SI","SK","UA"]),n.prototype.layerEnter=function(e,r,n){o.prototype.layerEnter.apply(this,arguments),this._selection.widgetElement(this._choroplethData),this.choroPaths=t.select(null);var i=this;this.tooltipHTML(function(t){var e=i.columns(),o=e&&e.length?e[0]:"Location",r=t&&t.length?t[t.length-1]:[""];return i.tooltipFormat({label:r[0],series:o,value:t[1]})})},n.prototype.layerUpdate=function(t){o.prototype.layerUpdate.apply(this,arguments);var e=[],r=this;this.data().forEach(function(t){if(isNaN(t[0]))for(var o in r._choroTopologyIndex)for(var n in r._choroTopologyIndex[o])n===t[0]&&r._choroTopologyIndex[o][n].forEach(function(o){e.push([o].concat(t.filter(function(t,e){return e>0})).concat([t]))});else e.push(t.concat([t]))}),this.choroPaths=this._choroplethData.selectAll(".data").data(this.visible()?e:[],function(t){return t[0]}),this.choroPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(t){r._dataMap[t[0]]&&r.click(r.rowToObj(r._dataMap[t[0]]),"weight",r._selection.selected(r))}).on("dblclick",function(t){r._dataMap[t[0]]&&r.dblclick(r.rowToObj(r._dataMap[t[0]]),"weight",r._selection.selected(r))}).on("mouseout.tooltip",this.tooltip.hide).on("mousemove.tooltip",this.tooltip.show),this.choroPaths.attr("d",function(e){var o=t._d3GeoPath(r._choroTopologyFeatures[e[0]]);return o||console.log("Unknown Country:  "+e),o}).style("fill",function(t){var e=r._palette(t[1],r._dataMinWeight,r._dataMaxWeight);return e}),this.choroPaths.exit().remove()},n.prototype.layerPreRender=function(){if(this._prevRegion!==this.region()&&(this._prevRegion=this.region(),delete this._topoJsonPromise),!this._topoJsonPromise){var t=this;this._topoJsonPromise=new Promise(function(o,n){r(["json!src/map/TopoJSON/"+t.region()+".json"],function(n){function i(e){t._choroTopologyIndex=e,o()}t._choroTopology=n,t._choroTopologyObjects=n.objects.PolbndA,t._choroTopologyFeatures=e.feature(t._choroTopology,t._choroTopologyObjects).features,r(["json!src/map/TopoJSON/"+t.region()+"_idx.json"],i,function(t){i({})})})})}return this._topoJsonPromise},n}),function(t){var e=document,o="appendChild",r="styleSheet",n=e.createElement("style");n.type="text/css",e.getElementsByTagName("head")[0][o](n),n[r]?n[r].cssText=t:n[o](e.createTextNode(t))}(".map_Layered .background{fill:none}.map_Layered .raster image{fill:#b5d0d0}.map_Layered .hash path{fill:none;stroke:red;stroke-linejoin:round}.map_Layered .checkerFill{fill:red;stroke:red;opacity:.5}.map_Layered .checkerNoFill{fill:none;stroke:none;opacity:.5}.map_Layered .mesh{fill:none;stroke:#6d6e71}.map_Layered .data{stroke:none}.map_Layered .data.selected{stroke-width:1.25px;stroke:red}.map_Layered .data.over{stroke:orange}.map_Layered .data.selected.over,.map_Layered .pin.selected,.map_Layered .pin.selected.over{stroke:red}.map_GMap .marker{fill:#656565;stroke:none;stroke-width:1px}.map_GMap .map_Layered{pointer-events:auto;cursor:auto}.gm-style img{max-width:none}.gm-style label{width:auto;display:inline}.map_Layered .pin{cursor:pointer;stroke:#000}.map_Layered .pin.over{stroke:orange}.map_Layered .marker{fill:#656565;stroke:none;stroke-width:1px}.map_Layered .dataEdge{stroke:#000;fill:none}.map_Layered .graticule,.map_Layered .graticuleOutline{fill:none;stroke:#a9a9a9;stroke-linejoin:round}.map_Layered .graticuleOutline{stroke:#000}.map_Heat{//pointer-events:none}.map_Heat canvas{pointer-events:none}.map_OpenStreet .background{fill:#fff}.map_OpenStreet .graticule{fill:none;stroke:#777;stroke-width:.5px;stroke-opacity:.5}.map_Layered .vector{fill:none;stroke:navy;stroke-linejoin:round}"),define("hpcc-viz-map",function(){});