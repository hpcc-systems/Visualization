export interface Node {
    id: string;
    text: string;
}

export interface Link {
    id: string;
    source: Node;
    target: Node;
}

export interface Data {
    nodes: Node[];
    links: Link[];
}

export interface Options {
    alpha: number;
    alphaMin: number;
    alphaDecay: number;
    velocityDecay: number;
    repulsionStrength: number;
    linkDistance: number;
    linkStrength: number;
    iterations: number;
}

export function forceDirected(data: Data, options: Options) {
    return new Promise(resolve => {
        // tslint:disable-next-line
        const workerCode = `var forceDirected=function(t){"use strict";function n(t){return function(){return t}}function e(){return 1e-6*(Math.random()-.5)}function r(t,n,e,r){if(isNaN(n)||isNaN(e))return t;var i,o,s,u,a,l,c,f,h,v=t._root,y={data:r},p=t._x0,_=t._y0,d=t._x1,g=t._y1;if(!v)return t._root=y,t;for(;v.length;)if((l=n>=(o=(p+d)/2))?p=o:d=o,(c=e>=(s=(_+g)/2))?_=s:g=s,i=v,!(v=v[f=c<<1|l]))return i[f]=y,t;if(u=+t._x.call(null,v.data),a=+t._y.call(null,v.data),n===u&&e===a)return y.next=v,i?i[f]=y:t._root=y,t;do{i=i?i[f]=new Array(4):t._root=new Array(4),(l=n>=(o=(p+d)/2))?p=o:d=o,(c=e>=(s=(_+g)/2))?_=s:g=s}while((f=c<<1|l)==(h=(a>=s)<<1|u>=o));return i[h]=v,i[f]=y,t}function i(t,n,e,r,i){this.node=t,this.x0=n,this.y0=e,this.x1=r,this.y1=i}function o(t){return t[0]}function s(t){return t[1]}function u(t,n,e){var r=new a(null==n?o:n,null==e?s:e,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function a(t,n,e,r,i,o){this._x=t,this._y=n,this._x0=e,this._y0=r,this._x1=i,this._y1=o,this._root=void 0}function l(t){for(var n={data:t.data},e=n;t=t.next;)e=e.next={data:t.data};return n}var c=u.prototype=a.prototype;c.copy=function(){var t,n,e=new a(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return e;if(!r.length)return e._root=l(r),e;for(t=[{source:r,target:e._root=new Array(4)}];r=t.pop();)for(var i=0;i<4;++i)(n=r.source[i])&&(n.length?t.push({source:n,target:r.target[i]=new Array(4)}):r.target[i]=l(n));return e},c.add=function(t){var n=+this._x.call(null,t),e=+this._y.call(null,t);return r(this.cover(n,e),n,e,t)},c.addAll=function(t){var n,e,i,o,s=t.length,u=new Array(s),a=new Array(s),l=1/0,c=1/0,f=-1/0,h=-1/0;for(e=0;e<s;++e)isNaN(i=+this._x.call(null,n=t[e]))||isNaN(o=+this._y.call(null,n))||(u[e]=i,a[e]=o,i<l&&(l=i),i>f&&(f=i),o<c&&(c=o),o>h&&(h=o));for(f<l&&(l=this._x0,f=this._x1),h<c&&(c=this._y0,h=this._y1),this.cover(l,c).cover(f,h),e=0;e<s;++e)r(this,u[e],a[e],t[e]);return this},c.cover=function(t,n){if(isNaN(t=+t)||isNaN(n=+n))return this;var e=this._x0,r=this._y0,i=this._x1,o=this._y1;if(isNaN(e))i=(e=Math.floor(t))+1,o=(r=Math.floor(n))+1;else{if(!(e>t||t>i||r>n||n>o))return this;var s,u,a=i-e,l=this._root;switch(u=(n<(r+o)/2)<<1|t<(e+i)/2){case 0:do{(s=new Array(4))[u]=l,l=s}while(o=r+(a*=2),t>(i=e+a)||n>o);break;case 1:do{(s=new Array(4))[u]=l,l=s}while(o=r+(a*=2),(e=i-a)>t||n>o);break;case 2:do{(s=new Array(4))[u]=l,l=s}while(r=o-(a*=2),t>(i=e+a)||r>n);break;case 3:do{(s=new Array(4))[u]=l,l=s}while(r=o-(a*=2),(e=i-a)>t||r>n)}this._root&&this._root.length&&(this._root=l)}return this._x0=e,this._y0=r,this._x1=i,this._y1=o,this},c.data=function(){var t=[];return this.visit(function(n){if(!n.length)do{t.push(n.data)}while(n=n.next)}),t},c.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},c.find=function(t,n,e){var r,o,s,u,a,l,c,f=this._x0,h=this._y0,v=this._x1,y=this._y1,p=[],_=this._root;for(_&&p.push(new i(_,f,h,v,y)),null==e?e=1/0:(f=t-e,h=n-e,v=t+e,y=n+e,e*=e);l=p.pop();)if(!(!(_=l.node)||(o=l.x0)>v||(s=l.y0)>y||(u=l.x1)<f||(a=l.y1)<h))if(_.length){var d=(o+u)/2,g=(s+a)/2;p.push(new i(_[3],d,g,u,a),new i(_[2],o,g,d,a),new i(_[1],d,s,u,g),new i(_[0],o,s,d,g)),(c=(n>=g)<<1|t>=d)&&(l=p[p.length-1],p[p.length-1]=p[p.length-1-c],p[p.length-1-c]=l)}else{var x=t-+this._x.call(null,_.data),w=n-+this._y.call(null,_.data),m=x*x+w*w;if(m<e){var b=Math.sqrt(e=m);f=t-b,h=n-b,v=t+b,y=n+b,r=_.data}}return r},c.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(s=+this._y.call(null,t)))return this;var n,e,r,i,o,s,u,a,l,c,f,h,v=this._root,y=this._x0,p=this._y0,_=this._x1,d=this._y1;if(!v)return this;if(v.length)for(;;){if((l=o>=(u=(y+_)/2))?y=u:_=u,(c=s>=(a=(p+d)/2))?p=a:d=a,n=v,!(v=v[f=c<<1|l]))return this;if(!v.length)break;(n[f+1&3]||n[f+2&3]||n[f+3&3])&&(e=n,h=f)}for(;v.data!==t;)if(r=v,!(v=v.next))return this;return(i=v.next)&&delete v.next,r?(i?r.next=i:delete r.next,this):n?(i?n[f]=i:delete n[f],(v=n[0]||n[1]||n[2]||n[3])&&v===(n[3]||n[2]||n[1]||n[0])&&!v.length&&(e?e[h]=v:this._root=v),this):(this._root=i,this)},c.removeAll=function(t){for(var n=0,e=t.length;n<e;++n)this.remove(t[n]);return this},c.root=function(){return this._root},c.size=function(){var t=0;return this.visit(function(n){if(!n.length)do{++t}while(n=n.next)}),t},c.visit=function(t){var n,e,r,o,s,u,a=[],l=this._root;for(l&&a.push(new i(l,this._x0,this._y0,this._x1,this._y1));n=a.pop();)if(!t(l=n.node,r=n.x0,o=n.y0,s=n.x1,u=n.y1)&&l.length){var c=(r+s)/2,f=(o+u)/2;(e=l[3])&&a.push(new i(e,c,f,s,u)),(e=l[2])&&a.push(new i(e,r,f,c,u)),(e=l[1])&&a.push(new i(e,c,o,s,f)),(e=l[0])&&a.push(new i(e,r,o,c,f))}return this},c.visitAfter=function(t){var n,e=[],r=[];for(this._root&&e.push(new i(this._root,this._x0,this._y0,this._x1,this._y1));n=e.pop();){var o=n.node;if(o.length){var s,u=n.x0,a=n.y0,l=n.x1,c=n.y1,f=(u+l)/2,h=(a+c)/2;(s=o[0])&&e.push(new i(s,u,a,f,h)),(s=o[1])&&e.push(new i(s,f,a,l,h)),(s=o[2])&&e.push(new i(s,u,h,f,c)),(s=o[3])&&e.push(new i(s,f,h,l,c))}r.push(n)}for(;n=r.pop();)t(n.node,n.x0,n.y0,n.x1,n.y1);return this},c.x=function(t){return arguments.length?(this._x=t,this):this._x},c.y=function(t){return arguments.length?(this._y=t,this):this._y};function f(){}function h(t,n){var e=new f;if(t instanceof f)t.each(function(t,n){e.set(n,t)});else if(Array.isArray(t)){var r,i=-1,o=t.length;if(null==n)for(;++i<o;)e.set(i,t[i]);else for(;++i<o;)e.set(n(r=t[i],i,t),r)}else if(t)for(var s in t)e.set(s,t[s]);return e}function v(){}f.prototype=h.prototype={constructor:f,has:function(t){return"$"+t in this},get:function(t){return this["$"+t]},set:function(t,n){return this["$"+t]=n,this},remove:function(t){var n="$"+t;return n in this&&delete this[n]},clear:function(){for(var t in this)"$"===t[0]&&delete this[t]},keys:function(){var t=[];for(var n in this)"$"===n[0]&&t.push(n.slice(1));return t},values:function(){var t=[];for(var n in this)"$"===n[0]&&t.push(this[n]);return t},entries:function(){var t=[];for(var n in this)"$"===n[0]&&t.push({key:n.slice(1),value:this[n]});return t},size:function(){var t=0;for(var n in this)"$"===n[0]&&++t;return t},empty:function(){for(var t in this)if("$"===t[0])return!1;return!0},each:function(t){for(var n in this)"$"===n[0]&&t(this[n],n.slice(1),this)}};var y=h.prototype;function p(t){return t.index}function _(t,n){var e=t.get(n);if(!e)throw new Error("missing: "+n);return e}v.prototype=function(t,n){var e=new v;if(t instanceof v)t.each(function(t){e.add(t)});else if(t){var r=-1,i=t.length;if(null==n)for(;++r<i;)e.add(t[r]);else for(;++r<i;)e.add(n(t[r],r,t))}return e}.prototype={constructor:v,has:y.has,add:function(t){return this["$"+(t+="")]=t,this},remove:y.remove,clear:y.clear,values:y.keys,size:y.size,empty:y.empty,each:y.each};var d={value:function(){}};function g(){for(var t,n=0,e=arguments.length,r={};n<e;++n){if(!(t=arguments[n]+"")||t in r)throw new Error("illegal type: "+t);r[t]=[]}return new x(r)}function x(t){this._=t}function w(t,n){for(var e,r=0,i=t.length;r<i;++r)if((e=t[r]).name===n)return e.value}function m(t,n,e){for(var r=0,i=t.length;r<i;++r)if(t[r].name===n){t[r]=d,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=e&&t.push({name:n,value:e}),t}x.prototype=g.prototype={constructor:x,on:function(t,n){var e,r,i=this._,o=(r=i,(t+"").trim().split(/^|\\s+/).map(function(t){var n="",e=t.indexOf(".");if(e>=0&&(n=t.slice(e+1),t=t.slice(0,e)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}})),s=-1,u=o.length;if(!(arguments.length<2)){if(null!=n&&"function"!=typeof n)throw new Error("invalid callback: "+n);for(;++s<u;)if(e=(t=o[s]).type)i[e]=m(i[e],t.name,n);else if(null==n)for(e in i)i[e]=m(i[e],t.name,null);return this}for(;++s<u;)if((e=(t=o[s]).type)&&(e=w(i[e],t.name)))return e},copy:function(){var t={},n=this._;for(var e in n)t[e]=n[e].slice();return new x(t)},call:function(t,n){if((e=arguments.length-2)>0)for(var e,r,i=new Array(e),o=0;o<e;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,e=(r=this._[t]).length;o<e;++o)r[o].value.apply(n,i)},apply:function(t,n,e){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(n,e)}};var b,A,N=0,M=0,k=0,E=1e3,T=0,j=0,q=0,S="object"==typeof performance&&performance.now?performance:Date,$="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function D(){return j||($(O),j=S.now()+q)}function O(){j=0}function P(){this._call=this._time=this._next=null}function z(t,n,e){var r=new P;return r.restart(t,n,e),r}function C(){j=(T=S.now())+q,N=M=0;try{!function(){D(),++N;for(var t,n=b;n;)(t=j-n._time)>=0&&n._call.call(null,t),n=n._next;--N}()}finally{N=0,function(){var t,n,e=b,r=1/0;for(;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:b=n);A=t,I(r)}(),j=0}}function F(){var t=S.now(),n=t-T;n>E&&(q-=n,T=t)}function I(t){if(!N){M&&(M=clearTimeout(M));var n=t-j;n>24?(t<1/0&&(M=setTimeout(C,n)),k&&(k=clearInterval(k))):(k||(T=j,k=setInterval(F,E)),N=1,$(C))}}function Y(t){return t.x}function K(t){return t.y}P.prototype=z.prototype={constructor:P,restart:function(t,n,e){if("function"!=typeof t)throw new TypeError("callback is not a function");e=(null==e?D():+e)+(null==n?0:+n),this._next||A===this||(A?A._next=this:b=this,A=this),this._call=t,this._time=e,I()},stop:function(){this._call&&(this._call=null,this._time=1/0,I())}};var L=10,U=Math.PI*(3-Math.sqrt(5));var W="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var B;(function(t,n){t.exports=function(){function t(t){return"function"==typeof t}var n=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},e=0,r=void 0,i=void 0,o=function(t,n){h[e]=t,h[e+1]=n,2===(e+=2)&&(i?i(v):g())},s="undefined"!=typeof window?window:void 0,u=s||{},a=u.MutationObserver||u.WebKitMutationObserver,l="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),c="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function f(){var t=setTimeout;return function(){return t(v,1)}}var h=new Array(1e3);function v(){for(var t=0;t<e;t+=2){var n=h[t],r=h[t+1];n(r),h[t]=void 0,h[t+1]=void 0}e=0}var y,p,_,d,g=void 0;function x(t,n){var e=this,r=new this.constructor(b);void 0===r[m]&&P(r);var i=e._state;if(i){var s=arguments[i-1];o(function(){return D(i,r,s,e._result)})}else S(e,r,t,n);return r}function w(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var n=new this(b);return E(n,t),n}l?g=function(){return process.nextTick(v)}:a?(p=0,_=new a(v),d=document.createTextNode(""),_.observe(d,{characterData:!0}),g=function(){d.data=p=++p%2}):c?((y=new MessageChannel).port1.onmessage=v,g=function(){return y.port2.postMessage(0)}):g=void 0===s?function(){try{var t=Function("return this")().require("vertx");return void 0!==(r=t.runOnLoop||t.runOnContext)?function(){r(v)}:f()}catch(t){return f()}}():f();var m=Math.random().toString(36).substring(2);function b(){}var A=void 0,N=1,M=2;function k(n,e,r){e.constructor===n.constructor&&r===x&&e.constructor.resolve===w?function(t,n){n._state===N?j(t,n._result):n._state===M?q(t,n._result):S(n,void 0,function(n){return E(t,n)},function(n){return q(t,n)})}(n,e):void 0===r?j(n,e):t(r)?function(t,n,e){o(function(t){var r=!1,i=function(t,n,e,r){try{t.call(n,e,r)}catch(t){return t}}(e,n,function(e){r||(r=!0,n!==e?E(t,e):j(t,e))},function(n){r||(r=!0,q(t,n))},t._label);!r&&i&&(r=!0,q(t,i))},t)}(n,e,r):j(n,e)}function E(t,n){if(t===n)q(t,new TypeError("You cannot resolve a promise with itself"));else if(function(t){var n=typeof t;return null!==t&&("object"===n||"function"===n)}(n)){var e=void 0;try{e=n.then}catch(n){return void q(t,n)}k(t,n,e)}else j(t,n)}function T(t){t._onerror&&t._onerror(t._result),$(t)}function j(t,n){t._state===A&&(t._result=n,t._state=N,0!==t._subscribers.length&&o($,t))}function q(t,n){t._state===A&&(t._state=M,t._result=n,o(T,t))}function S(t,n,e,r){var i=t._subscribers,s=i.length;t._onerror=null,i[s]=n,i[s+N]=e,i[s+M]=r,0===s&&t._state&&o($,t)}function $(t){var n=t._subscribers,e=t._state;if(0!==n.length){for(var r=void 0,i=void 0,o=t._result,s=0;s<n.length;s+=3)r=n[s],i=n[s+e],r?D(e,r,i,o):i(o);t._subscribers.length=0}}function D(n,e,r,i){var o=t(r),s=void 0,u=void 0,a=!0;if(o){try{s=r(i)}catch(t){a=!1,u=t}if(e===s)return void q(e,new TypeError("A promises callback cannot return that same promise."))}else s=i;e._state!==A||(o&&a?E(e,s):!1===a?q(e,u):n===N?j(e,s):n===M&&q(e,s))}var O=0;function P(t){t[m]=O++,t._state=void 0,t._result=void 0,t._subscribers=[]}var z=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(b),this.promise[m]||P(this.promise),n(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?j(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&j(this.promise,this._result))):q(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var n=0;this._state===A&&n<t.length;n++)this._eachEntry(t[n],n)},t.prototype._eachEntry=function(t,n){var e=this._instanceConstructor,r=e.resolve;if(r===w){var i=void 0,o=void 0,s=!1;try{i=t.then}catch(t){s=!0,o=t}if(i===x&&t._state!==A)this._settledAt(t._state,n,t._result);else if("function"!=typeof i)this._remaining--,this._result[n]=t;else if(e===C){var u=new e(b);s?q(u,o):k(u,t,i),this._willSettleAt(u,n)}else this._willSettleAt(new e(function(n){return n(t)}),n)}else this._willSettleAt(r(t),n)},t.prototype._settledAt=function(t,n,e){var r=this.promise;r._state===A&&(this._remaining--,t===M?q(r,e):this._result[n]=e),0===this._remaining&&j(r,this._result)},t.prototype._willSettleAt=function(t,n){var e=this;S(t,void 0,function(t){return e._settledAt(N,n,t)},function(t){return e._settledAt(M,n,t)})},t}(),C=function(){function n(t){this[m]=O++,this._result=this._state=void 0,this._subscribers=[],b!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof n?function(t,n){try{n(function(n){E(t,n)},function(n){q(t,n)})}catch(n){q(t,n)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return n.prototype.catch=function(t){return this.then(null,t)},n.prototype.finally=function(n){var e=this.constructor;return t(n)?this.then(function(t){return e.resolve(n()).then(function(){return t})},function(t){return e.resolve(n()).then(function(){throw t})}):this.then(n,n)},n}();return C.prototype.then=x,C.all=function(t){return new z(this,t).promise},C.race=function(t){var e=this;return n(t)?new e(function(n,r){for(var i=t.length,o=0;o<i;o++)e.resolve(t[o]).then(n,r)}):new e(function(t,n){return n(new TypeError("You must pass an array to race."))})},C.resolve=w,C.reject=function(t){var n=new this(b);return q(n,t),n},C._setScheduler=function(t){i=t},C._setAsap=function(t){o=t},C._asap=o,C.polyfill=function(){var t=void 0;if(void 0!==W)t=W;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=t.Promise;if(n){var e=null;try{e=Object.prototype.toString.call(n.resolve())}catch(t){}if("[object Promise]"===e&&!n.cast)return}t.Promise=C},C.Promise=C,C}()}(B={exports:{}},B.exports),B.exports).polyfill();function G(t,r){var i=t.nodes,o=t.links,s=function(t){var r,i,o,s,u,a=p,l=function(t){return 1/Math.min(s[t.source.index],s[t.target.index])},c=n(30),f=1;function v(n){for(var o=0,s=t.length;o<f;++o)for(var a,l,c,h,v,y,p,_=0;_<s;++_)l=(a=t[_]).source,h=(c=a.target).x+c.vx-l.x-l.vx||e(),v=c.y+c.vy-l.y-l.vy||e(),h*=y=((y=Math.sqrt(h*h+v*v))-i[_])/y*n*r[_],v*=y,c.vx-=h*(p=u[_]),c.vy-=v*p,l.vx+=h*(p=1-p),l.vy+=v*p}function y(){if(o){var n,e,l=o.length,c=t.length,f=h(o,a);for(n=0,s=new Array(l);n<c;++n)(e=t[n]).index=n,"object"!=typeof e.source&&(e.source=_(f,e.source)),"object"!=typeof e.target&&(e.target=_(f,e.target)),s[e.source.index]=(s[e.source.index]||0)+1,s[e.target.index]=(s[e.target.index]||0)+1;for(n=0,u=new Array(c);n<c;++n)e=t[n],u[n]=s[e.source.index]/(s[e.source.index]+s[e.target.index]);r=new Array(c),d(),i=new Array(c),g()}}function d(){if(o)for(var n=0,e=t.length;n<e;++n)r[n]=+l(t[n],n,t)}function g(){if(o)for(var n=0,e=t.length;n<e;++n)i[n]=+c(t[n],n,t)}return null==t&&(t=[]),v.initialize=function(t){o=t,y()},v.links=function(n){return arguments.length?(t=n,y(),v):t},v.id=function(t){return arguments.length?(a=t,v):a},v.iterations=function(t){return arguments.length?(f=+t,v):f},v.strength=function(t){return arguments.length?(l="function"==typeof t?t:n(+t),d(),v):l},v.distance=function(t){return arguments.length?(c="function"==typeof t?t:n(+t),g(),v):c},v}(o).id(function(t){return t.id}).distance(r.linkDistance).strength(r.linkStrength),a=function(){var t,r,i,o,s=n(-30),a=1,l=1/0,c=.81;function f(n){var e,o=t.length,s=u(t,Y,K).visitAfter(v);for(i=n,e=0;e<o;++e)r=t[e],s.visit(y)}function h(){if(t){var n,e,r=t.length;for(o=new Array(r),n=0;n<r;++n)e=t[n],o[e.index]=+s(e,n,t)}}function v(t){var n,e,r,i,s,u=0,a=0;if(t.length){for(r=i=s=0;s<4;++s)(n=t[s])&&(e=Math.abs(n.value))&&(u+=n.value,a+=e,r+=e*n.x,i+=e*n.y);t.x=r/a,t.y=i/a}else{(n=t).x=n.data.x,n.y=n.data.y;do{u+=o[n.data.index]}while(n=n.next)}t.value=u}function y(t,n,s,u){if(!t.value)return!0;var f=t.x-r.x,h=t.y-r.y,v=u-n,y=f*f+h*h;if(v*v/c<y)return y<l&&(0===f&&(y+=(f=e())*f),0===h&&(y+=(h=e())*h),y<a&&(y=Math.sqrt(a*y)),r.vx+=f*t.value*i/y,r.vy+=h*t.value*i/y),!0;if(!(t.length||y>=l)){(t.data!==r||t.next)&&(0===f&&(y+=(f=e())*f),0===h&&(y+=(h=e())*h),y<a&&(y=Math.sqrt(a*y)));do{t.data!==r&&(v=o[t.data.index]*i/y,r.vx+=f*v,r.vy+=h*v)}while(t=t.next)}}return f.initialize=function(n){t=n,h()},f.strength=function(t){return arguments.length?(s="function"==typeof t?t:n(+t),h(),f):s},f.distanceMin=function(t){return arguments.length?(a=t*t,f):Math.sqrt(a)},f.distanceMax=function(t){return arguments.length?(l=t*t,f):Math.sqrt(l)},f.theta=function(t){return arguments.length?(c=t*t,f):Math.sqrt(c)},f}().strength(r.repulsionStrength);return function(t){var n,e=1,r=.001,i=1-Math.pow(r,1/300),o=0,s=.6,u=h(),a=z(c),l=g("tick","end");function c(){f(),l.call("tick",n),e<r&&(a.stop(),l.call("end",n))}function f(r){var a,l,c=t.length;void 0===r&&(r=1);for(var f=0;f<r;++f)for(e+=(o-e)*i,u.each(function(t){t(e)}),a=0;a<c;++a)null==(l=t[a]).fx?l.x+=l.vx*=s:(l.x=l.fx,l.vx=0),null==l.fy?l.y+=l.vy*=s:(l.y=l.fy,l.vy=0);return n}function v(){for(var n,e=0,r=t.length;e<r;++e){if((n=t[e]).index=e,null!=n.fx&&(n.x=n.fx),null!=n.fy&&(n.y=n.fy),isNaN(n.x)||isNaN(n.y)){var i=L*Math.sqrt(e),o=e*U;n.x=i*Math.cos(o),n.y=i*Math.sin(o)}(isNaN(n.vx)||isNaN(n.vy))&&(n.vx=n.vy=0)}}function y(n){return n.initialize&&n.initialize(t),n}return null==t&&(t=[]),v(),n={tick:f,restart:function(){return a.restart(c),n},stop:function(){return a.stop(),n},nodes:function(e){return arguments.length?(t=e,v(),u.each(y),n):t},alpha:function(t){return arguments.length?(e=+t,n):e},alphaMin:function(t){return arguments.length?(r=+t,n):r},alphaDecay:function(t){return arguments.length?(i=+t,n):+i},alphaTarget:function(t){return arguments.length?(o=+t,n):o},velocityDecay:function(t){return arguments.length?(s=1-t,n):1-s},force:function(t,e){return arguments.length>1?(null==e?u.remove(t):u.set(t,y(e)),n):u.get(t)},find:function(n,e,r){var i,o,s,u,a,l=0,c=t.length;for(null==r?r=1/0:r*=r,l=0;l<c;++l)(s=(i=n-(u=t[l]).x)*i+(o=e-u.y)*o)<r&&(a=u,r=s);return a},on:function(t,e){return arguments.length>1?(l.on(t,e),n):l.on(t)}}}(i).force("link",s).force("charge",a).force("center",function(t,n){var e;function r(){var r,i,o=e.length,s=0,u=0;for(r=0;r<o;++r)s+=(i=e[r]).x,u+=i.y;for(s=s/o-t,u=u/o-n,r=0;r<o;++r)(i=e[r]).x-=s,i.y-=u}return null==t&&(t=0),null==n&&(n=0),r.initialize=function(t){e=t},r.x=function(n){return arguments.length?(t=+n,r):t},r.y=function(t){return arguments.length?(n=+t,r):n},r}()).alpha(r.alpha).alphaMin(r.alphaMin).alphaDecay(r.alphaDecay).velocityDecay(r.velocityDecay).stop().tick(r.iterations),{nodes:i,links:o}}return self.onmessage=function(t){var n=G.apply(void 0,t.data);self.postMessage(n)},t.forceDirected=G,t}({});`;

        const workerBlob = new Blob([workerCode], { type: "application/javascript" });
        const workerUrl = URL.createObjectURL(workerBlob);
        const worker = new Worker(workerUrl);

        worker.onmessage = event => {
            resolve(event.data);
            worker.terminate();
            URL.revokeObjectURL(workerUrl);
        };
        worker.postMessage([data, options]);
    });
}
